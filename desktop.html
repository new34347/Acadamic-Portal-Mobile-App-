<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوابتي الأكاديمية - جامعة أم القرى</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#006771', dark: '#004d55', light: '#008c99' },
                        gold: { DEFAULT: '#B18E51' },
                        dark: { bg: '#0f172a', card: '#1e293b', text: '#f1f5f9' }
                    },
                    fontFamily: { sans: ['IBM Plex Sans Arabic', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'IBM Plex Sans Arabic', sans-serif; }
        ::-webkit-scrollbar { width: 6px; background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Chatbot Animations */
        .chat-enter { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <!-- Import Map for Stable Loading -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-dark-bg dark:text-dark-text transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            LayoutDashboard, GraduationCap, CheckCircle2, FileText, User, 
            Bell, Menu, Search, LogOut, ArrowRight, Clock, MapPin, 
            Calendar, BookOpen, AlertCircle, TrendingUp, X, Hash, 
            Camera, ShieldAlert, Coins, Award, FileCheck, Layers, 
            PlusCircle, MinusCircle, RefreshCw, Printer, Download,
            Link, Check, AlertTriangle, Moon, Sun, Send, MessageCircle, Lock,
            ChevronDown, ChevronLeft, CreditCard, FileBadge, Image as ImageIcon, 
            Ban, Gift, ScrollText, Upload, Wallet, FileSignature, PieChart, Medal
        } from 'lucide-react';

        // --- Mock Data ---
        const studentData = {
            name: "فيصل عبدالله الخالد",
            id: "444002548",
            major: "هندسة البرمجيات",
            gpa: 3.35,
            completedHours: 40,
            currentHours: 18,
            totalHours: 120,
            avatar: null 
        };

        const translations = {
            ar: {
                welcome: "مرحباً", dashboard: "الرئيسية", academic: "أكاديمي",
                registration: "التسجيل", requests: "الطلبات", personal: "شخصي",
                gpa: "المعدل التراكمي", progress: "نسبة الإنجاز", todaysLectures: "محاضرات اليوم",
                upcomingExams: "الاختبارات القادمة", attendance: "حالة الحضور", quickActions: "الوصول السريع",
                schedule: "الجدول الدراسي", results: "النتائج", plan: "الخطة الدراسية", addDrop: "الحذف والإضافة",
                searchPlaceholder: "ابحث عن خدمة...", statusRegular: "منتظم", now: "الآن",
                chatbotTitle: "المساعد الأكاديمي (سند)", typeMessage: "اكتب رسالتك...",
                back: "عودة", print: "طباعة", download: "تحميل",
                hoursCompleted: "منجزة", hoursCurrent: "حالية", hoursRemaining: "متبقية",
                analytics: "التحليلات", // Category Title
                'student-dashboard': 'لوحة المعلومات', // NEW Dashboard Item
                exams: 'جدول الاختبارات', 
                absences: 'الغيابات', 
                record: 'السجل الأكاديمي',
                // Registration Sub-items
                'offered-courses': 'المقررات المطروحة',
                'addDrop': 'التسجيل الإلكتروني',
                'dept-add': 'إضافة مقرر (القسم)',
                'dept-change': 'تغيير شعبة (القسم)',
                'dept-drop': 'حذف مقرر (القسم)',
                'reg-requests': 'طلبات التسجيل',
                withdraw: 'انسحاب من مقرر',
                // Requests Sub-items
                'academic-action-new': 'طلب حركة أكاديمية',
                'academic-action-view': 'عرض الحركات الأكاديمية',
                'major-change-new': 'طلب تغيير تخصص',
                'major-change-view': 'عرض طلبات تغيير التخصص',
                // Personal Sub-items
                penalties: 'العقوبات',
                rewards: 'المكافآت',
                finance: 'السجل المالي',
                docs: 'الوثائق والإفادات',
                allowances: 'البدلات',
                'id-photo': 'الصورة الشخصية',
                'user-account': 'حسابي'
            },
            en: {
                welcome: "Welcome", dashboard: "Dashboard", academic: "Academic",
                registration: "Registration", requests: "Requests", personal: "Personal",
                gpa: "GPA", progress: "Progress", todaysLectures: "Today's Lectures",
                upcomingExams: "Upcoming Exams", attendance: "Attendance Status", quickActions: "Quick Access",
                schedule: "Schedule", results: "Results", plan: "Degree Plan", addDrop: "Add/Drop",
                searchPlaceholder: "Search services...", statusRegular: "Regular", now: "Now",
                chatbotTitle: "Academic Assistant (Sanad)", typeMessage: "Type a message...",
                back: "Back", print: "Print", download: "Download",
                hoursCompleted: "Completed", hoursCurrent: "Current", hoursRemaining: "Remaining",
                analytics: "Analytics", // Category Title
                'student-dashboard': 'Info Dashboard', // NEW Dashboard Item
                exams: 'Exam Schedule', 
                absences: 'Absences Record', 
                record: 'Academic Record',
                // Registration Sub-items
                'offered-courses': 'Offered Courses',
                'addDrop': 'E-Registration (Add/Drop)',
                'dept-add': 'Add Course (Dept Approval)',
                'dept-change': 'Change Section (Dept Approval)',
                'dept-drop': 'Drop Course (Dept Approval)',
                'reg-requests': 'Registration Requests',
                withdraw: 'Course Withdrawal',
                // Requests Sub-items
                'academic-action-new': 'New Academic Action',
                'academic-action-view': 'View Academic Actions',
                'major-change-new': 'Request Major Change',
                'major-change-view': 'View Major Change Requests',
                // Personal Sub-items
                penalties: 'Penalties',
                rewards: 'Rewards',
                finance: 'Financial Record',
                docs: 'Documents & Certificates',
                allowances: 'Allowances',
                'id-photo': 'Personal Photo Upload',
                'user-account': 'My Account'
            }
        };

        // --- Helper Components ---
        const HeaderPage = ({ title, onBack, extra }) => (
            <div className="flex items-center justify-between mb-6 animate-fade-in sticky top-0 bg-gray-50/95 dark:bg-dark-bg/95 z-20 py-3 backdrop-blur-sm border-b border-transparent">
                <div className="flex items-center gap-3">
                    <button onClick={onBack} className="p-2 bg-white dark:bg-dark-card rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 shadow-sm border border-gray-100 dark:border-gray-700 transition-all group">
                        <ArrowRight size={20} className="text-gray-500 dark:text-gray-300 group-hover:text-primary" />
                    </button>
                    <h2 className="text-xl md:text-2xl font-bold text-gray-800 dark:text-white">{title}</h2>
                </div>
                <div className="flex gap-2">{extra}</div>
            </div>
        );

        const ActionCard = ({ icon, title, onClick, color = "primary" }) => (
            <button onClick={onClick} className="group relative flex flex-col items-center justify-center bg-white dark:bg-dark-card p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 hover:border-primary dark:hover:border-primary hover:shadow-md transition-all duration-300 h-28 w-full overflow-hidden">
                <div className={`p-3 rounded-full mb-2 bg-${color === 'primary' ? 'teal' : color}-50 text-${color === 'primary' ? 'teal' : color}-600 dark:text-${color === 'primary' ? 'teal' : color}-400 group-hover:scale-110 transition-transform`}>
                    {icon}
                </div>
                <span className="text-xs font-bold text-gray-600 dark:text-gray-300 group-hover:text-primary dark:group-hover:text-teal-400 text-center">{title}</span>
            </button>
        );

        // --- NEW: Chatbot Component ---
        const Chatbot = ({ t }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([
                { id: 1, text: "مرحباً بك يا فيصل! أنا سند، مساعدك الأكاديمي. كيف يمكنني خدمتك اليوم؟", sender: 'bot' }
            ]);
            const [input, setInput] = useState("");
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, isOpen]);

            const handleSend = () => {
                if (!input.trim()) return;
                const userMsg = { id: Date.now(), text: input, sender: 'user' };
                setMessages(prev => [...prev, userMsg]);
                setInput("");
                
                // Mock response simulation
                setTimeout(() => {
                    const responses = [
                        "يمكنني مساعدتك في استعراض جدولك الدراسي أو متابعة طلباتك.",
                        "هل تود الاستفسار عن مواعيد الحذف والإضافة؟",
                        "يمكنك الوصول للخدمات الأكاديمية من القائمة الجانبية.",
                        "جاري التحقق من سجلك الأكاديمي..."
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    setMessages(prev => [...prev, { 
                        id: Date.now() + 1, 
                        text: randomResponse, 
                        sender: 'bot' 
                    }]);
                }, 1000);
            };

            return (
                <>
                    <button 
                        onClick={() => setIsOpen(!isOpen)} 
                        className={`fixed bottom-6 left-6 z-50 p-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110 ${isOpen ? 'bg-red-500 rotate-90' : 'bg-primary animate-bounce'} text-white border-4 border-white dark:border-dark-bg`}
                    >
                        {isOpen ? <X size={24}/> : <MessageCircle size={28}/>}
                    </button>

                    {isOpen && (
                        <div className="fixed bottom-24 left-6 z-40 w-[90vw] md:w-96 bg-white dark:bg-dark-card rounded-3xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden flex flex-col chat-enter h-[500px] max-h-[70vh]">
                            <div className="bg-gradient-to-r from-primary to-teal-800 p-4 flex items-center gap-3 shadow-md">
                                <div className="p-2 bg-white/20 rounded-full text-white backdrop-blur-sm shadow-inner"><User size={20}/></div>
                                <div>
                                    <h3 className="font-bold text-white text-base">{t.chatbotTitle}</h3>
                                    <span className="flex items-center gap-1.5 text-[10px] text-teal-100 font-medium"><div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div> متصل الآن</span>
                                </div>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-800/30">
                                {messages.map(msg => (
                                    <div key={msg.id} className={`flex ${msg.sender === 'user' ? 'justify-start' : 'justify-end'} animate-fade-in`}>
                                        <div className={`max-w-[80%] p-3.5 rounded-2xl text-sm leading-relaxed shadow-sm ${msg.sender === 'user' ? 'bg-primary text-white rounded-br-none' : 'bg-white dark:bg-gray-700 text-gray-800 dark:text-white rounded-bl-none border border-gray-100 dark:border-gray-600'}`}>
                                            {msg.text}
                                        </div>
                                    </div>
                                ))}
                                <div ref={messagesEndRef} />
                            </div>

                            <div className="p-3 bg-white dark:bg-dark-card border-t border-gray-100 dark:border-gray-700 flex gap-2 items-center">
                                <input 
                                    type="text" 
                                    value={input}
                                    onChange={e => setInput(e.target.value)}
                                    onKeyPress={e => e.key === 'Enter' && handleSend()}
                                    placeholder={t.typeMessage}
                                    className="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl px-4 py-3 text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary/20 transition-all dark:text-white"
                                />
                                <button onClick={handleSend} disabled={!input.trim()} className="p-3 bg-primary text-white rounded-2xl hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-sm active:scale-95">
                                    <Send size={18} className="rotate-180"/>
                                </button>
                            </div>
                        </div>
                    )}
                </>
            );
        };

        const Toast = ({ message, type, onClose }) => (
            <div className={`fixed bottom-4 left-4 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg text-white font-bold text-sm animate-fade-in ${type === 'success' ? 'bg-emerald-600' : 'bg-red-600'}`}>
                {type === 'success' ? <CheckCircle2 size={18}/> : <AlertTriangle size={18}/>}
                {message}
                <button onClick={onClose} className="mr-2 opacity-80 hover:opacity-100"><X size={14}/></button>
            </div>
        );

        // --- NEW: StudentDashboardPage (Fixed Implementation) ---
        const StudentDashboardPage = ({ onBack }) => {
            // Data matching the image - Reduced to 4 Levels
            const gpaData = [
                { sem: 'المستوى 1', gpa: 3.85 },
                { sem: 'المستوى 2', gpa: 3.60 },
                { sem: 'المستوى 3', gpa: 3.45 },
                { sem: 'المستوى 4', gpa: 3.35 }
            ];

            const [hoveredPoint, setHoveredPoint] = useState(null);
            
            // Chart Configuration
            const chartHeight = 220; 
            const chartWidth = 800;
            const paddingX = 80; 
            const paddingY = 50; 
            const maxGPA = 4.0;
            const minGPA = 2.0;

            const points = gpaData.map((item, index) => {
                // RTL: Calculate x from right to left
                const step = (chartWidth - (paddingX * 2)) / (gpaData.length - 1);
                const xPos = chartWidth - paddingX - (index * step);
                
                // Y Position inverted (SVG coords)
                const yPos = chartHeight - paddingY - ((item.gpa - minGPA) / (maxGPA - minGPA)) * (chartHeight - (paddingY * 2));
                return { x: xPos, y: yPos, ...item };
            });

            // Create Path Commands
            const linePath = "M" + points.map(p => `${p.x},${p.y}`).join(" L");
            const areaPath = `${linePath} L${points[points.length-1].x},${chartHeight - paddingY} L${points[0].x},${chartHeight - paddingY} Z`;

            // Attendance Data
            const attendanceStats = [
                { code: 'SE301', name: 'هندسة برمجيات', pct: 98, absent: 1, total: 45 },
                { code: 'CS305', name: 'نظم تشغيل', pct: 91, absent: 4, total: 45 },
                { code: 'MATH201', name: 'إحصاء هندسي', pct: 85, absent: 6, total: 40 },
                { code: 'PHYS101', name: 'فيزياء عامة', pct: 75, absent: 12, total: 48 }, 
                { code: 'ISL102', name: 'ثقافة إسلامية', pct: 100, absent: 0, total: 30 },
            ];

            const academicWarnings = 0;

            return (
                <div className="animate-fade-in space-y-6 pb-10">
                    <HeaderPage title="لوحة معلومات الطالب" onBack={onBack} />
                    
                    {/* Top Cards Row */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {/* Registered Courses */}
                        <div className="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center text-center h-48 transition hover:shadow-md">
                            <div className="mb-4 text-primary bg-primary/10 p-4 rounded-full"><BookOpen size={32} strokeWidth={1.5} /></div>
                            <h3 className="text-gray-500 font-bold mb-2">المقررات المسجلة</h3>
                            <span className="text-3xl font-bold text-gray-800 dark:text-white">6</span>
                        </div>

                        {/* Remaining Courses */}
                        <div className="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center text-center h-48 transition hover:shadow-md">
                            <div className="mb-4 text-blue-600 bg-blue-50 p-4 rounded-full"><Layers size={32} strokeWidth={1.5} /></div>
                            <h3 className="text-gray-500 font-bold mb-2">المقررات المتبقية</h3>
                            <span className="text-3xl font-bold text-gray-800 dark:text-white">22</span>
                        </div>

                        {/* Earned Hours */}
                        <div className="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center text-center h-48 transition hover:shadow-md">
                            <div className="mb-4 text-gold bg-yellow-50 p-4 rounded-full"><Medal size={32} strokeWidth={1.5} /></div>
                            <h3 className="text-gray-500 font-bold mb-2">الساعات المكتسبة</h3>
                            <span className="text-3xl font-bold text-gray-800 dark:text-white">60</span>
                        </div>
                    </div>

                    {/* Middle: GPA Comparison Chart (Interactive) */}
                    <div className="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold text-primary dark:text-teal-400">تحليل المعدل التراكمي</h3>
                            <div className="flex gap-2">
                                <span className="text-xs font-bold text-gray-400 flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-primary"></div> المعدل الفصلي</span>
                            </div>
                        </div>
                        
                        <div className="w-full overflow-hidden relative">
                            {/* --- Center Display Overlay (Smaller Version) --- */}
                            <div className={`absolute inset-0 flex items-center justify-center pointer-events-none z-10 transition-all duration-300 ${hoveredPoint ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'}`}>
                                <div className="bg-white/95 dark:bg-dark-card/95 backdrop-blur-md px-6 py-3 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-600 text-center min-w-[140px]">
                                    <p className="text-[10px] text-gray-400 font-bold mb-0.5 uppercase tracking-wider">{hoveredPoint?.sem}</p>
                                    <div className="flex items-baseline justify-center gap-1">
                                        <span className="text-3xl font-bold text-primary dark:text-teal-400 font-mono tracking-tighter drop-shadow-sm">{hoveredPoint?.gpa.toFixed(2)}</span>
                                        <span className="text-[10px] text-gray-400 font-mono">/ 4.00</span>
                                    </div>
                                    <div className="w-full h-1 bg-gray-100 dark:bg-gray-700 rounded-full mt-2 overflow-hidden">
                                        <div className="h-full bg-primary transition-all duration-300" style={{ width: hoveredPoint ? `${(hoveredPoint.gpa / 4.0) * 100}%` : '0%' }}></div>
                                    </div>
                                </div>
                            </div>

                            <div className="w-full h-80 relative select-none">
                                <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="w-full h-full overflow-visible">
                                    <defs>
                                        <linearGradient id="chartFill" x1="0" x2="0" y1="0" y2="1">
                                            <stop offset="0%" stopColor="#006771" stopOpacity="0.3"/>
                                            <stop offset="100%" stopColor="#006771" stopOpacity="0"/>
                                        </linearGradient>
                                        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                                            <feDropShadow dx="0" dy="2" stdDeviation="2" floodOpacity="0.2"/>
                                        </filter>
                                    </defs>

                                    {/* Grid Lines */}
                                    {[2.5, 3.0, 3.5, 4.0].map((val, i) => {
                                        const y = chartHeight - paddingY - ((val - minGPA) / (maxGPA - minGPA)) * (chartHeight - (paddingY * 2));
                                        return (
                                            <g key={i}>
                                                <line x1={paddingX} y1={y} x2={chartWidth - paddingX} y2={y} stroke="#e5e7eb" strokeWidth="1" strokeDasharray="4"/>
                                                <text x={chartWidth - paddingX + 10} y={y + 4} className="text-[10px] fill-gray-400 font-mono">{val.toFixed(1)}</text>
                                            </g>
                                        );
                                    })}

                                    {/* Area */}
                                    <path d={areaPath} fill="url(#chartFill)" />

                                    {/* Line */}
                                    <path d={linePath} fill="none" stroke="#006771" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" filter="url(#shadow)" />
                                    
                                    {/* Points and Interaction */}
                                    {points.map((p, i) => (
                                        <g key={i} 
                                           onMouseEnter={() => setHoveredPoint(p)} 
                                           onMouseLeave={() => setHoveredPoint(null)}
                                           className="cursor-pointer group"
                                        >
                                            {/* Hit Area (Invisible larger circle) */}
                                            <circle cx={p.x} cy={p.y} r="35" fill="transparent" />
                                            
                                            {/* Visible Point */}
                                            <circle 
                                                cx={p.x} 
                                                cy={p.y} 
                                                r={hoveredPoint === p ? 10 : 6} 
                                                fill={hoveredPoint === p ? "#B18E51" : "white"} 
                                                stroke="#006771" 
                                                strokeWidth={hoveredPoint === p ? 0 : 3}
                                                className="transition-all duration-300"
                                            />

                                            {/* Fixed Small Label (Always visible) */}
                                            <text 
                                                x={p.x} 
                                                y={p.y - 15} 
                                                textAnchor="middle" 
                                                className={`text-[10px] font-bold fill-gray-500 dark:fill-gray-400 font-mono transition-opacity duration-300 ${hoveredPoint === p ? 'opacity-0' : 'opacity-100'}`}
                                            >
                                                {p.gpa.toFixed(2)}
                                            </text>

                                            {/* X-Axis Labels */}
                                            <text x={p.x} y={chartHeight - 5} textAnchor="middle" className={`text-xs font-bold transition-all ${hoveredPoint === p ? 'fill-primary text-base' : 'fill-gray-500 dark:fill-gray-400'}`}>
                                                {p.sem}
                                            </text>
                                        </g>
                                    ))}
                                </svg>
                            </div>
                        </div>
                    </div>

                    {/* Bottom Row */}
                    <div className="grid grid-cols-1 gap-6">
                        {/* Attendance Bar Chart - Full Width - Redesigned for Clarity */}
                        <div className="bg-white dark:bg-dark-card rounded-2xl p-8 shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col">
                            {/* Header */}
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                                <div>
                                    <h3 className="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
                                        <FileCheck size={24} className="text-primary" />
                                        إحصائيات الحضور والغياب
                                    </h3>
                                    <p className="text-xs text-gray-500 mt-1">توضيح لنسب الحضور (الأعمدة الملونة) ومقدار الغياب لكل مقرر</p>
                                </div>
                                <div className="flex flex-wrap gap-3 text-[10px] font-bold bg-gray-50 dark:bg-gray-800/50 p-2 rounded-lg border border-gray-100 dark:border-gray-700">
                                    <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 rounded bg-emerald-500"></div> آمن (&lt;5%)</div>
                                    <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 rounded bg-amber-400"></div> تنبيه (5-14%)</div>
                                    <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 rounded bg-red-500"></div> حرمان (&ge;15%)</div>
                                </div>
                            </div>

                            {/* Chart Area */}
                            <div className="relative w-full h-[400px]">
                                {/* Grid Lines removed as requested */}

                                {/* Bars Container */}
                                <div className="absolute inset-0 flex items-end justify-around px-2 pb-6 pt-12 z-10">
                                    {attendanceStats.map((item, i) => {
                                        const absencePct = Math.round((item.absent / item.total) * 100);
                                        const attendancePct = 100 - absencePct;
                                        
                                        // Simple Color Logic
                                        let barColor = 'bg-emerald-500';
                                        let lightColor = 'bg-emerald-50 dark:bg-emerald-900/10';
                                        let textColor = 'text-emerald-600 dark:text-emerald-400';
                                        
                                        if(absencePct >= 15) { 
                                            barColor = 'bg-red-500'; 
                                            lightColor = 'bg-red-50 dark:bg-red-900/10';
                                            textColor = 'text-red-600 dark:text-red-400';
                                        } else if (absencePct >= 5) {
                                            barColor = 'bg-amber-400';
                                            lightColor = 'bg-amber-50 dark:bg-amber-900/10';
                                            textColor = 'text-amber-600 dark:text-amber-400';
                                        }

                                        return (
                                            <div key={i} className="relative flex flex-col items-center justify-end h-full w-full max-w-[80px] group cursor-pointer">
                                                
                                                {/* Percentage Bubble (Floats above bar) */}
                                                <div className={`mb-3 px-3 py-1 rounded-lg text-sm font-bold shadow-sm border border-transparent transition-all transform group-hover:-translate-y-2 ${lightColor} ${textColor}`}>
                                                    {absencePct}% <span className="text-[10px] opacity-70 font-normal">غياب</span>
                                                </div>

                                                {/* The Bar */}
                                                <div className="w-12 md:w-16 bg-gray-100 dark:bg-gray-800 rounded-t-lg relative overflow-hidden h-full flex items-end shadow-inner">
                                                    <div 
                                                        className={`w-full ${barColor} rounded-t-lg transition-all duration-1000 ease-out relative`}
                                                        style={{ height: `${attendancePct}%` }}
                                                    >
                                                        {/* Simple gradient overlay for depth */}
                                                        <div className="absolute inset-0 bg-gradient-to-b from-white/20 to-transparent"></div>
                                                    </div>
                                                </div>

                                                {/* Subject Name - Improved Visibility & Wrapping */}
                                                <div className="mt-3 text-xs md:text-sm font-bold text-gray-800 dark:text-white text-center w-full leading-tight px-0.5 min-h-[2.5rem] flex items-start justify-center" title={item.name}>
                                                    <span className="line-clamp-2">{item.name}</span>
                                                </div>
                                                
                                                {/* Hours Detail (Small under name) */}
                                                <div className="text-[10px] text-gray-500 dark:text-gray-400 font-mono mt-0.5">
                                                    -{item.absent} ساعات
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 1. الجدول الدراسي
        const SchedulePage = ({ onBack, t }) => {
            const weekDays = ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس'];
            const timeSlots = [];
            for (let i = 8; i <= 21; i++) {
                const start = i < 10 ? `0${i}` : i;
                const end = i < 10 ? `0${i}` : i;
                const label = `${end}:50 - ${start}:00`; 
                timeSlots.push({ hour: i, label: label });
            }
            // Updated Data with College, Type (Theory/Lab), Mode (In-person/Online)
            const schedule = {
                'الأحد': [
                    { id: 1, name: 'إحصاء هندسي', code: 'MATH101', start: 8, dur: 2, color: 'bg-[#56AB7C]', text: 'text-white', room: '101', prof: 'د. أحمد سالم', profEmail: 'ahmed.salem@uqu.edu.sa', type: 'lec', mode: 'in-person', bldg: 'قاعة الخوارزمي - الطابق الأرضي', college: 'الكلية الجامعية' },
                    { id: 2, name: 'أمن سيبراني', code: 'CS320', start: 18, dur: 2, color: 'bg-[#0082C0]', text: 'text-white', room: 'Virtual', prof: 'د. سارة الشهري', profEmail: 'sara.shehri@uqu.edu.sa', type: 'lec', mode: 'online', bldg: 'عن بعد - Blackboard', college: 'كلية الحاسب الآلي' }
                ],
                'الاثنين': [
                    { id: 3, name: 'تحليل كيميائي', code: 'CH202', start: 10, dur: 2, color: 'bg-[#4F46E5]', text: 'text-white', room: 'Lab 3', prof: 'أ. محمد علي', profEmail: 'm.ali@uqu.edu.sa', type: 'lab', mode: 'in-person', bldg: 'مبنى المعامل (ب) - الدور الثاني', college: 'كلية العلوم التطبيقية' },
                    { id: 4, name: 'ثقافة إسلامية', code: 'ISL101', start: 13, dur: 2, color: 'bg-[#E44B45]', text: 'text-white', room: 'Online', prof: 'د. عبدالله', profEmail: 'abdullah@uqu.edu.sa', type: 'lec', mode: 'online', bldg: 'عن بعد', college: 'كلية الدعوة وأصول الدين' }
                ],
                'الثلاثاء': [
                    { id: 5, name: 'تصميم واجهات', code: 'CS305', start: 16, dur: 2, color: 'bg-[#0082C0]', text: 'text-white', room: '205', prof: 'د. عمر', profEmail: 'omar@uqu.edu.sa', type: 'lec', mode: 'in-person', bldg: 'مبنى الحاسب الآلي - الدور الثاني', college: 'كلية الحاسب الآلي' },
                ],
                'الأربعاء': [
                    { id: 7, name: 'القرآن الكريم', code: 'QR101', start: 18, dur: 2, color: 'bg-[#E44B45]', text: 'text-white', room: 'Msj', prof: 'د. خالد', profEmail: 'khaled@uqu.edu.sa', type: 'lec', mode: 'in-person', bldg: 'المصلى الرئيسي', college: 'كلية الدعوة وأصول الدين' },
                    { id: 8, name: 'مشروع تخرج 1', code: 'GP401', start: 20, dur: 2, color: 'bg-[#9D79DC]', text: 'text-white', room: 'Lab 1', prof: 'أ. فهد', profEmail: 'fahad@uqu.edu.sa', type: 'lab', mode: 'in-person', bldg: 'معمل الابتكار - مبنى 5', college: 'كلية الحاسب الآلي' }
                ],
                'الخميس': [
                     { id: 9, name: 'مشروع تخرج 1', code: 'GP401', start: 19, dur: 2, color: 'bg-[#9D79DC]', text: 'text-white', room: 'Lab 1', prof: 'أ. فهد', profEmail: 'fahad@uqu.edu.sa', type: 'lab', mode: 'in-person', bldg: 'معمل الابتكار - مبنى 5', college: 'كلية الحاسب الآلي' }
                ]
            };

            const [selectedLecture, setSelectedLecture] = useState(null);
            
            const formatTimeRange = (start, dur) => {
                const endHour = start + dur - 1;
                const s = start < 10 ? `0${start}` : start;
                const e = endHour < 10 ? `0${endHour}` : endHour;
                return `${e}:50 - ${s}:00`;
            };

            return (
                <div className="animate-fade-in space-y-6 relative h-full">
                    <HeaderPage title={t.schedule} onBack={onBack} extra={
                        <button className="hidden md:flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-teal-700 transition">
                            <Printer size={16}/> {t.print}
                        </button>
                    } />
                    
                    {/* Enhanced Modal */}
                    {selectedLecture && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onClick={() => setSelectedLecture(null)}>
                            <div className="bg-white dark:bg-dark-card w-full max-w-md rounded-3xl shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 transform transition-all scale-100 flex flex-col" onClick={e => e.stopPropagation()}>
                                {/* Header */}
                                <div className={`h-32 ${selectedLecture.color} relative flex flex-col items-center justify-center text-white`}>
                                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                                    <button onClick={() => setSelectedLecture(null)} className="absolute top-4 right-4 bg-black/20 text-white p-2 rounded-full hover:bg-black/40 transition z-10"><X size={20}/></button>
                                    <h3 className="text-2xl font-bold shadow-sm mt-2 relative z-10">{selectedLecture.name}</h3>
                                    <span className="text-sm font-mono opacity-90 bg-white/20 px-3 py-1 rounded-full mt-2 relative z-10 backdrop-blur-sm">{selectedLecture.code}</span>
                                </div>
                                
                                {/* Details Body */}
                                <div className="p-6 space-y-4">
                                    
                                    {/* New Section: College & Type Details */}
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="p-3 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700">
                                            <p className="text-xs text-gray-500 font-bold mb-1">الكلية</p>
                                            <p className="font-bold text-gray-800 dark:text-white text-xs">{selectedLecture.college}</p>
                                        </div>
                                        <div className="p-3 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700">
                                            <p className="text-xs text-gray-500 font-bold mb-1">التصنيف</p>
                                            <div className="flex flex-wrap gap-1">
                                                <span className={`text-[10px] px-2 py-0.5 rounded font-bold ${selectedLecture.type === 'lec' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}`}>
                                                    {selectedLecture.type === 'lec' ? 'نظري' : 'عملي'}
                                                </span>
                                                <span className={`text-[10px] px-2 py-0.5 rounded font-bold ${selectedLecture.mode === 'in-person' ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'}`}>
                                                    {selectedLecture.mode === 'in-person' ? 'حضوري' : 'عن بعد'}
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Time */}
                                    <div className="flex items-center gap-4 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl transition border border-transparent hover:border-gray-100 dark:hover:border-gray-700">
                                        <div className="p-3 bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400 rounded-full"><Clock size={20}/></div>
                                        <div>
                                            <p className="text-xs text-gray-500 font-bold mb-0.5">الوقت</p>
                                            <p className="font-bold text-gray-800 dark:text-white dir-ltr">{formatTimeRange(selectedLecture.start, selectedLecture.dur)}</p>
                                        </div>
                                    </div>

                                    {/* Location */}
                                    <div className="flex items-center gap-4 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl transition border border-transparent hover:border-gray-100 dark:hover:border-gray-700">
                                        <div className="p-3 bg-purple-50 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400 rounded-full"><MapPin size={20}/></div>
                                        <div>
                                            <p className="text-xs text-gray-500 font-bold mb-0.5">الموقع</p>
                                            <p className="font-bold text-gray-800 dark:text-white text-sm">{selectedLecture.bldg}</p>
                                            <p className="text-xs text-gray-500 mt-0.5 bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded w-fit">القاعة: {selectedLecture.room}</p>
                                        </div>
                                    </div>

                                    {/* Professor Info */}
                                    <div className="flex items-center gap-4 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl transition border border-transparent hover:border-gray-100 dark:hover:border-gray-700">
                                        <div className="p-3 bg-teal-50 text-teal-600 dark:bg-teal-900/20 dark:text-teal-400 rounded-full"><User size={20}/></div>
                                        <div className="flex-1">
                                            <p className="text-xs text-gray-500 font-bold mb-0.5">عضو هيئة التدريس</p>
                                            <p className="font-bold text-gray-800 dark:text-white">{selectedLecture.prof}</p>
                                            <a href={`mailto:${selectedLecture.profEmail}`} className="text-xs text-primary mt-1.5 font-mono flex items-center gap-1 hover:underline w-fit px-2 py-1 rounded bg-primary/5">
                                                {selectedLecture.profEmail} <Send size={10} className="rotate-180"/>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="bg-white dark:bg-dark-card rounded-lg border border-gray-200 dark:border-gray-700 overflow-x-auto shadow-sm">
                        <table className="w-full min-w-[800px] text-center table-fixed border-collapse">
                            <thead className="bg-white dark:bg-dark-card text-gray-800 dark:text-white border-b border-gray-200 dark:border-gray-700">
                                <tr>
                                    <th className="py-4 w-28 border-l border-gray-200 dark:border-gray-700"></th> 
                                    {weekDays.map(day => (
                                        <th key={day} className="py-4 border-l border-gray-200 dark:border-gray-700 text-sm font-bold">{day}</th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                {timeSlots.map((slot) => (
                                    <tr key={slot.hour} className="h-24">
                                        <td className="p-2 bg-white dark:bg-dark-card text-gray-600 dark:text-gray-400 text-xs font-bold border-l border-gray-200 dark:border-gray-700 font-mono align-top pt-8">
                                            {slot.label}
                                        </td>
                                        {weekDays.map((day, dayIdx) => {
                                            const lecture = schedule[day]?.find(l => l.start === slot.hour);
                                            const isOccupied = schedule[day]?.some(l => slot.hour > l.start && slot.hour < l.start + l.dur);
                                            if (lecture) {
                                                return (
                                                    <td key={dayIdx} rowSpan={lecture.dur} className="p-1 relative align-top h-full border-l border-gray-100 dark:border-gray-700/50">
                                                        <button 
                                                            onClick={() => setSelectedLecture(lecture)}
                                                            className={`w-full h-full rounded-lg ${lecture.color} ${lecture.text} flex flex-col items-center justify-center text-center shadow-sm hover:opacity-90 transition-opacity p-2 relative group`}
                                                        >
                                                            <div className="absolute top-2 left-3 opacity-60"><AlertCircle size={16}/></div>
                                                            <div className="flex flex-col items-center justify-center h-full w-full gap-1">
                                                                <span className="font-bold text-base leading-tight">{lecture.name}</span>
                                                                {lecture.code && <span className="text-sm opacity-90 font-mono bg-black/10 px-1.5 rounded text-[10px]">{lecture.code}</span>}
                                                                <span className="text-[10px] font-bold opacity-80 mt-1 dir-ltr font-mono tracking-wide">
                                                                    {formatTimeRange(lecture.start, lecture.dur)}
                                                                </span>
                                                            </div>
                                                        </button>
                                                    </td>
                                                );
                                            }
                                            if (isOccupied) return null;
                                            return <td key={dayIdx} className="border-l border-gray-100 dark:border-gray-700/50"></td>
                                        })}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // 2. الخطة الدراسية
        const PlanPage = ({ onBack, t }) => {
            const levels = [
                { id: 1, courses: [{ code: 'MATH101', name: 'تفاضل وتكامل 1', status: 'eq', grade: 'معادلة', hours: 4 }, { code: 'ENG101', name: 'لغة إنجليزية 1', status: 'eq', grade: 'معادلة', hours: 3 }, { code: 'ISL101', name: 'ثقافة إسلامية 1', status: 'done', grade: 'أ', hours: 2 }, { code: 'PHYS101', name: 'فيزياء عامة 1', status: 'done', grade: 'ب+', hours: 4 }, { code: 'CS100', name: 'مهارات حاسب', status: 'done', grade: 'أ+', hours: 2 }] },
                { id: 2, courses: [{ code: 'CS101', name: 'مقدمة في البرمجة', status: 'done', grade: 'ب+', hours: 4, pre: 'CS100' }, { code: 'MATH102', name: 'تفاضل وتكامل 2', status: 'done', grade: 'ج+', hours: 4, pre: 'MATH101' }, { code: 'PHYS102', name: 'فيزياء عامة 2', status: 'done', grade: 'ب', hours: 4, pre: 'PHYS101' }, { code: 'ENG102', name: 'لغة إنجليزية 2', status: 'done', grade: 'ب+', hours: 3, pre: 'ENG101' }, { code: 'ISL102', name: 'ثقافة إسلامية 2', status: 'lock', grade: '', hours: 2, pre: 'ISL101' }] },
                { id: 3, courses: [{ code: 'CS201', name: 'برمجة 1', status: 'done', grade: 'أ+', pre: 'CS101', hours: 4 }, { code: 'MATH201', name: 'رياضيات متقطعة', status: 'done', grade: 'ب', pre: 'MATH102', hours: 3 }] },
                { id: 4, courses: [{ code: 'CS204', name: 'برمجة 2', status: 'now', grade: '---', pre: 'CS201', hours: 4 }, { code: 'CS205', name: 'قواعد بيانات', status: 'now', grade: '---', pre: 'CS101', hours: 3 }] }
            ];
            for(let i=5; i<=8; i++) { levels.push({ id: i, courses: [{ code: `CS${i}01`, name: `مقرر تخصص ${i}`, status: 'lock', pre: `CS${i-1}01`, hours: 3 }, { code: `SE${i}02`, name: `مشروع ${i}`, status: 'lock', hours: 4 }] }); }
            const getCourseName = (code) => {
                for (const level of levels) { const found = level.courses.find(c => c.code === code); if (found) return found.name; }
                return code;
            };
            const totalPlanHours = levels.reduce((acc, lvl) => acc + lvl.courses.reduce((sum, c) => sum + c.hours, 0), 0);
            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.plan} onBack={onBack} extra={<div className="bg-primary/10 text-primary px-3 py-1 rounded-lg text-sm font-bold border border-primary/20">إجمالي الساعات: {totalPlanHours}س</div>} />
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {levels.map((lvl) => {
                            const isLevelCompleted = lvl.courses.every(c => c.status === 'done' || c.status === 'eq');
                            const levelHours = lvl.courses.reduce((sum, c) => sum + c.hours, 0);
                            return (
                                <div key={lvl.id} className={`rounded-xl border overflow-hidden shadow-sm transition-all ${isLevelCompleted ? 'border-green-300 dark:border-green-800' : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-card'}`}>
                                    <div className={`p-3 border-b flex justify-between items-center ${isLevelCompleted ? 'bg-green-600 text-white border-green-700' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-800 dark:text-white'}`}>
                                        <h3 className="font-bold text-sm flex items-center gap-2">
                                            {isLevelCompleted ? <CheckCircle2 size={16} className="text-white"/> : <span className="w-4 h-4 rounded-full border-2 border-current opacity-50"></span>}
                                            المستوى {lvl.id}
                                        </h3>
                                        <div className="flex gap-2 text-[10px]">
                                            <span className={`px-2 py-0.5 rounded ${isLevelCompleted ? 'bg-green-500 text-white' : 'bg-white dark:bg-dark-card border text-gray-500'}`}>{lvl.courses.length} مقررات</span>
                                            <span className={`px-2 py-0.5 rounded ${isLevelCompleted ? 'bg-green-500 text-white' : 'bg-white dark:bg-dark-card border text-gray-500'}`}>{levelHours}س</span>
                                        </div>
                                    </div>
                                    <div className={`divide-y ${isLevelCompleted ? 'divide-green-100 dark:divide-green-900/30 bg-green-50 dark:bg-green-900/10' : 'divide-gray-100 dark:divide-gray-700'}`}>
                                        {lvl.courses.map((course, i) => {
                                            const isDone = course.status === 'done' || course.status === 'eq';
                                            return (
                                                <div key={i} className={`p-3 transition relative group ${isDone ? 'bg-green-50/50 dark:bg-green-900/20' : 'bg-white dark:bg-dark-card'}`}>
                                                    <div className="flex justify-between items-start">
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-9 h-9 rounded-lg flex items-center justify-center text-xs font-bold shadow-sm ${course.status === 'eq' ? 'bg-blue-100 text-blue-700 border border-blue-200' : course.status === 'done' ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-gray-50 dark:bg-gray-700 text-gray-400 border border-gray-200 dark:border-gray-600'}`}>
                                                                {course.status === 'eq' ? 'EQ' : course.status === 'done' ? <Check size={16}/> : <Lock size={16}/>}
                                                            </div>
                                                            <div>
                                                                <div className={`font-bold text-sm ${isDone ? 'text-gray-800 dark:text-gray-200' : 'text-gray-600 dark:text-gray-400'}`}>{course.name}</div>
                                                                <div className="flex items-center gap-2 mt-0.5">
                                                                    <span className="text-[10px] text-gray-500 font-mono bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded">{course.code}</span>
                                                                    <span className="text-[10px] font-bold text-primary dark:text-teal-400">{course.hours} Hrs</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className={`text-xs font-bold px-2 py-1 rounded ${isDone ? 'text-green-700 dark:text-green-400 bg-green-100 dark:bg-green-900/30' : 'text-gray-300'}`}>{course.grade || '--'}</div>
                                                    </div>
                                                    {course.pre && <div className="mt-2 mr-12 flex items-center gap-1.5 text-[10px] text-orange-700 bg-orange-50 w-full md:w-fit px-2 py-1 rounded border border-orange-100 dark:bg-orange-900/20 dark:border-orange-800 dark:text-orange-300"><Link size={12} className="opacity-70" /><span className="opacity-70">متطلب:</span><span className="font-bold">{getCourseName(course.pre)}</span></div>}
                                                </div>
                                            )
                                        })}
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                </div>
            );
        };

        // 3. النتائج
        const ResultsPage = ({ onBack, t }) => {
            const gpaTrend = [ { sem: 'المستوى 1', gpa: 3.50 }, { sem: 'المستوى 2', gpa: 3.65 }, { sem: 'المستوى 3', gpa: 3.40 }, { sem: 'المستوى 4', gpa: 3.80 }, { sem: 'الحالي', gpa: 3.35 } ];
            const detailedResults = [
                { code: 'SE301', name: 'هندسة برمجيات', total: 95, grade: 'أ+', components: [{ label: 'العملي', max: 20, student: 19, avg: 16 }, { label: 'النصفي', max: 20, student: 18, avg: 14 }, { label: 'أعمال سنة', max: 20, student: 20, avg: 18 }, { label: 'النهائي', max: 40, student: 38, avg: 32 }] },
                { code: 'CS305', name: 'نظم تشغيل', total: 78, grade: 'ج+', components: [{ label: 'العملي', max: 20, student: 15, avg: 17 }, { label: 'النصفي', max: 20, student: 14, avg: 15 }, { label: 'أعمال سنة', max: 20, student: 18, avg: 18 }, { label: 'النهائي', max: 40, student: 31, avg: 28 }] },
                { code: 'MATH201', name: 'إحصاء هندسي', total: 88, grade: 'ب+', components: [{ label: 'العملي', max: 25, student: 23, avg: 20 }, { label: 'النصفي', max: 25, student: 20, avg: 18 }, { label: 'النهائي', max: 50, student: 45, avg: 35 }] },
                { code: 'PHYS101', name: 'فيزياء عامة', total: 55, grade: 'هـ (راسب)', components: [{ label: 'العملي', max: 25, student: 10, avg: 18 }, { label: 'النصفي', max: 25, student: 12, avg: 16 }, { label: 'النهائي', max: 50, student: 33, avg: 30 }] }
            ];
            const getScoreColor = (score, max) => { const pct = (score / max) * 100; if (pct >= 90) return 'bg-emerald-600 text-emerald-100'; if (pct >= 80) return 'bg-lime-400 text-lime-900'; if (pct >= 60) return 'bg-yellow-400 text-yellow-900'; return 'bg-red-500 text-white'; };
            const getScoreColorText = (score, max) => { const pct = (score / max) * 100; if (pct >= 90) return 'text-emerald-700'; if (pct >= 80) return 'text-lime-600'; if (pct >= 60) return 'text-yellow-600'; return 'text-red-600'; };
            const chartMax = 4.0;
            const chartPoints = gpaTrend.map((item, index) => { const x = 10 + (index / (gpaTrend.length - 1)) * 80; const y = 60 - ((item.gpa / chartMax) * 50); return { x, y, ...item }; });
            const pathData = "M" + chartPoints.map(p => `${p.x},${p.y}`).join(" L");

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.results} onBack={onBack} extra={<button className="text-primary hover:bg-primary/10 p-2 rounded-lg transition"><Download size={20}/></button>} />
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="bg-gradient-to-br from-primary to-teal-800 p-6 rounded-2xl text-white shadow-lg relative overflow-hidden flex flex-col justify-center">
                            <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -translate-y-10 translate-x-10"></div>
                            <div className="text-sm opacity-80 mb-2 font-medium">المعدل التراكمي (GPA)</div>
                            <div className="flex items-end gap-3"><span className="text-6xl font-bold tracking-tight">3.35</span><span className="text-xl opacity-70 mb-2">/ 4.00</span></div>
                            <div className="mt-4 flex gap-2"><div className="text-xs bg-lime-400 text-lime-900 inline-flex items-center gap-1 px-3 py-1 rounded-full font-bold shadow-sm"><Award size={12}/> جيد جداً</div><div className="text-xs bg-red-600 text-white inline-flex items-center gap-1 px-3 py-1 rounded-full font-bold shadow-sm border border-red-500"><TrendingUp size={12} className="rotate-180"/> أقل بـ 0.45</div></div>
                        </div>
                        <div className="lg:col-span-2 bg-white dark:bg-dark-card p-6 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm flex flex-col">
                            <h3 className="text-sm font-bold text-gray-700 dark:text-gray-300 mb-6 flex items-center gap-2"><TrendingUp size={16} className="text-primary"/> تطور المعدل الأكاديمي</h3>
                            <div className="flex-1 w-full relative px-4 pb-2"><svg viewBox="0 0 100 80" className="w-full h-full overflow-visible" preserveAspectRatio="none"><line x1="0" y1="22.5" x2="100" y2="22.5" stroke="#e5e7eb" strokeWidth="0.5" strokeDasharray="2" /><line x1="0" y1="35" x2="100" y2="35" stroke="#e5e7eb" strokeWidth="0.5" strokeDasharray="2" /><line x1="0" y1="47.5" x2="100" y2="47.5" stroke="#e5e7eb" strokeWidth="0.5" strokeDasharray="2" /><path d={pathData} fill="none" stroke="#006771" strokeWidth="1.5" strokeLinecap="round" vectorEffect="non-scaling-stroke" /><defs><linearGradient id="gradientArea" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stopColor="#006771" stopOpacity="0.2"/><stop offset="100%" stopColor="#006771" stopOpacity="0"/></linearGradient></defs><path d={`${pathData} L${chartPoints[chartPoints.length-1].x},80 L${chartPoints[0].x},80 Z`} fill="url(#gradientArea)" stroke="none" opacity="0.5" />{chartPoints.map((p, i) => (<g key={i}><circle cx={p.x} cy={p.y} r="1.5" fill="#fff" stroke="#006771" strokeWidth="0.5" className="hover:r-2 transition-all cursor-pointer"/><text x={p.x} y={p.y - 4} textAnchor="middle" fontSize="3" fill="#006771" fontWeight="bold">{p.gpa}</text><text x={p.x} y="72" textAnchor="middle" fontSize="3" fill="#6b7280" className="font-bold">{p.sem}</text></g>))}</svg></div>
                        </div>
                    </div>
                    <div className="space-y-4">
                        <h3 className="font-bold text-gray-800 dark:text-white text-lg border-r-4 border-primary pr-3">تفاصيل درجات الفصل الحالي</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {detailedResults.map((course, idx) => (
                                <div key={idx} className={`bg-white dark:bg-dark-card rounded-xl border shadow-sm overflow-hidden flex flex-col ${course.total < 60 ? 'border-red-200 dark:border-red-900/50' : 'border-gray-200 dark:border-gray-700'}`}>
                                    <div className={`p-4 border-b flex justify-between items-start ${course.total < 60 ? 'bg-red-50 dark:bg-red-900/10 border-red-100' : 'bg-gray-50/50 dark:bg-gray-800/50 border-gray-100 dark:border-gray-700'}`}>
                                        <div><h4 className="font-bold text-gray-800 dark:text-white text-sm">{course.name}</h4><span className="text-[10px] font-mono text-gray-500 bg-white dark:bg-gray-700 border px-1.5 py-0.5 rounded mt-1 inline-block">{course.code}</span></div>
                                        <div className="text-center"><div className={`text-xl font-bold ${getScoreColorText(course.total, 100)}`}>{course.total}</div><div className={`text-[10px] font-bold px-2 py-0.5 rounded whitespace-nowrap ${getScoreColor(course.total, 100)}`}>{course.grade}</div></div>
                                    </div>
                                    <div className="p-4 space-y-4 flex-1">
                                        <div className="flex justify-between items-center text-[10px] text-gray-400 mb-2"><span>التقييم</span><div className="flex gap-3"><span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-primary"></div> درجاتك</span><span className="flex items-center gap-1"><div className="w-0.5 h-3 bg-gray-400"></div> متوسط الشعبة</span></div></div>
                                        {course.components.map((comp, cIdx) => (
                                            <div key={cIdx} className="group">
                                                <div className="flex justify-between items-end mb-1"><span className="text-xs font-bold text-gray-600 dark:text-gray-400">{comp.label}</span><div className="flex items-end gap-1"><span className={`text-sm font-bold font-mono ${getScoreColorText(comp.student, comp.max)}`}>{comp.student}</span><span className="text-[10px] text-gray-400">/ {comp.max}</span></div></div>
                                                <div className="relative h-2.5 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-visible"><div className={`absolute top-0 right-0 h-full rounded-full ${getScoreColor(comp.student, comp.max).split(' ')[0]}`} style={{ width: `${(comp.student / comp.max) * 100}%` }}></div><div className="absolute top-[-2px] bottom-[-2px] w-0.5 bg-gray-800 dark:bg-white z-10 shadow-[0_0_2px_rgba(0,0,0,0.5)]" style={{ right: `${(comp.avg / comp.max) * 100}%` }} title={`متوسط الشعبة: ${comp.avg}`}></div></div><div className="text-[9px] text-gray-400 text-left mt-0.5 dir-ltr font-mono">Avg: {comp.avg}</div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className={`p-3 border-t flex justify-between items-center ${course.total < 60 ? 'bg-red-50 dark:bg-red-900/10 border-red-100' : 'bg-gray-50 dark:bg-gray-800/50 border-gray-100 dark:border-gray-700'}`}><span className="text-xs font-bold text-gray-500">المجموع النهائي</span><span className="text-sm font-bold font-mono text-gray-800 dark:text-white">{course.total} / 100</span></div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // 4. جدول الاختبارات
        const ExamsPage = ({ onBack }) => {
            const [selectedExam, setSelectedExam] = useState(null);
            const exams = [
                { id: 1, name: 'أمن المعلومات', code: 'CS320', date: '2024-05-15', time: '09:00 - 11:00', location: 'مبنى قاعة الملك سعود', room: 'قاعة أ', seat: '45', status: 'upcoming', instructions: ['إحضار الهوية الجامعية', 'ممنوع استخدام الآلة الحاسبة', 'الحضور قبل الموعد بـ 15 دقيقة'] },
                { id: 2, name: 'إحصاء هندسي', code: 'MATH201', date: '2024-05-18', time: '08:00 - 10:00', location: 'كلية الحاسب', room: '101', seat: '12', status: 'upcoming', instructions: ['إحضار الآلة الحاسبة (غير المبرمجة)', 'قلم رصاص HB2'] },
                { id: 3, name: 'ثقافة إسلامية 3', code: 'ISL103', date: '2024-05-22', time: '13:00 - 14:00', location: 'مبنى الفصول المشتركة', room: '205', seat: '88', status: 'upcoming', instructions: ['اختبار موضوعي (تظليل)', 'إحضار الهوية'] },
                { id: 4, name: 'مشروع تخرج 1', code: 'GP401', date: '2024-05-25', time: '10:00 - 12:00', location: 'مبنى الحاسب', room: 'المعمل الرئيسي', seat: '-', status: 'upcoming', instructions: ['تسليم التقرير مطبوع', 'عرض تقديمي 10 دقائق'] }
            ];
            const nextExam = exams[0];
            const daysLeft = 5;

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="جدول الاختبارات النهائية" onBack={onBack} extra={<button className="text-primary bg-primary/10 px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-primary/20 transition"><Printer size={18}/> طباعة البطاقة</button>} />
                    <div className="bg-gradient-to-r from-primary to-teal-800 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                        <div className="relative z-10 flex flex-col md:flex-row justify-between items-center gap-6">
                            <div className="text-center md:text-right">
                                <div className="inline-block px-3 py-1 bg-white/20 rounded-full text-xs font-bold mb-2 backdrop-blur-sm border border-white/10">الاختبار القادم</div>
                                <h2 className="text-3xl font-bold mb-1">{nextExam.name}</h2>
                                <p className="text-teal-100 text-sm flex items-center justify-center md:justify-start gap-2 opacity-90"><Clock size={16}/> {nextExam.date} • {nextExam.time}</p>
                            </div>
                            <div className="flex gap-4 items-center bg-white/10 p-4 rounded-2xl border border-white/10 backdrop-blur-md">
                                <div className="text-center"><span className="block text-2xl font-bold font-mono">{daysLeft}</span><span className="text-[10px] text-teal-200">أيام</span></div><div className="w-px h-8 bg-white/20"></div>
                                <div className="text-center"><span className="block text-2xl font-bold font-mono">14</span><span className="text-[10px] text-teal-200">ساعة</span></div><div className="w-px h-8 bg-white/20"></div>
                                <div className="text-center"><span className="block text-2xl font-bold font-mono">30</span><span className="text-[10px] text-teal-200">دقيقة</span></div>
                            </div>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {exams.map((exam) => (
                            <button key={exam.id} onClick={() => setSelectedExam(exam)} className="group relative bg-white dark:bg-dark-card border border-gray-200 dark:border-gray-700 rounded-2xl p-5 hover:border-primary dark:hover:border-primary hover:shadow-lg transition-all text-right flex items-stretch overflow-hidden">
                                <div className="absolute top-0 right-0 w-1.5 h-full bg-gray-200 group-hover:bg-primary transition-colors"></div>
                                <div className="flex flex-col items-center justify-center pl-4 border-l border-gray-100 dark:border-gray-700 min-w-[80px]"><span className="text-3xl font-bold text-gray-800 dark:text-white font-mono">{exam.date.split('-')[2]}</span><span className="text-xs font-bold text-gray-500 uppercase">مايو</span></div>
                                <div className="flex-1 pr-4 py-1"><div className="flex justify-between items-start mb-2"><div><h3 className="font-bold text-lg text-gray-800 dark:text-white group-hover:text-primary transition-colors">{exam.name}</h3><span className="text-xs font-mono text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded">{exam.code}</span></div><div className="bg-gray-50 dark:bg-gray-800 p-2 rounded-lg text-gray-400 group-hover:text-primary transition-colors"><ArrowRight size={20} className="rotate-180" /></div></div><div className="flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400 mt-3"><span className="flex items-center gap-1.5"><Clock size={14}/> {exam.time}</span><span className="flex items-center gap-1.5"><MapPin size={14}/> {exam.room}</span></div></div>
                            </button>
                        ))}
                    </div>
                    {selectedExam && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onClick={() => setSelectedExam(null)}>
                            <div className="bg-white dark:bg-dark-card w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 transform transition-all scale-100 flex flex-col" onClick={e => e.stopPropagation()}>
                                <div className="relative h-32 bg-primary flex items-center justify-center overflow-hidden">
                                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                                    <div className="absolute -bottom-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
                                    <button onClick={() => setSelectedExam(null)} className="absolute top-4 right-4 bg-black/20 text-white p-2 rounded-full hover:bg-black/40 transition z-10"><X size={20}/></button>
                                    <div className="text-center relative z-10"><h3 className="text-2xl font-bold text-white mb-1">{selectedExam.name}</h3><span className="inline-block bg-white/20 text-white text-xs px-3 py-1 rounded-full font-mono backdrop-blur-sm">{selectedExam.code}</span></div>
                                </div>
                                <div className="p-6 space-y-6">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-2xl text-center border border-gray-100 dark:border-gray-700"><span className="block text-xs text-gray-500 mb-1">رقم المقعد</span><span className="block text-2xl font-bold text-primary font-mono">{selectedExam.seat}</span></div>
                                        <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-2xl text-center border border-gray-100 dark:border-gray-700"><span className="block text-xs text-gray-500 mb-1">القاعة</span><span className="block text-lg font-bold text-gray-800 dark:text-white">{selectedExam.room}</span></div>
                                    </div>
                                    <div className="space-y-4">
                                        <div className="flex items-start gap-4"><div className="p-2.5 bg-blue-50 text-blue-600 rounded-xl mt-1"><Calendar size={20}/></div><div><h4 className="font-bold text-gray-800 dark:text-white text-sm">التاريخ والوقت</h4><p className="text-sm text-gray-500 dark:text-gray-400 mt-0.5">{selectedExam.date}</p><p className="text-sm text-gray-800 dark:text-gray-200 font-bold font-mono dir-ltr text-right">{selectedExam.time}</p></div></div>
                                        <div className="flex items-start gap-4"><div className="p-2.5 bg-purple-50 text-purple-600 rounded-xl mt-1"><MapPin size={20}/></div><div><h4 className="font-bold text-gray-800 dark:text-white text-sm">الموقع التفصيلي</h4><p className="text-sm text-gray-500 dark:text-gray-400 mt-0.5">{selectedExam.location}</p></div></div>
                                        <div className="flex items-start gap-4"><div className="p-2.5 bg-orange-50 text-orange-600 rounded-xl mt-1"><AlertCircle size={20}/></div><div><h4 className="font-bold text-gray-800 dark:text-white text-sm">تعليمات هامة</h4><ul className="text-sm text-gray-500 dark:text-gray-400 mt-1 list-disc list-inside space-y-1">{selectedExam.instructions.map((inst, i) => (<li key={i}>{inst}</li>))}</ul></div></div>
                                    </div>
                                </div>
                                <div className="p-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"><button onClick={() => setSelectedExam(null)} className="w-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white font-bold py-3 rounded-xl hover:bg-gray-300 dark:hover:bg-gray-600 transition">إغلاق</button></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 5. سجل الغياب
        const AbsencesPage = ({ onBack }) => {
            const courses = [
                { name: 'برمجة متقدمة', code: 'CS204', absencePct: 0, excused: false, totalHours: 48, absentHours: 0, records: [] },
                { name: 'تحليل كيميائي', code: 'CH202', absencePct: 12, excused: false, totalHours: 32, absentHours: 4, records: [{ date: '2024-02-12', day: 'الاثنين', hours: 2, status: 'unexcused', note: 'غائب' }, { date: '2024-03-04', day: 'الاثنين', hours: 2, status: 'unexcused', note: 'غائب' }] },
                { name: 'إحصاء هندسي', code: 'MATH201', absencePct: 20, excused: true, totalHours: 40, absentHours: 8, records: [{ date: '2024-01-28', day: 'الأحد', hours: 2, status: 'excused', note: 'تقرير طبي #442' }, { date: '2024-02-11', day: 'الأحد', hours: 2, status: 'excused', note: 'عذر مقبول' }, { date: '2024-03-10', day: 'الأحد', hours: 2, status: 'unexcused', note: 'غائب' }, { date: '2024-03-24', day: 'الأحد', hours: 2, status: 'excused', note: 'ظرف عائلي' }] },
                { name: 'فيزياء عامة', code: 'PHYS101', absencePct: 25, excused: true, totalHours: 60, absentHours: 15, records: [{ date: '2024-02-05', day: 'الاثنين', hours: 4, status: 'unexcused', note: 'غائب' }, { date: '2024-03-11', day: 'الاثنين', hours: 2, status: 'unexcused', note: 'غائب' }, { date: '2024-04-01', day: 'الاثنين', hours: 4, status: 'excused', note: 'مراجعة مستشفى' }] },
            ];

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="سجل الغياب والحضور" onBack={onBack} extra={<div className="bg-primary/10 text-primary px-3 py-1 rounded-lg text-sm font-bold border border-primary/20 flex items-center gap-2"><FileText size={16}/> لائحة الغياب</div>} />
                    <div className="grid grid-cols-1 gap-6">
                        {courses.map((course, idx) => {
                            const progressPercent = Math.min((course.absencePct / 25) * 100, 100);
                            let statusColor = "bg-green-500";
                            let statusText = ""; 
                            
                            // Logic for Horman (Denial) & Warnings
                            if (course.absencePct === 0) { 
                                statusColor = "bg-emerald-500"; 
                                statusText = "مثالي! واصل تميزك 🌟"; 
                            } 
                            else if (course.absencePct < 10) { 
                                statusColor = "bg-green-500"; 
                                statusText = "آمن"; 
                            } 
                            else if (course.absencePct >= 10 && course.absencePct < 15) { 
                                statusColor = "bg-yellow-500"; 
                                statusText = "تحذير"; 
                            } 
                            else if (course.absencePct >= 25) {
                                // Horman (Denial) regardless of excuse if >= 25%
                                statusColor = "bg-red-600";
                                statusText = "حرمان (تجاوز الحد)";
                            }
                            else if (course.absencePct >= 15) { 
                                if (course.excused) { 
                                    // High but excused (below 25%)
                                    statusColor = "bg-orange-400"; 
                                    statusText = "مرتفع (بعذر)"; 
                                } else { 
                                    // Unexcused >= 15% -> Denial
                                    statusColor = "bg-red-600"; 
                                    statusText = "حرمان"; 
                                } 
                            }

                            return (
                                <div key={idx} className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden">
                                    <div className="p-6 border-b border-gray-100 dark:border-gray-700">
                                        <div className="flex justify-between items-center mb-4">
                                            <div><h3 className="font-bold text-lg text-gray-800 dark:text-white flex items-center gap-2">{course.name}<span className="text-xs font-normal text-gray-500 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full font-mono">{course.code}</span></h3><div className="text-xs text-gray-500 mt-1 flex gap-3"><span>إجمالي الساعات: {course.totalHours}</span><span className="text-red-500">ساعات الغياب: {course.absentHours}</span></div></div>
                                            <div className="text-left">{statusText && (<span className={`block text-xs px-2 py-1 rounded font-bold text-white shadow-sm mb-1 text-center ${statusColor}`}>{statusText}</span>)}<span className={`text-xl font-bold font-mono ${course.absencePct >= 15 && !course.excused ? 'text-red-500' : 'text-gray-700 dark:text-gray-300'}`}>{course.absencePct}%</span></div>
                                        </div>
                                        <div className="relative w-full h-10"><div className="absolute top-3 w-full h-3 bg-gray-100 dark:bg-gray-700 rounded-full overflow-visible"><div className="absolute inset-0 rounded-full overflow-hidden"><div className={`h-full transition-all duration-1000 ${statusColor}`} style={{ width: `${progressPercent}%` }}></div></div><div className="absolute -top-1 bottom-0 w-0.5 bg-gray-300 dark:bg-gray-600 z-10" style={{ right: '60%' }}></div><div className="absolute top-4 text-[9px] font-bold text-gray-400 translate-x-1/2" style={{ right: '60%' }}>15%</div><div className="absolute -top-1 bottom-0 w-0.5 bg-red-300 dark:bg-red-800 z-10" style={{ right: '99%' }}></div><div className="absolute top-4 text-[9px] font-bold text-red-400 translate-x-full" style={{ right: '99%' }}>25%</div><div className="absolute top-4 text-[9px] text-gray-400" style={{ right: '0%' }}>0%</div></div></div>
                                    </div>
                                    {course.records.length > 0 ? (
                                        <div className="bg-gray-50 dark:bg-gray-800/30">
                                            <div className="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-100 dark:border-gray-700">سجل الأيام</div>
                                            <div className="divide-y divide-gray-100 dark:divide-gray-700">
                                                {course.records.map((rec, rIdx) => {
                                                    const percentage = ((rec.hours / course.totalHours) * 100).toFixed(1);
                                                    return (
                                                        <div key={rIdx} className="px-6 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800 transition">
                                                            <div className="flex items-center gap-4"><div className={`p-2 rounded-lg ${rec.status === 'excused' ? 'bg-orange-100 text-orange-600' : 'bg-red-100 text-red-600'}`}><Calendar size={16}/></div><div><p className="text-sm font-bold text-gray-800 dark:text-gray-200">{rec.day} <span className="font-mono font-normal text-gray-500 text-xs dir-ltr">{rec.date}</span></p><div className="text-xs text-gray-500 flex items-center gap-1 mt-1"><span className="font-bold">{rec.hours} ساعات</span><span className="text-red-500 font-mono text-[10px] bg-red-50 dark:bg-red-900/30 px-1.5 rounded border border-red-100 dark:border-red-900">({percentage}%)</span><span className="text-gray-300 mx-1">•</span><span>{rec.note}</span></div></div></div>
                                                            <span className={`text-[10px] font-bold px-2 py-1 rounded ${rec.status === 'excused' ? 'bg-orange-100 text-orange-700' : 'bg-red-100 text-red-700'}`}>{rec.status === 'excused' ? 'بعذر' : 'بدون عذر'}</span>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ) : <div className="p-6 text-center text-gray-400 text-sm flex flex-col items-center gap-2"><CheckCircle2 size={24} className="text-emerald-500 opacity-50"/>لا توجد غيابات مسجلة لهذه المادة</div>}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // 6. السجل الأكاديمي
        const AcademicRecordPage = ({ onBack }) => {
            const recordData = {
                student: { name: "فيصل عبدالله الخالد", id: "444002548", college: "الحاسب الآلي ونظم المعلومات", major: "هندسة البرمجيات", plan: "طالب بكالوريوس - خطة 2022", status: "منتظم", warnings: 0 },
                semesters: [
                    { term: "الفصل الدراسي الأول 1445", courses: [ { code: "SE301", name: "هندسة برمجيات", hours: 3, earned: 3, grade: "أ+", points: "95" }, { code: "CS305", name: "نظم تشغيل", hours: 3, earned: 3, grade: "ج+", points: "78" }, { code: "MATH201", name: "إحصاء هندسي", hours: 2, earned: 2, grade: "ب+", points: "88" }, { code: "PHYS101", name: "فيزياء عامة", hours: 4, earned: 0, grade: "هـ", points: "55" } ], gpaSem: 3.15, gpaCum: 3.35 },
                    { term: "الفصل الدراسي الثاني 1444", courses: [ { code: "CS204", name: "برمجة 2", hours: 4, earned: 4, grade: "أ", points: "92" }, { code: "CS205", name: "قواعد بيانات", hours: 3, earned: 3, grade: "ب+", points: "86" }, { code: "ISL102", name: "ثقافة إسلامية 2", hours: 2, earned: 2, grade: "أ+", points: "98" } ], gpaSem: 3.80, gpaCum: 3.45 }
                ]
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="السجل الأكاديمي" onBack={onBack} extra={<button className="hidden md:flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-teal-700 transition"><Printer size={16}/> طباعة السجل</button>} />
                    <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 p-6 shadow-sm">
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-sm">
                            <div><span className="block text-gray-500 text-xs mb-1">الكلية</span><span className="font-bold text-gray-800 dark:text-white">{recordData.student.college}</span></div>
                            <div><span className="block text-gray-500 text-xs mb-1">التخصص</span><span className="font-bold text-gray-800 dark:text-white">{recordData.student.major}</span></div>
                            <div><span className="block text-gray-500 text-xs mb-1">نوع الخطة</span><span className="font-bold text-gray-800 dark:text-white">{recordData.student.plan}</span></div>
                            <div><span className="block text-gray-500 text-xs mb-1">الوضع الأكاديمي</span><span className="inline-flex items-center gap-2 font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded border border-emerald-100">{recordData.student.status} <CheckCircle2 size={14}/></span></div>
                            <div><span className="block text-gray-500 text-xs mb-1">عدد الإنذارات</span><span className={`font-bold ${recordData.student.warnings > 0 ? 'text-red-600' : 'text-gray-800 dark:text-white'}`}>{recordData.student.warnings}</span></div>
                        </div>
                    </div>
                    {recordData.semesters.map((sem, idx) => {
                        const totalEarned = sem.courses.reduce((acc, course) => acc + course.earned, 0);
                        return (
                            <div key={idx} className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden">
                                <div className="bg-gray-50 dark:bg-gray-800/50 p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"><h3 className="font-bold text-primary text-base flex items-center gap-2"><div className="w-1.5 h-6 bg-primary rounded-full"></div>{sem.term}</h3></div>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-right text-sm">
                                        <thead className="bg-white dark:bg-gray-800 border-b dark:border-gray-700 text-gray-500 text-xs uppercase tracking-wider"><tr><th className="p-4">رمز المقرر</th><th className="p-4">اسم المقرر</th><th className="p-4 text-center">الساعات</th><th className="p-4 text-center">المكتسبة</th><th className="p-4 text-center">الدرجة</th><th className="p-4 text-center">النقاط</th></tr></thead>
                                        <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                            {sem.courses.map((course, cIdx) => (
                                                <tr key={cIdx} className="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition">
                                                    <td className="p-4 font-mono text-gray-600">{course.code}</td><td className="p-4 font-bold text-gray-800 dark:text-white">{course.name}</td><td className="p-4 text-center text-gray-600">{course.hours}</td><td className="p-4 text-center text-gray-600">{course.earned}</td>
                                                    <td className="p-4 text-center"><span className={`px-2 py-1 rounded text-xs font-bold ${course.grade.includes('هـ') || course.grade === 'ح' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>{course.grade}</span></td>
                                                    <td className="p-4 text-center font-mono font-bold text-gray-700 dark:text-gray-300">{course.points}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                        <tfoot className="bg-gray-50 dark:bg-gray-800/50 border-t border-gray-200 dark:border-gray-700">
                                            <tr>
                                                <td colSpan="6" className="p-4">
                                                    <div className="flex flex-col sm:flex-row justify-end gap-4 sm:gap-8 text-sm">
                                                        <div className="flex items-center justify-between sm:justify-start gap-2 bg-emerald-50 dark:bg-emerald-900/20 px-4 py-2 rounded-lg border border-emerald-100 dark:border-emerald-800 shadow-sm"><span className="text-gray-500 dark:text-gray-400 text-xs">ساعات مكتسبة</span><span className="font-bold text-lg text-emerald-600 dark:text-emerald-400 font-mono">{totalEarned}</span></div>
                                                        <div className="flex items-center justify-between sm:justify-start gap-2 bg-white dark:bg-gray-700 px-4 py-2 rounded-lg border border-gray-100 dark:border-gray-600 shadow-sm"><span className="text-gray-500 dark:text-gray-400 text-xs">المعدل الفصلي</span><span className="font-bold text-lg text-primary font-mono">{sem.gpaSem}</span></div>
                                                        <div className="flex items-center justify-between sm:justify-start gap-2 bg-primary/5 dark:bg-primary/20 px-4 py-2 rounded-lg border border-primary/10 dark:border-primary/30 shadow-sm"><span className="text-gray-500 dark:text-gray-400 text-xs">المعدل التراكمي</span><span className="font-bold text-lg text-primary font-mono">{sem.gpaCum}</span></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        };

        // 7. الحذف والإضافة
        const AddDropPage = ({ onBack, t }) => {
            const [availableCourses, setAvailableCourses] = useState([ { code: 'PHYS101', name: 'فيزياء عامة', hours: 4, sections: [ { id: 's1', section: '302', prof: 'د. سامي الحربي', time: '10:00 - 11:50', days: 'الأحد - الثلاثاء', status: 'open' }, { id: 's2', section: '305', prof: 'أ. ماجد الفهمي', time: '08:00 - 09:50', days: 'الاثنين - الأربعاء', status: 'open' }, { id: 's3', section: '308', prof: 'د. روبرت', time: '13:00 - 14:50', days: 'الأحد - الثلاثاء', status: 'closed' } ] }, { code: 'ISL101', name: 'ثقافة إسلامية', hours: 2, sections: [ { id: 's4', section: '401', prof: 'د. عبدالرحمن', time: '08:00 - 08:50', days: 'عن بعد', status: 'open' }, { id: 's5', section: '402', prof: 'د. عبدالله', time: '09:00 - 09:50', days: 'عن بعد', status: 'open' } ] }, { code: 'CS204', name: 'تراكيب بيانات', hours: 3, sections: [ { id: 's6', section: '201', prof: 'د. علي القحطاني', time: '10:00 - 10:50', days: 'الأحد - الثلاثاء - الخميس', status: 'open' } ] } ]);
            const [enrolled, setEnrolled] = useState([ { id: 1, code: 'CS101', name: 'مقدمة في البرمجة', hours: 3, section: '201', prof: 'د. خالد', time: '08:00 - 08:50' }, { id: 2, code: 'MATH101', name: 'تفاضل وتكامل', hours: 4, section: '105', prof: 'د. مصطفى', time: '09:00 - 09:50' } ]);
            const [filterTime, setFilterTime] = useState('');
            const [selectedCourseForAdd, setSelectedCourseForAdd] = useState(null);
            const [confirmationModal, setConfirmationModal] = useState(null); 
            const [message, setMessage] = useState(null);
            
            // --- NEW: Timer State Logic ---
            const [timeLeft, setTimeLeft] = useState({ days: 2, hours: 14, minutes: 30, seconds: 59 });

            useEffect(() => {
                const timer = setInterval(() => {
                    setTimeLeft(prev => {
                        if (prev.seconds > 0) return { ...prev, seconds: prev.seconds - 1 };
                        if (prev.minutes > 0) return { ...prev, minutes: prev.minutes - 1, seconds: 59 };
                        if (prev.hours > 0) return { ...prev, hours: prev.hours - 1, minutes: 59, seconds: 59 };
                        if (prev.days > 0) return { ...prev, days: prev.days - 1, hours: 23, minutes: 59, seconds: 59 };
                        return prev; 
                    });
                }, 1000);
                return () => clearInterval(timer);
            }, []);
            // -----------------------------

            const filteredAvailable = availableCourses.filter(course => { if (!filterTime) return true; return course.sections.some(sec => sec.time.includes(filterTime)); });
            const handleDropClick = (course) => { setConfirmationModal({ type: 'drop', item: course, title: 'تأكيد الحذف', text: `هل أنت متأكد من رغبتك في حذف مقرر ${course.name}؟` }); };
            const handleAddClick = (course) => { setSelectedCourseForAdd(course); };
            const handleSectionSelect = (course, section) => { if (section.status === 'closed') { setMessage({ text: 'عذراً، هذه الشعبة مغلقة', type: 'error' }); setTimeout(() => setMessage(null), 3000); return; } setConfirmationModal({ type: 'add', item: { ...course, ...section, id: Date.now() }, title: 'تأكيد الإضافة', text: `هل أنت متأكد من إضافة ${course.name} - شعبة ${section.section}؟` }); };
            const executeAction = () => { const action = confirmationModal.type; const item = confirmationModal.item; if (action === 'drop') { setEnrolled(enrolled.filter(c => c.id !== item.id)); setMessage({ text: 'تم حذف المقرر بنجاح', type: 'success' }); } else if (action === 'add') { setEnrolled([...enrolled, item]); setSelectedCourseForAdd(null); setMessage({ text: 'تم إضافة المقرر بنجاح', type: 'success' }); } setConfirmationModal(null); setTimeout(() => setMessage(null), 3000); };
            
            return (
                <div className="animate-fade-in space-y-6 relative">
                    <HeaderPage title="التسجيل الإلكتروني (الحذف والإضافة)" onBack={onBack} extra={<div className="flex gap-2"><span className="bg-primary/10 text-primary px-3 py-1 rounded-lg text-xs font-bold border border-primary/20">المسجل: {enrolled.reduce((acc, c) => acc + c.hours, 0)} ساعات</span></div>} />
                    
                    {/* --- NEW: Countdown Timer Component --- */}
                    <div className="bg-gradient-to-l from-primary to-teal-800 rounded-2xl p-6 text-white shadow-lg flex flex-col md:flex-row items-center justify-between gap-6 relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        
                        <div className="relative z-10 text-center md:text-right">
                            <h3 className="text-xl font-bold mb-1 flex items-center justify-center md:justify-start gap-2">
                                <Clock className="animate-pulse" size={24}/> يغلق الحذف والإضافة خلال
                            </h3>
                            <p className="text-teal-100 text-sm opacity-90">بادر بتعديل جدولك قبل إغلاق النظام</p>
                        </div>

                        <div className="relative z-10 flex gap-4">
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.days}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">يوم</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.hours}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">ساعة</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.minutes}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">دقيقة</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.seconds}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">ثانية</span>
                            </div>
                        </div>
                    </div>
                    {/* -------------------------------------- */}

                    {message && <div className={`fixed top-4 left-1/2 -translate-x-1/2 px-6 py-3 rounded-full shadow-xl text-white font-bold text-sm flex items-center gap-2 z-[60] animate-fade-in ${message.type === 'success' ? 'bg-green-600' : 'bg-red-600'}`}>{message.type === 'success' ? <CheckCircle2 size={18}/> : <AlertTriangle size={18}/>}{message.text}</div>}
                    {confirmationModal && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
                            <div className="bg-white dark:bg-dark-card w-full max-w-sm rounded-2xl shadow-2xl p-6 border border-gray-100 dark:border-gray-700">
                                <div className={`w-12 h-12 rounded-full flex items-center justify-center mb-4 mx-auto ${confirmationModal.type === 'add' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}>{confirmationModal.type === 'add' ? <PlusCircle size={24}/> : <MinusCircle size={24}/>}</div>
                                <h3 className="text-lg font-bold text-center mb-2 text-gray-800 dark:text-white">{confirmationModal.title}</h3><p className="text-sm text-gray-500 text-center mb-6">{confirmationModal.text}</p>
                                <div className="flex gap-3"><button onClick={executeAction} className={`flex-1 py-2.5 rounded-xl text-white font-bold transition ${confirmationModal.type === 'add' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`}>تأكيد</button><button onClick={() => setConfirmationModal(null)} className="flex-1 py-2.5 rounded-xl bg-gray-100 text-gray-700 font-bold hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300">إلغاء</button></div>
                            </div>
                        </div>
                    )}
                    {selectedCourseForAdd && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onClick={() => setSelectedCourseForAdd(null)}>
                            <div className="bg-white dark:bg-dark-card w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
                                <div className="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/80 dark:bg-gray-800/80"><div><h3 className="font-bold text-lg text-primary">{selectedCourseForAdd.name}</h3><p className="text-xs text-gray-500">اختر الشعبة المناسبة لإضافتها لجدولك</p></div><button onClick={() => setSelectedCourseForAdd(null)} className="p-2 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200"><X size={18}/></button></div>
                                <div className="overflow-y-auto p-4"><table className="w-full text-sm text-right"><thead className="text-gray-500 font-medium bg-gray-50 dark:bg-gray-800/50 rounded-lg"><tr><th className="p-3 rounded-r-lg">الشعبة</th><th className="p-3">الوقت / الأيام</th><th className="p-3">المحاضر</th><th className="p-3">الحالة</th><th className="p-3 rounded-l-lg"></th></tr></thead><tbody className="divide-y divide-gray-100 dark:divide-gray-700">{selectedCourseForAdd.sections.map((sec, idx) => (<tr key={idx} className={`hover:bg-gray-50 dark:hover:bg-gray-800/30 transition ${sec.status === 'closed' ? 'opacity-60 grayscale' : ''}`}><td className="p-3 font-bold font-mono text-primary">{sec.section}</td><td className="p-3"><div className="font-bold text-gray-800 dark:text-gray-200 dir-ltr text-right">{sec.time}</div><div className="text-[10px] text-gray-500">{sec.days}</div></td><td className="p-3 text-gray-600 dark:text-gray-400">{sec.prof}</td><td className="p-3"><span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sec.status === 'open' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{sec.status === 'open' ? 'متاح' : 'مغلق'}</span></td><td className="p-3 text-left"><button onClick={() => handleSectionSelect(selectedCourseForAdd, sec)} disabled={sec.status === 'closed'} className={`p-2 rounded-lg transition ${sec.status === 'open' ? 'bg-primary text-white hover:bg-teal-700 shadow-sm' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}><PlusCircle size={18}/></button></td></tr>))}</tbody></table></div>
                            </div>
                        </div>
                    )}
                    <div className="grid grid-cols-1 gap-6">
                        <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm p-5"><h3 className="font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2 border-b border-gray-100 pb-3"><FileCheck className="text-green-600" size={20}/> المقررات المسجلة حالياً</h3><div className="space-y-3">{enrolled.length === 0 ? <p className="text-center text-gray-400 py-4 text-sm">لا يوجد مقررات مسجلة</p> : enrolled.map(c => (<div key={c.id} className="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700 group hover:border-red-200 transition-colors"><div><div className="font-bold text-gray-800 dark:text-white flex items-center gap-2">{c.name}<span className="text-[10px] px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded font-mono text-gray-600">{c.section}</span></div><div className="text-xs text-gray-500 mt-1 flex gap-3 items-center"><span className="font-mono bg-white dark:bg-gray-700 px-1 rounded border dark:border-gray-600">{c.code}</span><span className="flex items-center gap-1"><User size={10}/> {c.prof}</span><span className="flex items-center gap-1 dir-ltr"><Clock size={10}/> {c.time}</span></div></div><button onClick={() => handleDropClick(c)} className="p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-500 hover:text-white transition shadow-sm border border-red-100"><LogOut size={18} className="rotate-180"/></button></div>))}</div></div>
                        <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm p-5"><div className="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4 border-b border-gray-100 pb-3"><h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2"><Layers className="text-primary" size={20}/> المقررات المطروحة</h3><div className="relative"><Search size={16} className="absolute top-1/2 right-3 -translate-y-1/2 text-gray-400"/><input type="text" placeholder="تصفية بالوقت (مثلاً 10:00)..." value={filterTime} onChange={(e) => setFilterTime(e.target.value)} className="w-full md:w-64 pl-4 pr-9 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 transition"/></div></div><div className="space-y-3">{filteredAvailable.length === 0 ? <p className="text-center text-gray-400 py-8 text-sm">لا توجد مواد مطابقة للبحث</p> : filteredAvailable.map(c => (<div key={c.code} className="flex justify-between items-center p-4 bg-white border border-gray-200 dark:border-gray-700 rounded-xl hover:border-primary transition shadow-sm"><div><div className="font-bold text-gray-800 dark:text-white text-base">{c.name}</div><div className="text-xs text-gray-500 mt-1 flex gap-3"><span className="font-mono bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded">{c.code}</span><span>{c.hours} ساعات معتمدة</span><span className="text-primary font-bold">{c.sections.length} شعب متاحة</span></div></div><button onClick={() => handleAddClick(c)} className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg text-xs font-bold hover:bg-teal-700 shadow-sm transition-transform active:scale-95"><PlusCircle size={16}/> إضافة</button></div>))}</div></div>
                    </div>
                </div>
            );
        };

        // 8. المقررات المطروحة (بحث عام)
        const OfferedCoursesPage = ({ onBack }) => {
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCourse, setSelectedCourse] = useState(null);

            const courses = [
                { 
                    code: 'MATH101', name: 'تفاضل وتكامل 1', college: 'العلوم الأساسية',
                    sections: [
                        { section: '101', time: '08:00 - 09:50', days: 'الأحد - الثلاثاء', prof: 'د. أحمد سالم', status: 'open' },
                        { section: '102', time: '10:00 - 11:50', days: 'الاثنين - الأربعاء', prof: 'د. محمد علي', status: 'closed' }
                    ]
                },
                { 
                    code: 'CS101', name: 'مقدمة في البرمجة', college: 'الحاسب الآلي',
                    sections: [
                        { section: '201', time: '08:00 - 08:50', days: 'الأحد - الثلاثاء - الخميس', prof: 'أ. خالد', status: 'open' },
                        { section: '202', time: '09:00 - 09:50', days: 'الأحد - الثلاثاء - الخميس', prof: 'د. سارة', status: 'open' },
                        { section: '203', time: '13:00 - 13:50', days: 'الاثنين - الأربعاء', prof: 'د. عمر', status: 'open' }
                    ]
                },
                { 
                    code: 'ISL101', name: 'ثقافة إسلامية 1', college: 'الدراسات الإسلامية',
                    sections: [
                        { section: '301', time: '13:00 - 13:50', days: 'عن بعد', prof: 'د. علي', status: 'open' },
                        { section: '302', time: '14:00 - 14:50', days: 'عن بعد', prof: 'د. عبدالله', status: 'open' }
                    ]
                },
                { 
                    code: 'SE301', name: 'هندسة برمجيات', college: 'الحاسب الآلي',
                    sections: [
                        { section: '401', time: '10:00 - 11:50', days: 'الاثنين', prof: 'د. فهد', status: 'open' }
                    ]
                },
            ];

            const filtered = courses.filter(c => c.name.includes(searchTerm) || c.code.toLowerCase().includes(searchTerm.toLowerCase()));

            return (
                <div className="animate-fade-in space-y-6 relative">
                    <HeaderPage title="المقررات المطروحة" onBack={onBack} />
                    
                    {/* Modal for Sections */}
                    {selectedCourse && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onClick={() => setSelectedCourse(null)}>
                            <div className="bg-white dark:bg-dark-card w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
                                <div className="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/80 dark:bg-gray-800/80">
                                    <div>
                                        <h3 className="font-bold text-lg text-primary">{selectedCourse.name}</h3>
                                        <p className="text-xs text-gray-500 font-mono">{selectedCourse.code}</p>
                                    </div>
                                    <button onClick={() => setSelectedCourse(null)} className="p-2 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200 text-gray-500"><X size={18}/></button>
                                </div>
                                <div className="overflow-y-auto p-4">
                                    <table className="w-full text-sm text-right">
                                        <thead className="text-gray-500 font-medium bg-gray-50 dark:bg-gray-800/50 rounded-lg">
                                            <tr>
                                                <th className="p-3 rounded-r-lg">الشعبة</th>
                                                <th className="p-3">الوقت / الأيام</th>
                                                <th className="p-3">المحاضر</th>
                                                <th className="p-3 rounded-l-lg">الحالة</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                            {selectedCourse.sections.map((sec, idx) => (
                                                <tr key={idx} className="hover:bg-gray-50 dark:hover:bg-gray-800/30 transition">
                                                    <td className="p-3 font-bold font-mono text-primary">{sec.section}</td>
                                                    <td className="p-3">
                                                        <div className="font-bold text-gray-800 dark:text-gray-200 dir-ltr text-right">{sec.time}</div>
                                                        <div className="text-[10px] text-gray-500">{sec.days}</div>
                                                    </td>
                                                    <td className="p-3 text-gray-600 dark:text-gray-400">{sec.prof}</td>
                                                    <td className="p-3">
                                                        <span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sec.status === 'open' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                                            {sec.status === 'open' ? 'متاح' : 'مغلق'}
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="relative">
                        <Search className="absolute top-1/2 right-4 -translate-y-1/2 text-gray-400" size={20} />
                        <input 
                            type="text" 
                            placeholder="ابحث برمز المقرر أو الاسم..." 
                            className="w-full p-4 pr-12 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-card shadow-sm focus:ring-2 focus:ring-primary/20 outline-none dark:text-white"
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                        />
                    </div>
                    <div className="grid gap-3">
                        {filtered.map((c, i) => (
                            <div key={i} className="bg-white dark:bg-dark-card p-4 rounded-xl border border-gray-200 dark:border-gray-700 flex justify-between items-center hover:border-primary transition shadow-sm">
                                <div>
                                    <h4 className="font-bold text-gray-800 dark:text-white">{c.name}</h4>
                                    <div className="text-xs text-gray-500 mt-1 flex gap-2">
                                        <span className="bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded font-mono">{c.code}</span>
                                        <span>{c.college}</span>
                                    </div>
                                </div>
                                <button 
                                    onClick={() => setSelectedCourse(c)}
                                    className="text-primary bg-primary/5 px-4 py-2 rounded-lg text-sm font-bold hover:bg-primary/10 transition flex items-center gap-2"
                                >
                                    <Layers size={16}/>
                                    عرض الشعب
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // 9. طلبات القسم (إضافة، تغيير شعبة، حذف) - مكون موحد
        const DepartmentRequestPage = ({ onBack, type }) => {
            const titles = {
                'add': 'إضافة مقرر بموافقة القسم',
                'drop': 'حذف مقرر بموافقة القسم',
                'change': 'تغيير شعبة بموافقة القسم'
            };

            const myCourses = [
                { code: 'CS204', name: 'برمجة 2 - CS204' },
                { code: 'CS205', name: 'قواعد بيانات - CS205' },
                { code: 'ISL102', name: 'ثقافة إسلامية 2 - ISL102' }
            ];

            const offeredCourses = [
                { code: 'SE301', name: 'هندسة برمجيات - SE301' },
                { code: 'CS305', name: 'نظم تشغيل - CS305' },
                { code: 'NET201', name: 'تراسل بيانات - NET201' },
                { code: 'MATH201', name: 'إحصاء هندسي - MATH201' }
            ];

            const coursesList = type === 'add' ? offeredCourses : myCourses;
            const labelText = type === 'add' ? 'اختر المقرر المراد إضافته' : (type === 'drop' ? 'اختر المقرر المراد حذفه' : 'اختر المقرر المراد تغيير شعبته');

            const [submitted, setSubmitted] = useState(false);
            const [selectedCourse, setSelectedCourse] = useState('');

            if(submitted) {
                return (
                    <div className="animate-fade-in text-center py-20">
                        <div className="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6"><Check size={40}/></div>
                        <h3 className="text-2xl font-bold text-gray-800 dark:text-white mb-2">تم إرسال الطلب بنجاح</h3>
                        <p className="text-gray-500 mb-6">رقم الطلب: #REQ-{Math.floor(Math.random()*10000)}</p>
                        <button onClick={onBack} className="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg font-bold hover:bg-gray-200">عودة للقائمة</button>
                    </div>
                )
            }

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={titles[type]} onBack={onBack} />
                    <div className="bg-white dark:bg-dark-card p-6 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm">
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">{labelText}</label>
                                <div className="relative">
                                    <select 
                                        className="w-full p-3 pr-10 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none appearance-none text-gray-700 dark:text-gray-200"
                                        value={selectedCourse}
                                        onChange={(e) => setSelectedCourse(e.target.value)}
                                    >
                                        <option value="" disabled>-- اختر من القائمة --</option>
                                        {coursesList.map((c, i) => (
                                            <option key={i} value={c.code}>{c.name}</option>
                                        ))}
                                    </select>
                                    <ChevronDown className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" size={18}/>
                                </div>
                            </div>
                            
                            {type !== 'drop' && (
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">رقم الشعبة المطلوبة</label>
                                    <input type="number" className="w-full p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none" placeholder="مثال: 201" />
                                </div>
                            )}

                            <div>
                                <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">المبررات</label>
                                <textarea className="w-full p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none h-32" placeholder="يرجى كتابة سبب تقديم الطلب بوضوح..."></textarea>
                            </div>

                            <button 
                                onClick={() => setSubmitted(true)} 
                                disabled={!selectedCourse}
                                className={`w-full font-bold py-3 rounded-xl transition shadow-lg ${!selectedCourse ? 'bg-gray-300 text-gray-500 cursor-not-allowed shadow-none' : 'bg-primary text-white hover:bg-teal-700 shadow-primary/20'}`}
                            >
                                إرسال الطلب
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 10. طلبات التسجيل الإلكتروني
        const RegistrationRequestsPage = ({ onBack }) => {
            const requests = [
                { id: 501, type: 'إضافة مقرر', course: 'CS302', status: 'pending', date: '2024-05-10' },
                { id: 402, type: 'تغيير شعبة', course: 'MATH201', status: 'approved', date: '2024-05-08' },
                { id: 305, type: 'حذف مقرر', course: 'ISL101', status: 'rejected', date: '2024-05-01' },
            ];

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="طلبات التسجيل الإلكتروني" onBack={onBack} />
                    <div className="space-y-3">
                        {requests.map(req => (
                            <div key={req.id} className="bg-white dark:bg-dark-card p-4 rounded-xl border border-gray-200 dark:border-gray-700 flex justify-between items-center shadow-sm">
                                <div>
                                    <div className="font-bold text-gray-800 dark:text-white flex items-center gap-2">
                                        {req.type}
                                        <span className="text-xs bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded font-mono text-gray-500">{req.course}</span>
                                    </div>
                                    <div className="text-xs text-gray-400 mt-1">تاريخ الطلب: {req.date}</div>
                                </div>
                                <div>
                                    {req.status === 'pending' && <span className="bg-yellow-100 text-yellow-700 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1"><Clock size={12}/> قيد الدراسة</span>}
                                    {req.status === 'approved' && <span className="bg-green-100 text-green-700 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1"><Check size={12}/> مقبول</span>}
                                    {req.status === 'rejected' && <span className="bg-red-100 text-red-700 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1"><X size={12}/> مرفوض</span>}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // 11. طلب حركة أكاديمية (جديد)
        const NewAcademicActionPage = ({ onBack }) => {
            const [actionType, setActionType] = useState('');
            const [submitted, setSubmitted] = useState(false);

            if(submitted) {
                return (
                    <div className="animate-fade-in text-center py-20">
                        <div className="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6"><Check size={40}/></div>
                        <h3 className="text-2xl font-bold text-gray-800 dark:text-white mb-2">تم تقديم الطلب بنجاح</h3>
                        <p className="text-gray-500 mb-6">سيتم مراجعة طلبك من قبل الجهة المختصة</p>
                        <button onClick={onBack} className="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg font-bold hover:bg-gray-200">عودة</button>
                    </div>
                )
            }

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="طلب حركة أكاديمية" onBack={onBack} />
                    <div className="bg-white dark:bg-dark-card p-6 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm">
                        <div className="space-y-5">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">نوع الحركة الأكاديمية</label>
                                <div className="relative">
                                    <select 
                                        className="w-full p-3 pr-10 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none appearance-none text-gray-700 dark:text-gray-200"
                                        value={actionType}
                                        onChange={(e) => setActionType(e.target.value)}
                                    >
                                        <option value="" disabled>-- اختر نوع الحركة --</option>
                                        <option value="apology">اعتذار عن فصل دراسي</option>
                                        <option value="postpone">تأجيل الدراسة</option>
                                        <option value="reenroll">إعادة قيد</option>
                                        <option value="chance">فرصة إضافية</option>
                                    </select>
                                    <ChevronDown className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" size={18}/>
                                </div>
                            </div>

                            {actionType === 'apology' && (
                                <div className="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl border border-yellow-100 dark:border-yellow-800 text-sm text-yellow-800 dark:text-yellow-200 flex gap-2">
                                    <AlertCircle size={18} className="shrink-0"/>
                                    <p>تنبيه: الاعتذار عن الفصل الدراسي سيتم احتسابه ضمن المدة النظامية للدراسة.</p>
                                </div>
                            )}

                            <div>
                                <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">المبررات (اختياري)</label>
                                <textarea className="w-full p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none h-32" placeholder="اكتب مبررات الطلب هنا..."></textarea>
                            </div>

                            <div>
                                <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">المرفقات (تقرير طبي، إلخ)</label>
                                <div className="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-6 text-center hover:border-primary transition cursor-pointer bg-gray-50 dark:bg-gray-800/50">
                                    <Upload className="mx-auto text-gray-400 mb-2" size={24}/>
                                    <span className="text-sm text-gray-500">اضغط لرفع الملفات أو اسحبها هنا</span>
                                </div>
                            </div>

                            <button 
                                onClick={() => setSubmitted(true)} 
                                disabled={!actionType}
                                className={`w-full font-bold py-3 rounded-xl transition shadow-lg ${!actionType ? 'bg-gray-300 text-gray-500 cursor-not-allowed shadow-none' : 'bg-primary text-white hover:bg-teal-700 shadow-primary/20'}`}
                            >
                                تأكيد الطلب
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 12. عرض الحركات الأكاديمية (جديد)
        const ViewAcademicActionsPage = ({ onBack }) => {
            const actions = [
                { id: 2055, type: 'اعتذار عن فصل', term: 'الفصل الثاني 1444', status: 'approved', date: '2023-01-15' },
                { id: 1089, type: 'تأجيل دراسة', term: 'الفصل الأول 1444', status: 'rejected', date: '2022-09-01', note: 'تجاوز الحد المسموح للتأجيل' },
            ];

            const getStatusBadge = (status) => {
                if (status === 'approved') return <span className="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><Check size={12}/> مقبول</span>;
                if (status === 'rejected') return <span className="bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><X size={12}/> مرفوض</span>;
                return <span className="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><Clock size={12}/> قيد الدراسة</span>;
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="عرض الحركات الأكاديمية" onBack={onBack} />
                    {actions.length === 0 ? (
                        <div className="text-center py-10 text-gray-500">لا توجد حركات أكاديمية سابقة</div>
                    ) : (
                        <div className="space-y-4">
                            {actions.map(action => (
                                <div key={action.id} className="bg-white dark:bg-dark-card p-5 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <h4 className="font-bold text-gray-800 dark:text-white text-lg">{action.type}</h4>
                                            <p className="text-sm text-gray-500">{action.term}</p>
                                        </div>
                                        {getStatusBadge(action.status)}
                                    </div>
                                    <div className="border-t border-gray-100 dark:border-gray-700 pt-3 flex flex-col gap-2">
                                        <div className="flex justify-between text-xs text-gray-400">
                                            <span>رقم الطلب: #{action.id}</span>
                                            <span>{action.date}</span>
                                        </div>
                                        {action.note && <p className="text-xs text-red-500 bg-red-50 dark:bg-red-900/20 p-2 rounded">ملاحظة: {action.note}</p>}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // 13. طلب تغيير تخصص (جديد)
        const MajorChangeRequestPage = ({ onBack }) => {
            const [submitted, setSubmitted] = useState(false);
            
            if(submitted) {
                return (
                    <div className="animate-fade-in text-center py-20">
                        <div className="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6"><Check size={40}/></div>
                        <h3 className="text-2xl font-bold text-gray-800 dark:text-white mb-2">تم استلام طلب التحويل</h3>
                        <p className="text-gray-500 mb-6">يمكنك متابعة حالة الطلب من صفحة "عرض طلبات تغيير التخصص"</p>
                        <button onClick={onBack} className="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg font-bold hover:bg-gray-200">عودة للقائمة</button>
                    </div>
                )
            }

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="طلب تغيير تخصص" onBack={onBack} />
                    
                    {/* معلومات الطالب الحالية */}
                    <div className="bg-primary/5 border border-primary/10 p-4 rounded-xl flex justify-between items-center">
                        <div>
                            <p className="text-xs text-gray-500 mb-1">التخصص الحالي</p>
                            <p className="font-bold text-primary">هندسة البرمجيات</p>
                        </div>
                        <div className="text-left">
                            <p className="text-xs text-gray-500 mb-1">المعدل التراكمي</p>
                            <p className="font-bold text-gray-800 dark:text-white font-mono">3.35</p>
                        </div>
                    </div>

                    <div className="bg-white dark:bg-dark-card p-6 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm space-y-5">
                        <h3 className="font-bold border-b border-gray-100 dark:border-gray-700 pb-2">بيانات التحويل</h3>
                        
                        <div>
                            <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">الكلية المراد التحويل إليها</label>
                            <div className="relative">
                                <select className="w-full p-3 pr-10 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none appearance-none text-gray-700 dark:text-gray-200">
                                    <option>كلية الحاسب الآلي ونظم المعلومات</option>
                                    <option>كلية الهندسة والعمارة الإسلامية</option>
                                    <option>كلية العلوم التطبيقية</option>
                                </select>
                                <ChevronDown className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" size={18}/>
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">التخصص المطلوب</label>
                            <div className="relative">
                                <select className="w-full p-3 pr-10 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none appearance-none text-gray-700 dark:text-gray-200">
                                    <option>علوم الحاسب الآلي</option>
                                    <option>نظم المعلومات</option>
                                    <option>هندسة حاسب آلي</option>
                                </select>
                                <ChevronDown className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" size={18}/>
                            </div>
                        </div>

                        <div className="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-xs text-blue-700 dark:text-blue-300">
                            يجب ألا يقل المعدل التراكمي عن 3.50 للتحويل إلى علوم الحاسب.
                        </div>

                        <button onClick={() => setSubmitted(true)} className="w-full bg-primary text-white font-bold py-3 rounded-xl hover:bg-teal-700 transition shadow-lg shadow-primary/20">
                            تقديم طلب التحويل
                        </button>
                    </div>
                </div>
            );
        };

        // 14. عرض طلبات تغيير التخصص (جديد)
        const ViewMajorChangeRequestsPage = ({ onBack }) => {
            const requests = [
                { id: 9901, target: 'علوم الحاسب الآلي', date: '2023-05-10', status: 'pending', note: 'بانتظار موافقة عميد الكلية' },
                { id: 8820, target: 'أمن سيبراني', date: '2022-12-01', status: 'rejected', note: 'المعدل لا يستوفي الشروط' }
            ];

            const getStatusBadge = (status) => {
                if (status === 'approved') return <span className="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><Check size={12}/> مقبول</span>;
                if (status === 'rejected') return <span className="bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><X size={12}/> مرفوض</span>;
                return <span className="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><Clock size={12}/> قيد الدراسة</span>;
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="طلبات تغيير التخصص" onBack={onBack} />
                    <div className="space-y-4">
                        {requests.map(req => (
                            <div key={req.id} className="bg-white dark:bg-dark-card p-5 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
                                <div className="flex justify-between items-start mb-2">
                                    <div>
                                        <div className="text-xs text-gray-400 mb-1">التحويل إلى</div>
                                        <h4 className="font-bold text-gray-800 dark:text-white text-lg">{req.target}</h4>
                                    </div>
                                    {getStatusBadge(req.status)}
                                </div>
                                <div className="border-t border-gray-100 dark:border-gray-700 mt-3 pt-3">
                                    <div className="flex justify-between text-xs text-gray-500 mb-2">
                                        <span>تاريخ الطلب: {req.date}</span>
                                        <span>#{req.id}</span>
                                    </div>
                                    {req.note && <div className="bg-gray-50 dark:bg-gray-800 p-2 rounded text-xs text-gray-600 dark:text-gray-300">حالة الطلب: {req.note}</div>}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // 15. الانسحاب من مقرر
        const WithdrawPage = ({ onBack }) => {
            const courses = [
                { code: 'CS101', name: 'مقدمة في البرمجة' },
                { code: 'MATH101', name: 'تفاضل وتكامل' }
            ];
            
            const handleWithdraw = (c) => {
                alert(`سيتم رصد تقدير (ع) لمقرر ${c.name}. هل أنت متأكد؟`);
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="الانسحاب من مقرر" onBack={onBack} />
                    <div className="bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-800 p-4 rounded-xl flex gap-3">
                        <AlertTriangle className="text-red-600 shrink-0"/>
                        <p className="text-sm text-red-700 dark:text-red-200">تنبيه: الانسحاب من المقرر سيؤدي إلى رصد تقدير (ع) في سجلك الأكاديمي ولن يدخل في احتساب المعدل، ولكن ستحسب الساعات ضمن الحد الأقصى المسموح به.</p>
                    </div>
                    
                    <div className="space-y-3">
                        {courses.map((c, i) => (
                            <div key={i} className="bg-white dark:bg-dark-card p-4 rounded-xl border border-gray-200 dark:border-gray-700 flex justify-between items-center shadow-sm">
                                <div>
                                    <h4 className="font-bold text-gray-800 dark:text-white">{c.name}</h4>
                                    <span className="text-xs font-mono text-gray-500">{c.code}</span>
                                </div>
                                <button onClick={() => handleWithdraw(c)} className="bg-red-50 text-red-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-red-600 hover:text-white transition border border-red-100">انسحاب</button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // 16. التسجيل الإلكتروني مع Stepper
        const RegistrationPage = ({ onBack }) => {
            const steps = [
                { id: 1, label: 'تحديث البيانات', status: 'completed' },
                { id: 2, label: 'اختيار الرغبات', status: 'current' },
                { id: 3, label: 'تأكيد الجدول', status: 'pending' },
                { id: 4, label: 'طباعة', status: 'pending' }
            ];

            // حالة المؤقت (بدءاً من 2 يوم و 14 ساعة كمثال)
            const [timeLeft, setTimeLeft] = useState({ days: 2, hours: 14, minutes: 30, seconds: 59 });

            useEffect(() => {
                const timer = setInterval(() => {
                    setTimeLeft(prev => {
                        if (prev.seconds > 0) return { ...prev, seconds: prev.seconds - 1 };
                        if (prev.minutes > 0) return { ...prev, minutes: prev.minutes - 1, seconds: 59 };
                        if (prev.hours > 0) return { ...prev, hours: prev.hours - 1, minutes: 59, seconds: 59 };
                        if (prev.days > 0) return { ...prev, days: prev.days - 1, hours: 23, minutes: 59, seconds: 59 };
                        return prev; // انتهى الوقت
                    });
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="التسجيل الإلكتروني" onBack={onBack} />

                    {/* عداد الوقت المتبقي */}
                    <div className="bg-gradient-to-l from-primary to-teal-800 rounded-2xl p-6 text-white shadow-lg flex flex-col md:flex-row items-center justify-between gap-6 relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        
                        <div className="relative z-10 text-center md:text-right">
                            <h3 className="text-xl font-bold mb-1 flex items-center justify-center md:justify-start gap-2">
                                <Clock className="animate-pulse" size={24}/> ينتهي التسجيل خلال
                            </h3>
                            <p className="text-teal-100 text-sm opacity-90">بادر بتسجيل مقرراتك قبل انتهاء الفترة المحددة</p>
                        </div>

                        <div className="relative z-10 flex gap-4">
                            {/* الأيام (يمين لأن الاتجاه RTL) */}
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.days}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">يوم</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.hours}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">ساعة</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.minutes}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">دقيقة</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.seconds}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">ثانية</span>
                            </div>
                        </div>
                    </div>
                    
                    {/* Stepper */}
                    <div className="bg-white dark:bg-dark-card p-6 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700">
                        <div className="flex items-center justify-between relative">
                            <div className="absolute left-0 right-0 top-1/2 h-0.5 bg-gray-200 dark:bg-gray-700 -z-0"></div>
                            {steps.map((step, idx) => (
                                <div key={step.id} className="relative z-10 flex flex-col items-center bg-white dark:bg-dark-card px-2">
                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center border-2 text-sm font-bold transition-colors ${step.status === 'completed' ? 'bg-primary border-primary text-white' : step.status === 'current' ? 'border-primary text-primary' : 'border-gray-300 text-gray-300'}`}>
                                        {step.status === 'completed' ? <Check size={16}/> : step.id}
                                    </div>
                                    <span className={`text-xs mt-2 font-bold ${step.status === 'current' ? 'text-primary' : 'text-gray-500'}`}>{step.label}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800 flex gap-3">
                        <AlertCircle className="text-blue-600 shrink-0" />
                        <div>
                            <h4 className="font-bold text-blue-800 dark:text-blue-200 text-sm">تنبيه هام</h4>
                            <p className="text-xs text-blue-600 dark:text-blue-300 mt-1">يرجى التأكد من عدم وجود تعارض في الاختبارات النهائية قبل تأكيد الجدول.</p>
                        </div>
                    </div>

                    <div className="text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-300">
                        <Layers size={48} className="mx-auto text-gray-300 mb-4"/>
                        <p className="text-gray-500 font-bold">بوابة التسجيل متاحة حالياً لتعديل الرغبات</p>
                        <button className="mt-4 bg-primary text-white px-6 py-2 rounded-lg font-bold hover:bg-teal-700 transition">ابدأ التسجيل</button>
                    </div>
                </div>
            );
        };

        // 17. الطلبات الأكاديمية (RequestsPage OLD - can be removed or kept as generic view)
        const RequestsPage = ({ onBack }) => {
            const requests = [
                { id: 1023, type: 'إعادة قيد', date: '2023-12-01', status: 'pending', desc: 'طلب إعادة قيد للفصل الدراسي الثاني' },
                { id: 1011, type: 'تغيير تخصص', date: '2023-09-15', status: 'rejected', desc: 'التحويل من هندسة الحاسب إلى هندسة البرمجيات' },
                { id: 985, type: 'اعتذار عن فصل', date: '2023-05-20', status: 'approved', desc: 'الاعتذار عن الفصل الصيفي لظروف صحية' },
            ];

            const getStatusChip = (status) => {
                switch(status) {
                    case 'approved': return <span className="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-bold flex items-center gap-1"><CheckCircle2 size={12}/> مقبول</span>;
                    case 'rejected': return <span className="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-bold flex items-center gap-1"><X size={12}/> مرفوض</span>;
                    default: return <span className="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-bold flex items-center gap-1"><Clock size={12}/> قيد الدراسة</span>;
                }
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="الطلبات الأكاديمية" onBack={onBack} extra={<button className="bg-primary text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2"><PlusCircle size={16}/> طلب جديد</button>} />
                    <div className="space-y-4">
                        {requests.map(req => (
                            <div key={req.id} className="bg-white dark:bg-dark-card p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition">
                                <div className="flex justify-between items-start mb-2">
                                    <div>
                                        <div className="flex items-center gap-2">
                                            <h3 className="font-bold text-gray-800 dark:text-white">{req.type}</h3>
                                            <span className="text-xs text-gray-400">#{req.id}</span>
                                        </div>
                                        <p className="text-sm text-gray-500 mt-1">{req.desc}</p>
                                    </div>
                                    {getStatusChip(req.status)}
                                </div>
                                <div className="border-t border-gray-100 dark:border-gray-700 mt-3 pt-3 flex justify-between items-center text-xs text-gray-400">
                                    <span>تاريخ الطلب: {req.date}</span>
                                    <button className="text-primary font-bold hover:underline">عرض التفاصيل</button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        // 18. الملف الشخصي (محدث ليشمل كافة الأقسام الجديدة)
        const PersonalPage = ({ onBack, activeView }) => {
            // ... (نفس الكود السابق لصفحة الملف الشخصي)
            const [imgSrc, setImgSrc] = useState(null);
            const [toast, setToast] = useState(null);
            const fileInputRef = useRef(null);

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const url = URL.createObjectURL(file);
                    setImgSrc(url);
                    setToast({ type: 'success', message: 'تم رفع الصورة بنجاح! بانتظار الاعتماد.' });
                    setTimeout(() => setToast(null), 3000);
                }
            };

            const titles = {
                'id-photo': 'رفع الصورة الشخصية',
                'finance': 'السجل المالي',
                'rewards': 'سجل المكافآت',
                'penalties': 'العقوبات',
                'allowances': 'البدلات',
                'docs': 'الوثائق والإفادات'
            };

            // بيانات المكافآت التاريخية
            const rewardsHistory = [
                { id: 1, type: 'مكافأة شهرية', month: 'شوال 1445', amount: '990', status: 'تم الإيداع', date: '1445/10/25', isBonus: false },
                { id: 2, type: 'مكافأة شهرية', month: 'رمضان 1445', amount: '990', status: 'تم الإيداع', date: '1445/09/25', isBonus: false },
                { id: 3, type: 'مكافأة شهرية', month: 'شعبان 1445', amount: '990', status: 'تم الإيداع', date: '1445/08/25', isBonus: false },
                { id: 4, type: 'مكافأة شهرية', month: 'رجب 1445', amount: '990', status: 'تم الإيداع', date: '1445/07/25', isBonus: false },
                { id: 5, type: 'مكافأة شهرية', month: 'جمادى الآخرة 1445', amount: '990', status: 'تم الإيداع', date: '1445/06/25', isBonus: false },
                { id: 6, type: 'مكافأة شهرية', month: 'جمادى الأولى 1445', amount: '990', status: 'تم الإيداع', date: '1445/05/25', isBonus: false },
                { id: 7, type: 'مكافأة شهرية', month: 'ربيع الثاني 1445', amount: '990', status: 'تم الإيداع', date: '1445/04/25', isBonus: false },
                { id: 8, type: 'مكافأة شهرية', month: 'ربيع الأول 1445', amount: '990', status: 'تم الإيداع', date: '1445/03/25', isBonus: false },
                { id: 9, type: 'مكافأة شهرية', month: 'صفر 1445', amount: '990', status: 'تم الإيداع', date: '1445/02/25', isBonus: false },
                { id: 10, type: 'مكافأة شهرية', month: 'محرم 1445', amount: '990', status: 'تم الإيداع', date: '1445/01/25', isBonus: false },
                // سنة 1444
                { id: 11, type: 'مكافأة تفوق', month: 'ذو الحجة 1444', amount: '1000', status: 'تم الإيداع', date: '1444/12/20', isBonus: true },
                { id: 12, type: 'مكافأة شهرية', month: 'ذو الحجة 1444', amount: '990', status: 'تم الإيداع', date: '1444/12/25', isBonus: false },
                { id: 13, type: 'مكافأة شهرية', month: 'ذو القعدة 1444', amount: '990', status: 'تم الإيداع', date: '1444/11/25', isBonus: false },
                { id: 14, type: 'مكافأة شهرية', month: 'شوال 1444', amount: '990', status: 'تم الإيداع', date: '1444/10/25', isBonus: false },
                { id: 15, type: 'مكافأة شهرية', month: 'رمضان 1444', amount: '990', status: 'تم الإيداع', date: '1444/09/25', isBonus: false },
                { id: 16, type: 'مكافأة شهرية', month: 'شعبان 1444', amount: '990', status: 'تم الإيداع', date: '1444/08/25', isBonus: false },
                { id: 17, type: 'مكافأة شهرية', month: 'رجب 1444', amount: '990', status: 'تم الإيداع', date: '1444/07/25', isBonus: false },
                { id: 18, type: 'مكافأة شهرية', month: 'جمادى الآخرة 1444', amount: '990', status: 'تم الإيداع', date: '1444/06/25', isBonus: false },
                { id: 19, type: 'مكافأة شهرية', month: 'جمادى الأولى 1444', amount: '990', status: 'تم الإيداع', date: '1444/05/25', isBonus: false },
                { id: 20, type: 'مكافأة شهرية', month: 'ربيع الثاني 1444', amount: '990', status: 'تم الإيداع', date: '1444/04/25', isBonus: false },
                { id: 21, type: 'مكافأة شهرية', month: 'ربيع الأول 1444', amount: '990', status: 'تم الإيداع', date: '1444/03/25', isBonus: false },
            ];

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={titles[activeView]} onBack={onBack} />
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}

                    {/* 1. رفع الصورة الشخصية */}
                    {activeView === 'id-photo' && (
                        <div className="bg-white dark:bg-dark-card p-8 rounded-2xl border border-gray-200 dark:border-gray-700 text-center shadow-sm">
                            <div className="relative w-40 h-40 mx-auto mb-6 group">
                                <div className="w-full h-full rounded-full overflow-hidden border-4 border-gray-100 dark:border-gray-700 shadow-inner bg-gray-50 dark:bg-gray-800">
                                    {imgSrc ? <img src={imgSrc} alt="Profile" className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-gray-300"><User size={64}/></div>}
                                </div>
                                <button onClick={() => fileInputRef.current.click()} className="absolute bottom-2 right-2 p-3 bg-primary text-white rounded-full shadow-lg hover:scale-110 transition border-4 border-white dark:border-dark-card"><Camera size={20}/></button>
                                <input type="file" ref={fileInputRef} onChange={handleFileChange} className="hidden" accept="image/*"/>
                            </div>
                            <h3 className="font-bold text-xl text-gray-800 dark:text-white">الصورة الجامعية</h3>
                            <p className="text-sm text-gray-500 mt-2 max-w-md mx-auto leading-relaxed">
                                يرجى رفع صورة ملونة حديثة بخلفية بيضاء، بالزي الرسمي، وبدون فلاتر أو تعديلات.
                                <br/><span className="text-xs text-red-500">ملاحظة: الصورة ستستخدم في طباعة البطاقة الجامعية.</span>
                            </p>
                            <div className="mt-8 flex justify-center gap-3">
                                <button onClick={() => fileInputRef.current.click()} className="px-6 py-2.5 bg-primary text-white rounded-xl font-bold hover:bg-teal-700 transition flex items-center gap-2 shadow-lg shadow-primary/20"><Upload size={18}/> اختيار صورة</button>
                                {imgSrc && <button onClick={() => {setImgSrc(null); setToast({type:'error', message:'تم حذف الصورة'}); setTimeout(()=>setToast(null),3000)}} className="px-6 py-2.5 bg-red-50 text-red-600 rounded-xl font-bold hover:bg-red-100 transition">حذف</button>}
                            </div>
                        </div>
                    )}

                    {/* 2. السجل المالي (شامل) */}
                    {activeView === 'finance' && (
                        <div className="space-y-6">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div className="bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-xl border border-emerald-100 dark:border-emerald-800">
                                    <span className="text-emerald-600 dark:text-emerald-400 text-xs font-bold">إجمالي المستحقات</span>
                                    <div className="text-2xl font-bold text-emerald-800 dark:text-emerald-200 mt-1 font-mono">21,790 SAR</div>
                                </div>
                                <div className="bg-red-50 dark:bg-red-900/20 p-4 rounded-xl border border-red-100 dark:border-red-800">
                                    <span className="text-red-600 dark:text-red-400 text-xs font-bold">المخصومات</span>
                                    <div className="text-2xl font-bold text-red-800 dark:text-red-200 mt-1 font-mono">-50 SAR</div>
                                </div>
                                <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800">
                                    <span className="text-blue-600 dark:text-blue-400 text-xs font-bold">الرصيد المحول</span>
                                    <div className="text-2xl font-bold text-blue-800 dark:text-blue-200 mt-1 font-mono">21,740 SAR</div>
                                </div>
                            </div>

                            <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm">
                                 <table className="w-full text-right text-sm">
                                    <thead className="bg-gray-50 dark:bg-gray-800/50 text-gray-500 font-medium text-xs uppercase">
                                        <tr><th className="p-4">البند</th><th className="p-4">الشهر</th><th className="p-4">المبلغ</th><th className="p-4">الحالة</th></tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                        <tr><td className="p-4 font-bold text-gray-800 dark:text-gray-200">مكافأة شهرية</td><td className="p-4 text-gray-500">رجب 1445</td><td className="p-4 font-mono font-bold text-gray-800 dark:text-white">990 SAR</td><td className="p-4"><span className="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold">تم التحويل</span></td></tr>
                                        <tr><td className="p-4 font-bold text-gray-800 dark:text-gray-200">مكافأة شهرية</td><td className="p-4 text-gray-500">جمادى الآخرة 1445</td><td className="p-4 font-mono font-bold text-gray-800 dark:text-white">990 SAR</td><td className="p-4"><span className="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold">تم التحويل</span></td></tr>
                                        <tr><td className="p-4 font-bold text-gray-800 dark:text-gray-200">خصم (غياب سكن)</td><td className="p-4 text-gray-500">جمادى الأولى 1445</td><td className="p-4 font-mono font-bold text-red-600">-50 SAR</td><td className="p-4"><span className="bg-gray-100 text-gray-600 px-2 py-1 rounded text-[10px] font-bold">مخصوم</span></td></tr>
                                    </tbody>
                                 </table>
                            </div>
                        </div>
                    )}

                    {/* 3. المكافآت (سجل تاريخي كامل) */}
                    {activeView === 'rewards' && (
                        <div className="space-y-4">
                            <div className="bg-gradient-to-br from-gold to-yellow-600 p-6 rounded-2xl text-white shadow-lg relative overflow-hidden flex justify-between items-center">
                                <div className="relative z-10">
                                    <h3 className="font-bold text-xl mb-1">إجمالي المكافآت المستلمة</h3>
                                    <p className="text-yellow-100 text-sm">منذ الالتحاق بالجامعة</p>
                                    <p className="text-3xl font-bold font-mono mt-2">21,790 SAR</p>
                                </div>
                                <div className="bg-white/20 p-4 rounded-full backdrop-blur-sm"><Coins size={36}/></div>
                            </div>
                            
                            <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm">
                                <div className="max-h-[500px] overflow-y-auto">
                                    <table className="w-full text-right text-sm">
                                        <thead className="bg-gray-50 dark:bg-gray-800/50 text-gray-500 font-medium sticky top-0 z-10">
                                            <tr><th className="p-4">نوع المكافأة</th><th className="p-4">الشهر / السنة</th><th className="p-4">القيمة</th><th className="p-4">تاريخ الاستحقاق</th><th className="p-4">الحالة</th></tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                            {rewardsHistory.map((reward) => (
                                                <tr key={reward.id} className={reward.isBonus ? "bg-yellow-50/50 dark:bg-yellow-900/10" : "hover:bg-gray-50 dark:hover:bg-gray-800/50 transition"}>
                                                    <td className="p-4">
                                                        <div className="font-bold text-gray-800 dark:text-white flex items-center gap-2">
                                                            {reward.isBonus && <Award size={16} className="text-gold"/>}
                                                            {reward.type}
                                                        </div>
                                                    </td>
                                                    <td className="p-4 text-gray-600 dark:text-gray-400">{reward.month}</td>
                                                    <td className={`p-4 font-mono font-bold ${reward.isBonus ? 'text-gold' : 'text-primary'}`}>{reward.amount} SAR</td>
                                                    <td className="p-4 font-mono text-gray-500 text-xs">{reward.date}</td>
                                                    <td className="p-4"><span className="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold">{reward.status}</span></td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 4. العقوبات */}
                    {activeView === 'penalties' && (
                        <div className="space-y-6">
                            {/* حالة نظيفة */}
                            <div className="bg-white dark:bg-dark-card p-10 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm text-center">
                                <div className="w-20 h-20 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <ShieldAlert size={40}/>
                                </div>
                                <h3 className="text-xl font-bold text-gray-800 dark:text-white">سجلك نظيف!</h3>
                                <p className="text-gray-500 mt-2">لا توجد عليك أي عقوبات أو مخالفات مسجلة.</p>
                            </div>

                            {/* مثال لجدول فارغ (أو ممتلئ إذا أردت إظهار عقوبات) */}
                            <div className="opacity-50 pointer-events-none grayscale" aria-hidden="true">
                                <h4 className="text-sm font-bold text-gray-400 mb-2">أرشيف المخالفات (مثال)</h4>
                                <div className="bg-white dark:bg-dark-card rounded-xl border border-gray-200 dark:border-gray-700 p-4">
                                    <table className="w-full text-right text-sm">
                                        <thead><tr><th className="pb-2">المخالفة</th><th className="pb-2">العقوبة</th><th className="pb-2">التاريخ</th></tr></thead>
                                        <tbody><tr><td className="py-2">---</td><td>---</td><td>---</td></tr></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 5. البدلات */}
                    {activeView === 'allowances' && (
                        <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm">
                             <table className="w-full text-right text-sm">
                                <thead className="bg-gray-50 dark:bg-gray-800/50 text-gray-500 font-medium">
                                    <tr><th className="p-4">نوع البدل</th><th className="p-4">المبلغ</th><th className="p-4">تاريخ الصرف</th><th className="p-4">الحالة</th></tr>
                                </thead>
                                <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                    <tr><td className="p-4 font-bold text-gray-800 dark:text-white">بدل كتب ومراجع</td><td className="p-4 font-bold text-primary font-mono">850 SAR</td><td className="p-4 font-mono">1445/01/15</td><td className="p-4"><span className="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold">صُرفت</span></td></tr>
                                    <tr><td className="p-4 font-bold text-gray-800 dark:text-white">بدل أدوات علمية</td><td className="p-4 font-bold text-primary font-mono">400 SAR</td><td className="p-4 font-mono">1445/01/15</td><td className="p-4"><span className="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold">صُرفت</span></td></tr>
                                    <tr><td className="p-4 font-bold text-gray-800 dark:text-white">بدل طباعة رسالة</td><td className="p-4 font-bold text-gray-400 font-mono">--</td><td className="p-4 font-mono">--</td><td className="p-4"><span className="bg-gray-100 text-gray-500 px-2 py-1 rounded text-[10px] font-bold">غير مستحق</span></td></tr>
                                </tbody>
                             </table>
                        </div>
                    )}
                    
                    {/* 6. الوثائق والإفادات */}
                    {activeView === 'docs' && (
                        <div className="space-y-4">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="p-5 border border-gray-200 dark:border-gray-700 rounded-xl flex items-center justify-between bg-white dark:bg-dark-card hover:border-primary transition group shadow-sm">
                                    <div className="flex items-center gap-4">
                                        <div className="p-3 bg-blue-50 text-blue-600 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition"><ScrollText size={24}/></div>
                                        <div><h4 className="font-bold text-gray-800 dark:text-white">إفادة انتظام</h4><p className="text-xs text-gray-500">موجهة للجهات الحكومية والخاصة</p></div>
                                    </div>
                                    <button className="text-primary hover:bg-primary/10 p-2 rounded-lg"><Printer size={20}/></button>
                                </div>
                                <div className="p-5 border border-gray-200 dark:border-gray-700 rounded-xl flex items-center justify-between bg-white dark:bg-dark-card hover:border-primary transition group shadow-sm">
                                    <div className="flex items-center gap-4">
                                        <div className="p-3 bg-purple-50 text-purple-600 rounded-lg group-hover:bg-purple-600 group-hover:text-white transition"><FileBadge size={24}/></div>
                                        <div><h4 className="font-bold text-gray-800 dark:text-white">السجل الأكاديمي</h4><p className="text-xs text-gray-500">نسخة رسمية (عربي/إنجليزي)</p></div>
                                    </div>
                                    <button className="text-primary hover:bg-primary/10 p-2 rounded-lg"><Download size={20}/></button>
                                </div>
                                <div className="p-5 border border-gray-200 dark:border-gray-700 rounded-xl flex items-center justify-between bg-white dark:bg-dark-card hover:border-primary transition group shadow-sm">
                                    <div className="flex items-center gap-4">
                                        <div className="p-3 bg-teal-50 text-teal-600 rounded-lg group-hover:bg-teal-600 group-hover:text-white transition"><CreditCard size={24}/></div>
                                        <div><h4 className="font-bold text-gray-800 dark:text-white">مشهد مكافأة</h4><p className="text-xs text-gray-500">تعريف بالراتب والمكافآت</p></div>
                                    </div>
                                    <button className="text-primary hover:bg-primary/10 p-2 rounded-lg"><Printer size={20}/></button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- NEW: صفحة حسابي (User Account) ---
        const UserAccountPage = ({ onBack }) => {
            const user = {
                name: "فيصل عبدالله الخالد",
                id: "444002548",
                email: "s444002548@st.uqu.edu.sa",
                college: "الحاسب الآلي ونظم المعلومات",
                dept: "هندسة الحاسب الآلي",
                major: "هندسة البرمجيات",
                degree: "بكالوريوس",
                type: "انتظام",
                advisor: "د. محمد الغامدي",
                advisorEmail: "advisor@uqu.edu.sa"
            };

            const handleEmailAdvisor = () => {
                window.location.href = `mailto:${user.advisorEmail}`;
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="حسابي" onBack={onBack} />
                    
                    {/* بطاقة الطالب */}
                    <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 p-8 shadow-sm flex flex-col items-center text-center relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-24 bg-gradient-to-r from-primary to-teal-800"></div>
                        <div className="relative z-10 mt-4">
                            <div className="w-28 h-28 rounded-full border-4 border-white dark:border-dark-card shadow-lg bg-gray-200 flex items-center justify-center mx-auto overflow-hidden">
                                <User size={64} className="text-gray-400"/>
                            </div>
                            <h2 className="text-2xl font-bold text-gray-800 dark:text-white mt-4">{user.name}</h2>
                            <p className="text-gray-500 font-mono text-sm mt-1">{user.email}</p>
                            <span className="inline-block mt-3 bg-primary/10 text-primary px-3 py-1 rounded-full text-xs font-bold border border-primary/20">طالب {user.type}</span>
                        </div>
                    </div>

                    {/* البيانات الأكاديمية */}
                    <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden">
                        <div className="bg-gray-50 dark:bg-gray-800/50 px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2"><GraduationCap size={20} className="text-primary"/> البيانات الأكاديمية</h3>
                        </div>
                        <div className="divide-y divide-gray-100 dark:divide-gray-700">
                            <div className="p-4 flex justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition">
                                <span className="text-gray-500 text-sm">الكلية</span>
                                <span className="font-bold text-gray-800 dark:text-white text-sm">{user.college}</span>
                            </div>
                            <div className="p-4 flex justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition">
                                <span className="text-gray-500 text-sm">القسم</span>
                                <span className="font-bold text-gray-800 dark:text-white text-sm">{user.dept}</span>
                            </div>
                            <div className="p-4 flex justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition">
                                <span className="text-gray-500 text-sm">التخصص</span>
                                <span className="font-bold text-gray-800 dark:text-white text-sm">{user.major}</span>
                            </div>
                            <div className="p-4 flex justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition">
                                <span className="text-gray-500 text-sm">الدرجة العلمية</span>
                                <span className="font-bold text-gray-800 dark:text-white text-sm">{user.degree}</span>
                            </div>
                        </div>
                    </div>

                    {/* المرشد الأكاديمي */}
                    <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm p-4 flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center border border-blue-100 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-400">
                                <User size={24} />
                            </div>
                            <div>
                                <span className="block text-xs text-gray-500 dark:text-gray-400 mb-0.5">المرشد الأكاديمي</span>
                                <h4 className="font-bold text-gray-800 dark:text-white">{user.advisor}</h4>
                            </div>
                        </div>
                        <button 
                            onClick={handleEmailAdvisor}
                            className="flex items-center gap-2 bg-primary text-white px-4 py-2.5 rounded-xl text-sm font-bold hover:bg-teal-700 transition shadow-lg shadow-primary/20 active:scale-95"
                        >
                            <Send size={16} className="rotate-180" />
                            <span className="hidden sm:inline">مراسلة</span>
                        </button>
                    </div>

                    {/* إعدادات الحساب */}
                    <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden">
                        <div className="bg-gray-50 dark:bg-gray-800/50 px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2"><Lock size={20} className="text-primary"/> إعدادات الأمان</h3>
                        </div>
                        <div className="divide-y divide-gray-100 dark:divide-gray-700">
                            <button className="w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition text-right group">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-blue-50 text-blue-600 rounded-lg"><User size={18}/></div>
                                    <span className="font-bold text-gray-700 dark:text-gray-200 text-sm">تعديل الملف الشخصي</span>
                                </div>
                                <ChevronLeft size={18} className="text-gray-400 group-hover:text-primary transition-transform group-hover:-translate-x-1"/>
                            </button>
                            <button className="w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition text-right group">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-purple-50 text-purple-600 rounded-lg"><ShieldAlert size={18}/></div>
                                    <span className="font-bold text-gray-700 dark:text-gray-200 text-sm">التحقق بخطوتين (2FA)</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <span className="text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded font-bold">مفعل</span>
                                    <ChevronLeft size={18} className="text-gray-400 group-hover:text-primary transition-transform group-hover:-translate-x-1"/>
                                </div>
                            </button>
                            <button className="w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition text-right group">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-orange-50 text-orange-600 rounded-lg"><Lock size={18}/></div>
                                    <span className="font-bold text-gray-700 dark:text-gray-200 text-sm">تغيير كلمة المرور</span>
                                </div>
                                <ChevronLeft size={18} className="text-gray-400 group-hover:text-primary transition-transform group-hover:-translate-x-1"/>
                            </button>
                            <button className="w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition text-right group">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-gray-100 text-gray-600 rounded-lg"><CreditCard size={18}/></div>
                                    <span className="font-bold text-gray-700 dark:text-gray-200 text-sm">إدارة الأجهزة والجلسات</span>
                                </div>
                                <ChevronLeft size={18} className="text-gray-400 group-hover:text-primary transition-transform group-hover:-translate-x-1"/>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 19. الرئيسية (Home View)
        const HomeView = ({ t, openService }) => {
            const completed = studentData.completedHours;
            const current = studentData.currentHours;
            const remaining = studentData.totalHours - (completed + current);
            const total = studentData.totalHours;
            const completedPct = (completed / total) * 100;
            const currentPct = (current / total) * 100;

            const upcomingExams = [
                { subject: "التحليل الكيميائي", date: "2024-05-15", time: "09:00", room: "109/ق6", daysLeft: 2 },
                { subject: "الإحصاء العملي", date: "2024-05-20", time: "10:30", room: "معمل 2", daysLeft: 7 },
            ];
            
            const attendanceData = [
                { name: 'برمجة متقدمة', absencePct: 0, excused: false },      
                { name: 'تحليل كيميائي', absencePct: 12, excused: false },    
                { name: 'إحصاء هندسي', absencePct: 20, excused: true },       
                { name: 'فيزياء عامة', absencePct: 16, excused: false },      
            ];

            return (
                <div className="space-y-8 animate-fade-in">
                    <div>
                        <h3 className="text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider flex items-center gap-2"><div className="w-1 h-4 bg-primary rounded-full"></div> {t.quickActions}</h3>
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <ActionCard icon={<Calendar size={24}/>} title={t.schedule} onClick={() => openService('schedule')} />
                            <ActionCard icon={<FileText size={24}/>} title={t.results} onClick={() => openService('results')} color="gold" />
                            <ActionCard icon={<RefreshCw size={24}/>} title={t.addDrop} onClick={() => openService('addDrop')} color="blue" />
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 bg-primary rounded-2xl p-8 text-white shadow-xl relative overflow-hidden group flex flex-col justify-between">
                            <div className="absolute top-0 right-0 w-full h-full opacity-[0.07] bg-[url('https://www.transparenttextures.com/patterns/arabesque.png')]"></div>
                            <div className="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-8">
                                <div>
                                    <div className="inline-flex items-center gap-2 bg-black/20 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-medium text-teal-100 mb-4 border border-white/10"><TrendingUp size={14} className="text-gold" /> <span>{t.statusRegular}</span></div>
                                    <h2 className="text-6xl font-bold text-white mb-2 tracking-tighter">{studentData.gpa}</h2> 
                                    <p className="text-teal-100 text-lg opacity-90">{t.gpa}</p>
                                </div>
                                <div className="bg-white/10 backdrop-blur-md p-4 rounded-xl border border-white/10 text-center min-w-[100px]"><span className="block text-3xl font-bold text-gold">{total}</span><span className="text-xs text-teal-100">إجمالي الساعات</span></div>
                            </div>
                            <div className="relative z-10 w-full">
                                <div className="flex justify-between text-xs text-teal-100 mb-2 font-medium"><span>{t.progress}</span><span>{Math.round(((completed + current)/total)*100)}%</span></div>
                                <div className="w-full h-4 bg-black/20 rounded-full overflow-hidden flex"><div className="h-full bg-white shadow-[0_0_10px_rgba(255,255,255,0.5)]" style={{ width: `${completedPct}%` }} title={`${t.hoursCompleted}: ${completed}`}></div><div className="h-full bg-gold shadow-[0_0_10px_rgba(177,142,81,0.5)]" style={{ width: `${currentPct}%` }} title={`${t.hoursCurrent}: ${current}`}></div></div>
                                <div className="grid grid-cols-3 gap-2 mt-4">
                                    <div className="bg-white/10 rounded-lg p-2 text-center border border-white/5"><div className="flex items-center justify-center gap-1.5 mb-1"><div className="w-2 h-2 rounded-full bg-white"></div><span className="text-[10px] text-teal-100">{t.hoursCompleted}</span></div><span className="text-lg font-bold text-white block leading-none">{completed}</span></div>
                                    <div className="bg-gold/20 rounded-lg p-2 text-center border border-gold/20"><div className="flex items-center justify-center gap-1.5 mb-1"><div className="w-2 h-2 rounded-full bg-gold"></div><span className="text-[10px] text-gold">{t.hoursCurrent}</span></div><span className="text-lg font-bold text-gold block leading-none">{current}</span></div>
                                    <div className="bg-black/20 rounded-lg p-2 text-center border border-white/5"><div className="flex items-center justify-center gap-1.5 mb-1"><div className="w-2 h-2 rounded-full bg-gray-400"></div><span className="text-[10px] text-gray-300">{t.hoursRemaining}</span></div><span className="text-lg font-bold text-gray-200 block leading-none">{remaining}</span></div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white dark:bg-dark-card rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col h-full min-h-[250px]">
                            <div className="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50"><h3 className="font-bold text-primary flex items-center gap-2 text-sm"><Clock size={16}/> {t.todaysLectures}</h3><span className="text-xs bg-primary/10 text-primary px-2 py-1 rounded font-bold">3</span></div>
                            <div className="p-4 space-y-4 flex-1 overflow-y-auto">
                                <div className="flex gap-4 opacity-50"><div className="flex flex-col items-center"><div className="w-3 h-3 rounded-full bg-gray-300"></div><div className="w-0.5 h-full bg-gray-200 my-1"></div></div><div><h4 className="font-bold text-gray-500 text-sm line-through">إحصاء هندسي</h4><p className="text-xs text-gray-400">08:00 - 09:50</p></div></div>
                                <div className="flex gap-4"><div className="flex flex-col items-center"><div className="w-3 h-3 rounded-full bg-primary ring-4 ring-teal-100 animate-pulse"></div><div className="w-0.5 h-full bg-gray-200 my-1"></div></div><div className="bg-teal-50 p-3 rounded-lg border border-teal-100 w-full"><h4 className="font-bold text-primary text-sm">تحليل كيميائي</h4><p className="text-xs text-gray-600 mt-1">معمل 3 • الآن</p></div></div>
                                <div className="flex gap-4"><div className="flex flex-col items-center"><div className="w-3 h-3 rounded-full bg-gray-300 dark:bg-gray-600 border-2 border-white dark:border-dark-card"></div></div><div><h4 className="font-bold text-gray-700 dark:text-gray-300 text-sm">تفاعل الإنسان والحاسب</h4><p className="text-xs text-gray-500">01:00 - 02:50 • قاعة 12</p><span className="text-[10px] text-teal-600 font-bold bg-teal-50 px-1.5 rounded mt-1 inline-block">قادمة</span></div></div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="bg-white dark:bg-dark-card p-5 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700">
                            <div className="flex justify-between items-center mb-4"><h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2"><span className="w-1 h-5 bg-primary rounded-full"></span>{t.upcomingExams}</h3><button className="text-xs text-primary font-bold hover:bg-primary/5 px-2 py-1 rounded">عرض الكل</button></div>
                            <div className="space-y-3">
                                {upcomingExams.map((exam, i) => (
                                    <div key={i} className="flex gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700 relative overflow-hidden">
                                        {exam.daysLeft <= 3 && <div className="absolute top-0 right-0 w-1 h-full bg-red-500"></div>}
                                        <div className="flex flex-col items-center justify-center bg-white dark:bg-gray-700 rounded shadow-sm w-12 h-12 border border-gray-100 dark:border-gray-600"><span className="text-[10px] text-gray-500 dark:text-gray-400 font-bold">مايو</span><span className="text-base font-bold text-primary dark:text-teal-400 font-mono">{new Date(exam.date).getDate()}</span></div>
                                        <div className="flex-1 py-0.5"><h4 className="font-bold text-gray-800 dark:text-gray-200 text-sm">{exam.subject}</h4><div className="flex items-center gap-3 mt-1 text-xs text-gray-500 dark:text-gray-400"><span className="flex items-center gap-1"><Clock size={12}/> {exam.time}</span><span className="flex items-center gap-1"><MapPin size={12}/> {exam.room}</span></div></div>
                                        <span className={`self-start text-[10px] px-2 py-0.5 rounded-full font-bold ${exam.daysLeft <= 3 ? 'bg-red-100 text-red-600' : 'bg-blue-50 text-blue-600'}`}>{t.hoursRemaining} {exam.daysLeft} أيام</span>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="bg-white dark:bg-dark-card p-5 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700">
                            <h3 className="font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2"><span className="w-1 h-5 bg-primary rounded-full"></span>{t.attendance}</h3>
                             <div className="space-y-6">
                                {attendanceData.map((item, idx) => {
                                    const progressPercent = Math.min((item.absencePct / 25) * 100, 100);
                                    let statusColor = "bg-green-500";
                                    let statusText = ""; 
                                    if (item.absencePct === 0) { statusColor = "bg-emerald-500"; statusText = "مثالي! واصل تميزك 🌟"; } 
                                    else if (item.absencePct < 10) { statusColor = "bg-green-500"; statusText = "آمن"; } 
                                    else if (item.absencePct >= 10 && item.absencePct < 15) { statusColor = "bg-yellow-500"; statusText = "تحذير"; } 
                                    else if (item.absencePct >= 15) { if (item.excused) { statusColor = "bg-orange-400"; statusText = "مرتفع (بعذر)"; } else { statusColor = "bg-red-600"; statusText = "حرمان"; } }

                                    return (
                                        <div key={idx} className="mb-2">
                                            <div className="flex justify-between items-center mb-1"><span className="font-bold text-gray-700 dark:text-gray-300 text-sm">{item.name}</span><div className="flex items-center gap-2">{statusText && (<span className={`text-[10px] px-2 py-0.5 rounded font-bold text-white shadow-sm ${statusColor}`}>{statusText}</span>)}<span className={`text-[10px] font-bold ${item.absencePct >= 15 && !item.excused ? 'text-red-500' : 'text-gray-500'}`}>{item.absencePct}%</span></div></div>
                                            <div className="relative w-full h-10"><div className="absolute top-3 w-full h-2.5 bg-gray-100 dark:bg-gray-700 rounded-full overflow-visible"><div className="absolute inset-0 rounded-full overflow-hidden"><div className={`h-full transition-all duration-1000 ${statusColor}`} style={{ width: `${progressPercent}%` }}></div></div><div className="absolute -top-1 bottom-0 w-0.5 bg-gray-300 dark:bg-gray-600 z-10" style={{ right: '60%' }}></div><div className="absolute top-4 text-[9px] font-bold text-gray-400 translate-x-1/2" style={{ right: '60%' }}>15%</div><div className="absolute -top-1 bottom-0 w-0.5 bg-red-300 dark:bg-red-800 z-10" style={{ right: '99%' }}></div><div className="absolute top-4 text-[9px] font-bold text-red-400 translate-x-full" style={{ right: '99%' }}>25%</div><div className="absolute top-4 text-[9px] text-gray-400" style={{ right: '0%' }}>0%</div></div></div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('home');
            const [activeCategory, setActiveCategory] = useState(null);
            const [darkMode, setDarkMode] = useState(false);
            const [lang, setLang] = useState('ar');
            const [menuOpen, setMenuOpen] = useState(false);

            useEffect(() => { document.documentElement.classList.toggle('dark', darkMode); }, [darkMode]);
            useEffect(() => { document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr'; }, [lang]);

            const t = translations[lang];
            const isAr = lang === 'ar';

            const goHome = () => setView('home');

            // --- Menu Structure Updated ---
            const menuItems = [
                // Analytics item removed from here to be placed as a main link
                {
                    id: 'academic', icon: <GraduationCap size={20}/>,
                    subItems: [
                        { id: 'schedule' },
                        { id: 'exams' }, 
                        { id: 'plan' },
                        { id: 'results' },
                        { id: 'absences' }, 
                        { id: 'record' }
                    ]
                },
                {
                    id: 'registration', icon: <CheckCircle2 size={20}/>,
                    subItems: [
                        { id: 'offered-courses' },
                        { id: 'addDrop' },
                        { id: 'dept-add' },
                        { id: 'dept-change' },
                        { id: 'dept-drop' },
                        { id: 'reg-requests' },
                        { id: 'withdraw' }
                    ]
                },
                {
                    id: 'requests', icon: <FileText size={20}/>,
                    subItems: [
                        { id: 'academic-action-new' },
                        { id: 'academic-action-view' },
                        { id: 'major-change-new' },
                        { id: 'major-change-view' }
                    ]
                },
                {
                    id: 'personal', icon: <User size={20}/>,
                    subItems: [
                        { id: 'penalties' }, 
                        { id: 'rewards' }, 
                        { id: 'finance' },
                        { id: 'docs' },
                        { id: 'allowances' }, 
                        { id: 'id-photo' } 
                    ]
                }
            ];

            const toggleCategory = (id) => {
                setActiveCategory(activeCategory === id ? null : id);
            };

            const renderContent = () => {
                switch(view) {
                    case 'student-dashboard': return <StudentDashboardPage onBack={goHome} />; 
                    case 'schedule': return <SchedulePage onBack={goHome} t={t} />;
                    case 'plan': return <PlanPage onBack={goHome} t={t} />;
                    case 'results': return <ResultsPage onBack={goHome} t={t} />;
                    case 'addDrop': return <AddDropPage onBack={goHome} t={t} />;
                    
                    // Registration Views
                    case 'offered-courses': return <OfferedCoursesPage onBack={goHome} />;
                    case 'dept-add': return <DepartmentRequestPage onBack={goHome} type="add" />;
                    case 'dept-change': return <DepartmentRequestPage onBack={goHome} type="change" />;
                    case 'dept-drop': return <DepartmentRequestPage onBack={goHome} type="drop" />;
                    case 'reg-requests': return <RegistrationRequestsPage onBack={goHome} />;
                    case 'withdraw': return <WithdrawPage onBack={goHome} />;

                    // Academic Views
                    case 'exams': return <ExamsPage onBack={goHome} />;
                    case 'e-reg': return <RegistrationPage onBack={goHome} />;
                    case 'absences': return <AbsencesPage onBack={goHome} />;
                    case 'record': return <AcademicRecordPage onBack={goHome} />;
                    
                    // Requests Views
                    case 'academic-action-new': return <NewAcademicActionPage onBack={goHome} />;
                    case 'academic-action-view': return <ViewAcademicActionsPage onBack={goHome} />;
                    case 'major-change-new': return <MajorChangeRequestPage onBack={goHome} />;
                    case 'major-change-view': return <ViewMajorChangeRequestsPage onBack={goHome} />;

                    // Personal Views
                    case 'id-photo': return <PersonalPage onBack={goHome} activeView="id-photo" />;
                    case 'finance': return <PersonalPage onBack={goHome} activeView="finance" />;
                    case 'rewards': return <PersonalPage onBack={goHome} activeView="rewards" />;
                    case 'penalties': return <PersonalPage onBack={goHome} activeView="penalties" />;
                    case 'allowances': return <PersonalPage onBack={goHome} activeView="allowances" />;
                    case 'docs': return <PersonalPage onBack={goHome} activeView="docs" />;
                    case 'profile': return <PersonalPage onBack={goHome} activeView="id-photo" />; // Fallback
                    
                    // NEW: User Account View
                    case 'user-account': return <UserAccountPage onBack={goHome} />;
                    
                    default: return <HomeView t={t} openService={setView} />;
                }
            };

            return (
                <div className="min-h-screen relative flex">
                    {/* Sidebar */}
                    <aside className={`md:flex flex-col w-72 bg-white dark:bg-dark-card border-l dark:border-l-0 dark:border-r border-gray-200 dark:border-gray-800 fixed top-0 bottom-0 z-40 shadow-sm transition-all duration-300 ${isAr ? 'right-0 border-l' : 'left-0 border-r'} ${menuOpen ? 'translate-x-0' : 'translate-x-full md:translate-x-0'}`}>
                        <div className="p-8 flex items-center gap-3 mb-2">
                            <div className="w-12 h-12 bg-primary rounded-xl flex items-center justify-center text-white shadow-lg"><GraduationCap size={28}/></div>
                            <div><h1 className="font-bold text-xl tracking-tight text-primary dark:text-teal-400">بوابتي</h1><p className="text-[10px] text-gray-400">جامعة أم القرى</p></div>
                        </div>
                        
                        <div className="px-4 mb-4 space-y-2">
                             <button onClick={() => setView('home')} className={`w-full flex items-center gap-4 px-4 py-3 rounded-lg text-sm font-bold transition-all ${view === 'home' ? 'bg-primary text-white shadow-md' : 'text-gray-600 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-800'}`}>
                                <LayoutDashboard size={20}/> {t.dashboard}
                            </button>
                             <button onClick={() => setView('student-dashboard')} className={`w-full flex items-center gap-4 px-4 py-3 rounded-lg text-sm font-bold transition-all ${view === 'student-dashboard' ? 'bg-primary text-white shadow-md' : 'text-gray-600 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-800'}`}>
                                <PieChart size={20}/> {t['student-dashboard']}
                            </button>
                        </div>

                        <nav className="flex-1 px-4 space-y-1 overflow-y-auto pb-4 custom-scrollbar">
                            {/* Menu Items Rendering */}
                            {menuItems.map(cat => (
                                <div key={cat.id} className="rounded-lg overflow-hidden">
                                    <button 
                                        onClick={() => toggleCategory(cat.id)}
                                        className={`w-full flex items-center justify-between px-4 py-3 text-sm font-bold transition-all ${activeCategory === cat.id ? 'bg-gray-50 dark:bg-gray-800/50 text-primary' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800'}`}
                                    >
                                        {/* Use translation key for category title */}
                                        <div className="flex items-center gap-3">{cat.icon} {t[cat.id]}</div>
                                        <ChevronDown size={16} className={`transition-transform duration-300 ${activeCategory === cat.id ? 'rotate-180' : ''}`}/>
                                    </button>
                                    
                                    <div className={`overflow-hidden transition-all duration-300 ease-in-out ${activeCategory === cat.id ? 'max-h-96 opacity-100' : 'max-h-0 opacity-0'}`}>
                                        <div className="bg-gray-50 dark:bg-gray-800/30 py-2 pr-11 pl-4 space-y-1">
                                            {cat.subItems.map(item => (
                                                <button 
                                                    key={item.id}
                                                    onClick={() => { setView(item.id); if(window.innerWidth < 768) setMenuOpen(false); }}
                                                    className={`w-full text-right text-xs font-bold py-2 px-2 rounded-lg transition-colors flex items-center gap-2 ${view === item.id ? 'text-primary bg-primary/5' : 'text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white'}`}
                                                >
                                                    <div className={`w-1.5 h-1.5 rounded-full ${view === item.id ? 'bg-primary' : 'bg-gray-300'}`}></div>
                                                    {/* Use translation key for sub-item label */}
                                                    {t[item.id]}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </nav>

                        {/* User Profile Mini Footer with onClick */}
                        <div className="p-4 border-t border-gray-100 dark:border-gray-800">
                             <button 
                                onClick={() => { setView('user-account'); if(window.innerWidth < 768) setMenuOpen(false); }}
                                className="w-full flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition text-right"
                             >
                                <div className="w-10 h-10 rounded-full bg-gray-200 overflow-hidden border border-gray-300">
                                     <div className="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400"><User size={20}/></div>
                                </div>
                                <div className="overflow-hidden">
                                    <h4 className="font-bold text-xs truncate text-gray-800 dark:text-gray-200">{studentData.name}</h4>
                                    <p className="text-[10px] text-gray-400 truncate">{studentData.id}</p>
                                </div>
                             </button>
                        </div>
                    </aside>
                    
                    {/* Mobile Overlay */}
                    {menuOpen && <div className="fixed inset-0 bg-black/50 z-30 md:hidden" onClick={() => setMenuOpen(false)}></div>}

                    <main className={`flex-1 w-full pb-20 md:pb-10 transition-all duration-300 ${isAr ? 'md:mr-72' : 'md:ml-72'}`}>
                        <header className="bg-white/80 dark:bg-dark-card/80 backdrop-blur-md sticky top-0 z-30 border-b border-gray-200 dark:border-gray-800 px-6 py-4 flex justify-between items-center shadow-sm">
                            <button onClick={() => setMenuOpen(!menuOpen)} className="md:hidden p-2 hover:bg-gray-100 rounded-lg"><Menu size={24} className="text-gray-600"/></button>
                            <h2 className="text-xl font-bold text-gray-800 dark:text-white">{t[view] || t.dashboard}</h2>
                            <div className="flex gap-3"><button onClick={() => setLang(lang === 'ar'?'en':'ar')} className="p-2 bg-gray-100 rounded-full text-xs font-bold w-10 h-10">EN/ع</button><button onClick={() => setDarkMode(!darkMode)} className="p-2 bg-gray-100 rounded-full">{darkMode ? <Sun size={20}/> : <Moon size={20}/>}</button></div>
                        </header>
                        <div className="p-6 max-w-7xl mx-auto">{renderContent()}</div>
                        {/* Chatbot integrated globally */}
                        <Chatbot t={t} />
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>