<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿ®Ÿàÿßÿ®ÿ™Ÿä ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ© - ÿ¨ÿßŸÖÿπÿ© ÿ£ŸÖ ÿßŸÑŸÇÿ±Ÿâ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#006771', dark: '#004d55', light: '#008c99' },
                        gold: { DEFAULT: '#B18E51' },
                        dark: { bg: '#0f172a', card: '#1e293b', text: '#f1f5f9' }
                    },
                    fontFamily: { sans: ['IBM Plex Sans Arabic', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'IBM Plex Sans Arabic', sans-serif; }
        ::-webkit-scrollbar { width: 6px; background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Chatbot Animations */
        .chat-enter { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <!-- Import Map for Stable Loading -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-dark-bg dark:text-dark-text transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            LayoutDashboard, GraduationCap, CheckCircle2, FileText, User, 
            Bell, Menu, Search, LogOut, ArrowRight, Clock, MapPin, 
            Calendar, BookOpen, AlertCircle, TrendingUp, X, Hash, 
            Camera, ShieldAlert, Coins, Award, FileCheck, Layers, 
            PlusCircle, MinusCircle, RefreshCw, Printer, Download,
            Link, Check, AlertTriangle, Moon, Sun, Send, MessageCircle, Lock,
            ChevronDown, ChevronLeft, CreditCard, FileBadge, Image as ImageIcon, 
            Ban, Gift, ScrollText, Upload, Wallet, FileSignature, PieChart, Medal
        } from 'lucide-react';

        // --- Mock Data ---
        const studentData = {
            name: "ŸÅŸäÿµŸÑ ÿπÿ®ÿØÿßŸÑŸÑŸá ÿßŸÑÿÆÿßŸÑÿØ",
            id: "444002548",
            major: "ŸáŸÜÿØÿ≥ÿ© ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™",
            gpa: 3.35,
            completedHours: 40,
            currentHours: 18,
            totalHours: 120,
            avatar: null 
        };

        const translations = {
            ar: {
                welcome: "ŸÖÿ±ÿ≠ÿ®ÿßŸã", dashboard: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©", academic: "ÿ£ŸÉÿßÿØŸäŸÖŸä",
                registration: "ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ", requests: "ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™", personal: "ÿ¥ÿÆÿµŸä",
                gpa: "ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä", progress: "ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤", todaysLectures: "ŸÖÿ≠ÿßÿ∂ÿ±ÿßÿ™ ÿßŸÑŸäŸàŸÖ",
                upcomingExams: "ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÇÿßÿØŸÖÿ©", attendance: "ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿ∂Ÿàÿ±", quickActions: "ÿßŸÑŸàÿµŸàŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπ",
                schedule: "ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä", results: "ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨", plan: "ÿßŸÑÿÆÿ∑ÿ© ÿßŸÑÿØÿ±ÿßÿ≥Ÿäÿ©", addDrop: "ÿßŸÑÿ≠ÿ∞ŸÅ ŸàÿßŸÑÿ•ÿ∂ÿßŸÅÿ©",
                searchPlaceholder: "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿÆÿØŸÖÿ©...", statusRegular: "ŸÖŸÜÿ™ÿ∏ŸÖ", now: "ÿßŸÑÿ¢ŸÜ",
                chatbotTitle: "ÿßŸÑŸÖÿ≥ÿßÿπÿØ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä (ÿ≥ŸÜÿØ)", typeMessage: "ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ...",
                back: "ÿπŸàÿØÿ©", print: "ÿ∑ÿ®ÿßÿπÿ©", download: "ÿ™ÿ≠ŸÖŸäŸÑ",
                hoursCompleted: "ŸÖŸÜÿ¨ÿ≤ÿ©", hoursCurrent: "ÿ≠ÿßŸÑŸäÿ©", hoursRemaining: "ŸÖÿ™ÿ®ŸÇŸäÿ©",
                analytics: "ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™", // Category Title
                'student-dashboard': 'ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™', // NEW Dashboard Item
                exams: 'ÿ¨ÿØŸàŸÑ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™', 
                absences: 'ÿßŸÑÿ∫Ÿäÿßÿ®ÿßÿ™', 
                record: 'ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä',
                // Registration Sub-items
                'offered-courses': 'ÿßŸÑŸÖŸÇÿ±ÿ±ÿßÿ™ ÿßŸÑŸÖÿ∑ÿ±Ÿàÿ≠ÿ©',
                'addDrop': 'ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä',
                'dept-add': 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÇÿ±ÿ± (ÿßŸÑŸÇÿ≥ŸÖ)',
                'dept-change': 'ÿ™ÿ∫ŸäŸäÿ± ÿ¥ÿπÿ®ÿ© (ÿßŸÑŸÇÿ≥ŸÖ)',
                'dept-drop': 'ÿ≠ÿ∞ŸÅ ŸÖŸÇÿ±ÿ± (ÿßŸÑŸÇÿ≥ŸÖ)',
                'reg-requests': 'ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ',
                withdraw: 'ÿßŸÜÿ≥ÿ≠ÿßÿ® ŸÖŸÜ ŸÖŸÇÿ±ÿ±',
                // Requests Sub-items
                'academic-action-new': 'ÿ∑ŸÑÿ® ÿ≠ÿ±ŸÉÿ© ÿ£ŸÉÿßÿØŸäŸÖŸäÿ©',
                'academic-action-view': 'ÿπÿ±ÿ∂ ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ©',
                'major-change-new': 'ÿ∑ŸÑÿ® ÿ™ÿ∫ŸäŸäÿ± ÿ™ÿÆÿµÿµ',
                'major-change-view': 'ÿπÿ±ÿ∂ ÿ∑ŸÑÿ®ÿßÿ™ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ™ÿÆÿµÿµ',
                // Personal Sub-items
                penalties: 'ÿßŸÑÿπŸÇŸàÿ®ÿßÿ™',
                rewards: 'ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™',
                finance: 'ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿßŸÑŸä',
                docs: 'ÿßŸÑŸàÿ´ÿßÿ¶ŸÇ ŸàÿßŸÑÿ•ŸÅÿßÿØÿßÿ™',
                allowances: 'ÿßŸÑÿ®ÿØŸÑÿßÿ™',
                'id-photo': 'ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿ¥ÿÆÿµŸäÿ©',
                'user-account': 'ÿ≠ÿ≥ÿßÿ®Ÿä',
                // HomeView hardcoded strings (Arabic is used for consistency in AR mode)
                'total-hours-label': "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿßÿπÿßÿ™",
                'view-all': "ÿπÿ±ÿ∂ ÿßŸÑŸÉŸÑ",
                'upcoming-label': "ŸÇÿßÿØŸÖÿ©",
                'days-label': "ÿ£ŸäÿßŸÖ",
                'month-may': "ŸÖÿßŸäŸà",
                'status-perfect': "ŸÖÿ´ÿßŸÑŸä! ŸàÿßÿµŸÑ ÿ™ŸÖŸäÿ≤ŸÉ üåü",
                'status-safe': "ÿ¢ŸÖŸÜ",
                'status-warning': "ÿ™ÿ≠ÿ∞Ÿäÿ±",
                'status-denial': "ÿ≠ÿ±ŸÖÿßŸÜ",
                'status-high-excused': "ŸÖÿ±ÿ™ŸÅÿπ (ÿ®ÿπÿ∞ÿ±)",
                'status-denial-limit': "ÿ≠ÿ±ŸÖÿßŸÜ (ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑÿ≠ÿØ)",
                // Branding
                appTitle: "ÿ®Ÿàÿßÿ®ÿ™Ÿä",
                uniName: "ÿ¨ÿßŸÖÿπÿ© ÿ£ŸÖ ÿßŸÑŸÇÿ±Ÿâ",
                // New Notification
                notificationTitle: "ÿ™ŸÜÿ®ŸäŸá ŸáÿßŸÖ: ÿØÿ±ÿ¨ÿ© ÿ∫Ÿäÿ± ŸÖÿ±ÿµŸàÿØÿ©",
                notificationBody: "ŸÑŸÖ Ÿäÿ™ŸÖ ÿ±ÿµÿØ ÿØÿ±ÿ¨ÿ© ŸÖŸÇÿ±ÿ± (ŸÜÿ∏ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ) ŸÑŸÑŸÅÿµŸÑ ÿßŸÑÿ≥ÿßÿ®ŸÇ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπ ÿØ. ÿßŸÑŸÖŸáÿßÿØ ŸÅŸàÿ±ÿßŸã.",
                'academic-events': 'ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ©',
            },
            en: {
                welcome: "Welcome", 
                dashboard: "Home", // CHANGED from Dashboard to Home
                academic: "Academic",
                registration: "Registration", 
                requests: "Requests", 
                personal: "Personal",
                gpa: "GPA", 
                progress: "Progress Percentage", 
                todaysLectures: "Today's Lectures",
                upcomingExams: "Upcoming Exams", 
                attendance: "Attendance Status", 
                quickActions: "Quick Access",
                schedule: "Course Schedule", 
                results: "Grades & Results", 
                plan: "Degree Plan", 
                addDrop: "Add/Drop Courses", 
                searchPlaceholder: "Search services...", 
                statusRegular: "Regular Student", 
                now: "Now",
                chatbotTitle: "Academic Assistant (Sanad)", 
                typeMessage: "Type a message...",
                back: "Back", 
                print: "Print", 
                download: "Download",
                hoursCompleted: "Completed Hours", 
                hoursCurrent: "Current Hours", 
                hoursRemaining: "Remaining Hours", 
                analytics: "Analytics", 
                'student-dashboard': 'Student Dashboard', 
                exams: 'Exam Schedule', 
                absences: 'Absences Record', 
                record: 'Academic Record',
                // Registration Sub-items
                'offered-courses': 'Offered Courses',
                'addDrop': 'E-Registration (Add/Drop)',
                'dept-add': 'Add Course (Dept Approval)',
                'dept-change': 'Change Section (Dept Approval)',
                'dept-drop': 'Drop Course (Dept Approval)',
                'reg-requests': 'Registration Requests',
                withdraw: 'Course Withdrawal',
                // Requests Sub-items
                'academic-action-new': 'New Academic Action Request', 
                'academic-action-view': 'View Academic Actions',
                'major-change-new': 'Request Major Change',
                'major-change-view': 'View Major Change Requests',
                // Personal Sub-items
                penalties: 'Penalties & Violations', 
                rewards: 'Rewards Record', 
                finance: 'Financial Record',
                docs: 'Documents & Certificates',
                allowances: 'Allowances',
                'id-photo': 'Personal Photo Upload',
                'user-account': 'My Account',
                
                // --- NEW KEYS FOR HOME VIEW CONTENT (EN) ---
                'total-hours-label': "Total Hours", 
                'view-all': "View All",
                'upcoming-label': "Upcoming",
                'days-label': "days",
                'month-may': "May",
                
                // Attendance Statuses
                'status-perfect': "Perfect! Keep it up üåü",
                'status-safe': "Safe",
                'status-warning': "Warning",
                'status-denial': "Denial",
                'status-high-excused': "High (Excused)",
                'status-denial-limit': "Denial (Limit Exceeded)",
                // Branding
                appTitle: "Bawabati",
                uniName: "Umm Al-Qura University",
                // New Notification
                notificationTitle: "Important Alert: Unrecorded Grade",
                notificationBody: "Grade for (Operating Systems) from previous semester is not recorded. Please contact Dr. Al-Muhad immediately.",
                'academic-events': 'Academic Events', // NEW Translation
            }
        };

        // --- Helper Components ---
        // Updated HeaderPage to accept 'lang' to handle LTR/RTL back arrow direction
        const HeaderPage = ({ title, onBack, extra, lang }) => {
            const isAr = lang === 'ar';
            return (
                <div className="flex items-center justify-between mb-6 animate-fade-in sticky top-0 bg-gray-50/95 dark:bg-dark-bg/95 z-20 py-3 backdrop-blur-sm border-b border-transparent">
                    <div className="flex items-center gap-3">
                        <button onClick={onBack} className="p-2 bg-white dark:bg-dark-card rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 shadow-sm border border-gray-100 dark:border-gray-700 transition-all group">
                             {/* Conditional rotation for the back arrow icon based on language (LTR/RTL convention) */}
                            <ArrowRight size={20} className={`text-gray-500 dark:text-gray-300 group-hover:text-primary transition-transform ${!isAr ? 'rotate-180' : ''}`} />
                        </button>
                        <h2 className="text-xl md:text-2xl font-bold text-gray-800 dark:text-white">{title}</h2>
                    </div>
                    <div className="flex gap-2">{extra}</div>
                </div>
            );
        };

        const ActionCard = ({ icon, title, onClick, color = "primary" }) => (
            <button onClick={onClick} className="group relative flex flex-col items-center justify-center bg-white dark:bg-dark-card p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 hover:border-primary dark:hover:border-primary hover:shadow-md transition-all duration-300 h-28 w-full overflow-hidden">
                <div className={`p-3 rounded-full mb-2 bg-${color === 'primary' ? 'teal' : color}-50 text-${color === 'primary' ? 'teal' : color}-600 dark:text-${color === 'primary' ? 'teal' : color}-400 group-hover:scale-110 transition-transform`}>
                    {icon}
                </div>
                <span className="text-xs font-bold text-gray-600 dark:text-gray-300 group-hover:text-primary dark:group-hover:text-teal-400 text-center">{title}</span>
            </button>
        );

        // --- NEW: Chatbot Component ---
        const Chatbot = ({ t }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([
                { id: 1, text: "ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ Ÿäÿß ŸÅŸäÿµŸÑ! ÿ£ŸÜÿß ÿ≥ŸÜÿØÿå ŸÖÿ≥ÿßÿπÿØŸÉ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä. ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ÿÆÿØŸÖÿ™ŸÉ ÿßŸÑŸäŸàŸÖÿü", sender: 'bot' }
            ]);
            const [input, setInput] = useState("");
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, isOpen]);

            const handleSend = () => {
                if (!input.trim()) return;
                const userMsg = { id: Date.now(), text: input, sender: 'user' };
                setMessages(prev => [...prev, userMsg]);
                setInput("");
                
                // Mock response simulation
                setTimeout(() => {
                    const responses = [
                        "ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ŸÅŸä ÿßÿ≥ÿ™ÿπÿ±ÿßÿ∂ ÿ¨ÿØŸàŸÑŸÉ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä ÿ£Ÿà ŸÖÿ™ÿßÿ®ÿπÿ© ÿ∑ŸÑÿ®ÿßÿ™ŸÉ.",
                        "ŸáŸÑ ÿ™ŸàÿØ ÿßŸÑÿßÿ≥ÿ™ŸÅÿ≥ÿßÿ± ÿπŸÜ ŸÖŸàÿßÿπŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅ ŸàÿßŸÑÿ•ÿ∂ÿßŸÅÿ©ÿü",
                        "ŸäŸÖŸÉŸÜŸÉ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑÿÆÿØŸÖÿßÿ™ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ© ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ¨ÿßŸÜÿ®Ÿäÿ©.",
                        "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≥ÿ¨ŸÑŸÉ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä..."
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    setMessages(prev => [...prev, { 
                        id: Date.now() + 1, 
                        text: randomResponse, 
                        sender: 'bot' 
                    }]);
                }, 1000);
            };

            return (
                <>
                    <button 
                        onClick={() => setIsOpen(!isOpen)} 
                        className={`fixed bottom-6 left-6 z-50 p-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110 ${isOpen ? 'bg-red-500 rotate-90' : 'bg-primary animate-bounce'} text-white border-4 border-white dark:border-dark-bg`}
                    >
                        {isOpen ? <X size={24}/> : <MessageCircle size={28}/>}
                    </button>

                    {isOpen && (
                        <div className="fixed bottom-24 left-6 z-40 w-[90vw] md:w-96 bg-white dark:bg-dark-card rounded-3xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden flex flex-col chat-enter h-[500px] max-h-[70vh]">
                            <div className="bg-gradient-to-r from-primary to-teal-800 p-4 flex items-center gap-3 shadow-md">
                                <div className="p-2 bg-white/20 rounded-full text-white backdrop-blur-sm shadow-inner"><User size={20}/></div>
                                <div>
                                    <h3 className="font-bold text-white text-base">{t.chatbotTitle}</h3>
                                    <span className="flex items-center gap-1.5 text-[10px] text-teal-100 font-medium"><div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div> ŸÖÿ™ÿµŸÑ ÿßŸÑÿ¢ŸÜ</span>
                                </div>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-800/30">
                                {messages.map(msg => (
                                    <div key={msg.id} className={`flex ${msg.sender === 'user' ? 'justify-start' : 'justify-end'} animate-fade-in`}>
                                        <div className={`max-w-[80%] p-3.5 rounded-2xl text-sm leading-relaxed shadow-sm ${msg.sender === 'user' ? 'bg-primary text-white rounded-br-none' : 'bg-white dark:bg-gray-700 text-gray-800 dark:text-white rounded-bl-none border border-gray-100 dark:border-gray-600'}`}>
                                            {msg.text}
                                        </div>
                                    </div>
                                ))}
                                <div ref={messagesEndRef} />
                            </div>

                            <div className="p-3 bg-white dark:bg-dark-card border-t border-gray-100 dark:border-gray-700 flex gap-2 items-center">
                                <input 
                                    type="text" 
                                    value={input}
                                    onChange={e => setInput(e.target.value)}
                                    onKeyPress={e => e.key === 'Enter' && handleSend()}
                                    placeholder={t.typeMessage}
                                    className="flex-1 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl px-4 py-3 text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary/20 transition-all dark:text-white"
                                />
                                <button onClick={handleSend} disabled={!input.trim()} className="p-3 bg-primary text-white rounded-2xl hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-sm active:scale-95">
                                    <Send size={18} className="rotate-180"/>
                                </button>
                            </div>
                        </div>
                    )}
                </>
            );
        };

        const Toast = ({ message, type, onClose }) => (
            <div className={`fixed bottom-4 left-4 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg text-white font-bold text-sm animate-fade-in ${type === 'success' ? 'bg-emerald-600' : 'bg-red-600'}`}>
                {type === 'success' ? <CheckCircle2 size={18}/> : <AlertTriangle size={18}/>}
                {message}
                <button onClick={onClose} className="mr-2 opacity-80 hover:opacity-100"><X size={14}/></button>
            </div>
        );

        // --- UPDATED: Notification Bell (Navigates to Page) ---
        const NotificationBell = ({ onClick }) => {
            return (
                <div className="relative z-50">
                    <button 
                        onClick={onClick} 
                        className="p-2 relative bg-white dark:bg-dark-card rounded-lg border border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition shadow-sm group"
                    >
                        <Bell size={20} className="text-gray-600 dark:text-gray-300 group-hover:text-primary transition-colors"/>
                        <span className="absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse border-2 border-white dark:border-dark-card"></span>
                    </button>
                </div>
            )
        };

        // --- NEW: Notifications Page ---
        const NotificationsPage = ({ onBack, lang }) => {
            const isAr = lang === 'ar';
            const t = {
                title: isAr ? "ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™" : "Notifications",
                markRead: isAr ? "ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ ŸÉŸÖŸÇÿ±Ÿàÿ°" : "Mark all as read",
                empty: isAr ? "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ŸÜÿ®ŸäŸáÿßÿ™" : "No notifications",
                now: isAr ? "ÿßŸÑÿ¢ŸÜ" : "Now",
                minAgo: isAr ? "ÿØ" : "m",
                hourAgo: isAr ? "ÿ≥" : "h",
                dayAgo: isAr ? "ŸäŸàŸÖ" : "d"
            };

            const notifications = [
                { id: 1, type: 'alert', title: isAr ? "ÿ™ŸÜÿ®ŸäŸá ŸáÿßŸÖ: ÿØÿ±ÿ¨ÿ© ÿ∫Ÿäÿ± ŸÖÿ±ÿµŸàÿØÿ©" : "Important: Unrecorded Grade", body: isAr ? "ŸÑŸÖ Ÿäÿ™ŸÖ ÿ±ÿµÿØ ÿØÿ±ÿ¨ÿ© ŸÖŸÇÿ±ÿ± (ŸÜÿ∏ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ) ŸÑŸÑŸÅÿµŸÑ ÿßŸÑÿ≥ÿßÿ®ŸÇ." : "Grade for OS course not recorded.", time: t.now, read: false },
                { id: 2, type: 'info', title: isAr ? "ÿ™ÿ∞ŸÉŸäÿ±: ŸÖŸàÿπÿØ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ" : "Reminder: Registration", body: isAr ? "Ÿäÿ®ÿØÿ£ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ŸÑŸÑŸÅÿµŸÑ ÿßŸÑŸÇÿßÿØŸÖ ŸäŸàŸÖ ÿßŸÑÿ£ÿ≠ÿØ." : "Registration starts on Sunday.", time: `2 ${t.hourAgo}`, read: false },
                { id: 3, type: 'success', title: isAr ? "ÿ™ŸÖ ŸÇÿ®ŸàŸÑ ÿßŸÑÿ∑ŸÑÿ®" : "Request Approved", body: isAr ? "ÿ™ŸÖÿ™ ÿßŸÑŸÖŸàÿßŸÅŸÇÿ© ÿπŸÑŸâ ÿ∑ŸÑÿ® ÿßŸÑÿßÿπÿ™ÿ∞ÿßÿ± ÿπŸÜ ÿßŸÑŸÖŸÇÿ±ÿ±." : "Course withdrawal approved.", time: `1 ${t.dayAgo}`, read: true },
                { id: 4, type: 'warning', title: isAr ? "ÿ•ÿπÿßÿØÿ© ŸÉÿ™ÿßÿ®ÿ© ÿßŸÑŸÉÿ™ÿ®" : "Book Return", body: isAr ? "Ÿäÿ±ÿ¨Ÿâ ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÉÿ™ÿ® ÿßŸÑŸÖÿ≥ÿ™ÿπÿßÿ±ÿ© ŸÑŸÑŸÖŸÉÿ™ÿ®ÿ©." : "Please return borrowed books.", time: `3 ${t.dayAgo}`, read: true }
            ];

            const getIcon = (type) => {
                switch(type) {
                    case 'alert': return <AlertTriangle size={20} className="text-red-500"/>;
                    case 'success': return <CheckCircle2 size={20} className="text-green-500"/>;
                    case 'warning': return <AlertCircle size={20} className="text-orange-500"/>;
                    default: return <Bell size={20} className="text-blue-500"/>;
                }
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} extra={
                        <button className="text-xs font-bold text-primary hover:bg-primary/10 px-3 py-1.5 rounded-lg transition">{t.markRead}</button>
                    } />
                    
                    <div className="space-y-3">
                        {notifications.map(n => (
                            <div key={n.id} className={`p-4 rounded-2xl border flex gap-4 transition-all hover:shadow-md ${n.read ? 'bg-white dark:bg-dark-card border-gray-100 dark:border-gray-700 opacity-80' : 'bg-white dark:bg-dark-card border-l-4 border-l-primary border-t-gray-100 border-r-gray-100 border-b-gray-100 dark:border-t-gray-700 dark:border-r-gray-700 dark:border-b-gray-700 shadow-sm'}`}>
                                <div className={`p-3 rounded-full h-fit shrink-0 ${n.read ? 'bg-gray-100 dark:bg-gray-800 text-gray-400' : 'bg-gray-50 dark:bg-gray-800'}`}>
                                    {getIcon(n.type)}
                                </div>
                                <div className="flex-1">
                                    <div className="flex justify-between items-start">
                                        <h4 className={`font-bold text-sm ${n.read ? 'text-gray-700 dark:text-gray-300' : 'text-gray-900 dark:text-white'}`}>{n.title}</h4>
                                        <span className="text-[10px] text-gray-400 font-medium whitespace-nowrap">{n.time}</span>
                                    </div>
                                    <p className="text-xs text-gray-500 dark:text-gray-400 mt-1 leading-relaxed">{n.body}</p>
                                </div>
                                {!n.read && <div className="self-center w-2 h-2 rounded-full bg-red-500 shrink-0"></div>}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- NEW: StudentDashboardPage (Fixed Implementation) ---
        const StudentDashboardPage = ({ onBack, lang }) => {
            const isAr = lang === 'ar';
            
            // Translations
            const t = {
                title: isAr ? "ŸÑŸàÿ≠ÿ© ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ∑ÿßŸÑÿ®" : "Student Dashboard",
                registered: isAr ? "ÿßŸÑŸÖŸÇÿ±ÿ±ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ¨ŸÑÿ©" : "Registered Courses",
                remaining: isAr ? "ÿßŸÑŸÖŸÇÿ±ÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ©" : "Remaining Courses",
                earned: isAr ? "ÿßŸÑÿ≥ÿßÿπÿßÿ™ ÿßŸÑŸÖŸÉÿ™ÿ≥ÿ®ÿ©" : "Earned Hours",
                gpaAnalysis: isAr ? "ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä" : "GPA Analysis",
                semGPA: isAr ? "ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑŸÅÿµŸÑŸä" : "Semester GPA",
                attStats: isAr ? "ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑÿ∫Ÿäÿßÿ®" : "Attendance Statistics",
                attDesc: isAr ? "ÿ™Ÿàÿ∂Ÿäÿ≠ ŸÑŸÜÿ≥ÿ® ÿßŸÑÿ≠ÿ∂Ÿàÿ± (ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿßŸÑŸÖŸÑŸàŸÜÿ©) ŸàŸÖŸÇÿØÿßÿ± ÿßŸÑÿ∫Ÿäÿßÿ® ŸÑŸÉŸÑ ŸÖŸÇÿ±ÿ±" : "Attendance percentages (colored bars) and absence count per course",
                safe: isAr ? "ÿ¢ŸÖŸÜ" : "Safe",
                warning: isAr ? "ÿ™ŸÜÿ®ŸäŸá" : "Warning",
                denial: isAr ? "ÿ≠ÿ±ŸÖÿßŸÜ" : "Denial",
                absence: isAr ? "ÿ∫Ÿäÿßÿ®" : "Absence",
                hours: isAr ? "ÿ≥ÿßÿπÿßÿ™" : "Hrs"
            };

            // Data matching the image - Reduced to 4 Levels
            const gpaData = [
                { sem: isAr ? 'ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 1' : 'Level 1', gpa: 3.85 },
                { sem: isAr ? 'ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 2' : 'Level 2', gpa: 3.60 },
                { sem: isAr ? 'ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 3' : 'Level 3', gpa: 3.45 },
                { sem: isAr ? 'ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 4' : 'Level 4', gpa: 3.35 }
            ];

            const [hoveredPoint, setHoveredPoint] = useState(null);
            
            // Chart Configuration
            const chartHeight = 220; 
            const chartWidth = 800;
            const paddingX = 80; 
            const paddingY = 50; 
            const maxGPA = 4.0;
            const minGPA = 2.0;

            const points = gpaData.map((item, index) => {
                // RTL: Calculate x from right to left
                const step = (chartWidth - (paddingX * 2)) / (gpaData.length - 1);
                const xPos = chartWidth - paddingX - (index * step);
                
                // Y Position inverted (SVG coords)
                const yPos = chartHeight - paddingY - ((item.gpa - minGPA) / (maxGPA - minGPA)) * (chartHeight - (paddingY * 2));
                return { x: xPos, y: yPos, ...item };
            });

            // Create Path Commands
            const linePath = "M" + points.map(p => `${p.x},${p.y}`).join(" L");
            const areaPath = `${linePath} L${points[points.length-1].x},${chartHeight - paddingY} L${points[0].x},${chartHeight - paddingY} Z`;

            // Attendance Data
            const attendanceStats = isAr ? [
                { code: 'SE301', name: 'ŸáŸÜÿØÿ≥ÿ© ÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™', pct: 98, absent: 1, total: 45 },
                { code: 'CS305', name: 'ŸÜÿ∏ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ', pct: 91, absent: 4, total: 45 },
                { code: 'MATH201', name: 'ÿ•ÿ≠ÿµÿßÿ° ŸáŸÜÿØÿ≥Ÿä', pct: 85, absent: 6, total: 40 },
                { code: 'PHYS101', name: 'ŸÅŸäÿ≤Ÿäÿßÿ° ÿπÿßŸÖÿ©', pct: 75, absent: 12, total: 48 }, 
                { code: 'ISL102', name: 'ÿ´ŸÇÿßŸÅÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ©', pct: 100, absent: 0, total: 30 },
            ] : [
                { code: 'SE301', name: 'Software Engineering', pct: 98, absent: 1, total: 45 },
                { code: 'CS305', name: 'Operating Systems', pct: 91, absent: 4, total: 45 },
                { code: 'MATH201', name: 'Engineering Statistics', pct: 85, absent: 6, total: 40 },
                { code: 'PHYS101', name: 'General Physics', pct: 75, absent: 12, total: 48 }, 
                { code: 'ISL102', name: 'Islamic Culture', pct: 100, absent: 0, total: 30 },
            ];

            const academicWarnings = 0;

            return (
                <div className="animate-fade-in space-y-6 pb-10">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} />
                    
                    {/* Top Cards Row */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {/* Registered Courses */}
                        <div className="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center text-center h-48 transition hover:shadow-md">
                            <div className="mb-4 text-primary bg-primary/10 p-4 rounded-full"><BookOpen size={32} strokeWidth={1.5} /></div>
                            <h3 className="text-gray-500 font-bold mb-2">{t.registered}</h3>
                            <span className="text-3xl font-bold text-gray-800 dark:text-white">6</span>
                        </div>

                        {/* Remaining Courses */}
                        <div className="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center text-center h-48 transition hover:shadow-md">
                            <div className="mb-4 text-blue-600 bg-blue-50 p-4 rounded-full"><Layers size={32} strokeWidth={1.5} /></div>
                            <h3 className="text-gray-500 font-bold mb-2">{t.remaining}</h3>
                            <span className="text-3xl font-bold text-gray-800 dark:text-white">22</span>
                        </div>

                        {/* Earned Hours */}
                        <div className="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center text-center h-48 transition hover:shadow-md">
                            <div className="mb-4 text-gold bg-yellow-50 p-4 rounded-full"><Medal size={32} strokeWidth={1.5} /></div>
                            <h3 className="text-gray-500 font-bold mb-2">{t.earned}</h3>
                            <span className="text-3xl font-bold text-gray-800 dark:text-white">60</span>
                        </div>
                    </div>

                    {/* Middle: GPA Comparison Chart (Interactive) */}
                    <div className="bg-white dark:bg-dark-card rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold text-primary dark:text-teal-400">{t.gpaAnalysis}</h3>
                            <div className="flex gap-2">
                                <span className="text-xs font-bold text-gray-400 flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-primary"></div> {t.semGPA}</span>
                            </div>
                        </div>
                        
                        <div className="w-full overflow-hidden relative">
                            {/* --- Center Display Overlay (Smaller Version) --- */}
                            <div className={`absolute inset-0 flex items-center justify-center pointer-events-none z-10 transition-all duration-300 ${hoveredPoint ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'}`}>
                                <div className="bg-white/95 dark:bg-dark-card/95 backdrop-blur-md px-6 py-3 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-600 text-center min-w-[140px]">
                                    <p className="text-[10px] text-gray-400 font-bold mb-0.5 uppercase tracking-wider">{hoveredPoint?.sem}</p>
                                    <div className="flex items-baseline justify-center gap-1">
                                        <span className="text-3xl font-bold text-primary dark:text-teal-400 font-mono tracking-tighter drop-shadow-sm">{hoveredPoint?.gpa.toFixed(2)}</span>
                                        <span className="text-[10px] text-gray-400 font-mono">/ 4.00</span>
                                    </div>
                                    <div className="w-full h-1 bg-gray-100 dark:bg-gray-700 rounded-full mt-2 overflow-hidden">
                                        <div className="h-full bg-primary transition-all duration-300" style={{ width: hoveredPoint ? `${(hoveredPoint.gpa / 4.0) * 100}%` : '0%' }}></div>
                                    </div>
                                </div>
                            </div>

                            <div className="w-full h-80 relative select-none">
                                <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="w-full h-full overflow-visible">
                                    <defs>
                                        <linearGradient id="chartFill" x1="0" x2="0" y1="0" y2="1">
                                            <stop offset="0%" stopColor="#006771" stopOpacity="0.3"/>
                                            <stop offset="100%" stopColor="#006771" stopOpacity="0"/>
                                        </linearGradient>
                                        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                                            <feDropShadow dx="0" dy="2" stdDeviation="2" floodOpacity="0.2"/>
                                        </filter>
                                    </defs>

                                    {/* Grid Lines */}
                                    {[2.5, 3.0, 3.5, 4.0].map((val, i) => {
                                        const y = chartHeight - paddingY - ((val - minGPA) / (maxGPA - minGPA)) * (chartHeight - (paddingY * 2));
                                        return (
                                            <g key={i}>
                                                <line x1={paddingX} y1={y} x2={chartWidth - paddingX} y2={y} stroke="#e5e7eb" strokeWidth="1" strokeDasharray="4"/>
                                                <text x={chartWidth - paddingX + 10} y={y + 4} className="text-[10px] fill-gray-400 font-mono">{val.toFixed(1)}</text>
                                            </g>
                                        );
                                    })}

                                    {/* Area */}
                                    <path d={areaPath} fill="url(#chartFill)" />

                                    {/* Line */}
                                    <path d={linePath} fill="none" stroke="#006771" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" filter="url(#shadow)" />
                                    
                                    {/* Points and Interaction */}
                                    {points.map((p, i) => (
                                        <g key={i} 
                                           onMouseEnter={() => setHoveredPoint(p)} 
                                           onMouseLeave={() => setHoveredPoint(null)}
                                           className="cursor-pointer group"
                                        >
                                            {/* Hit Area (Invisible larger circle) */}
                                            <circle cx={p.x} cy={p.y} r="35" fill="transparent" />
                                            
                                            {/* Visible Point */}
                                            <circle 
                                                cx={p.x} 
                                                cy={p.y} 
                                                r={hoveredPoint === p ? 10 : 6} 
                                                fill={hoveredPoint === p ? "#B18E51" : "white"} 
                                                stroke="#006771" 
                                                strokeWidth={hoveredPoint === p ? 0 : 3}
                                                className="transition-all duration-300"
                                            />

                                            {/* Fixed Small Label (Always visible) */}
                                            <text 
                                                x={p.x} 
                                                y={p.y - 15} 
                                                textAnchor="middle" 
                                                className={`text-[10px] font-bold fill-gray-500 dark:fill-gray-400 font-mono transition-opacity duration-300 ${hoveredPoint === p ? 'opacity-0' : 'opacity-100'}`}
                                            >
                                                {p.gpa.toFixed(2)}
                                            </text>

                                            {/* X-Axis Labels */}
                                            <text x={p.x} y={chartHeight - 5} textAnchor="middle" className={`text-xs font-bold transition-all ${hoveredPoint === p ? 'fill-primary text-base' : 'fill-gray-500 dark:fill-gray-400'}`}>
                                                {p.sem}
                                            </text>
                                        </g>
                                    ))}
                                </svg>
                            </div>
                        </div>
                    </div>

                    {/* Bottom Row */}
                    <div className="grid grid-cols-1 gap-6">
                        {/* Attendance Bar Chart - Full Width - Redesigned for Clarity */}
                        <div className="bg-white dark:bg-dark-card rounded-2xl p-8 shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col">
                            {/* Header */}
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                                <div>
                                    <h3 className="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
                                        <FileCheck size={24} className="text-primary" />
                                        {t.attStats}
                                    </h3>
                                    <p className="text-xs text-gray-500 mt-1">{t.attDesc}</p>
                                </div>
                                <div className="flex flex-wrap gap-3 text-[10px] font-bold bg-gray-50 dark:bg-gray-800/50 p-2 rounded-lg border border-gray-100 dark:border-gray-700">
                                    <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 rounded bg-emerald-500"></div> {t.safe} (&lt;5%)</div>
                                    <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 rounded bg-amber-400"></div> {t.warning} (5-14%)</div>
                                    <div className="flex items-center gap-1.5"><div className="w-2.5 h-2.5 rounded bg-red-500"></div> {t.denial} (&ge;15%)</div>
                                </div>
                            </div>

                            {/* Chart Area */}
                            <div className="relative w-full h-[400px]">
                                {/* Grid Lines removed as requested */}

                                {/* Bars Container */}
                                <div className="absolute inset-0 flex items-end justify-around px-2 pb-6 pt-12 z-10">
                                    {attendanceStats.map((item, i) => {
                                        const absencePct = Math.round((item.absent / item.total) * 100);
                                        const attendancePct = 100 - absencePct;
                                        
                                        // Simple Color Logic
                                        let barColor = 'bg-emerald-500';
                                        let lightColor = 'bg-emerald-50 dark:bg-emerald-900/10';
                                        let textColor = 'text-emerald-600 dark:text-emerald-400';
                                        
                                        if(absencePct >= 15) { 
                                            barColor = 'bg-red-500'; 
                                            lightColor = 'bg-red-50 dark:bg-red-900/10';
                                            textColor = 'text-red-600 dark:text-red-400';
                                        } else if (absencePct >= 5) {
                                            barColor = 'bg-amber-400';
                                            lightColor = 'bg-amber-50 dark:bg-amber-900/10';
                                            textColor = 'text-amber-600 dark:text-amber-400';
                                        }

                                        return (
                                            <div key={i} className="relative flex flex-col items-center justify-end h-full w-full max-w-[80px] group cursor-pointer">
                                                
                                                {/* Percentage Bubble (Floats above bar) */}
                                                <div className={`mb-3 px-3 py-1 rounded-lg text-sm font-bold shadow-sm border border-transparent transition-all transform group-hover:-translate-y-2 ${lightColor} ${textColor}`}>
                                                    {absencePct}% <span className="text-[10px] opacity-70 font-normal">{t.absence}</span>
                                                </div>

                                                {/* The Bar */}
                                                <div className="w-12 md:w-16 bg-gray-100 dark:bg-gray-800 rounded-t-lg relative overflow-hidden h-full flex items-end shadow-inner">
                                                    <div 
                                                        className={`w-full ${barColor} rounded-t-lg transition-all duration-1000 ease-out relative`}
                                                        style={{ height: `${attendancePct}%` }}
                                                    >
                                                        {/* Simple gradient overlay for depth */}
                                                        <div className="absolute inset-0 bg-gradient-to-b from-white/20 to-transparent"></div>
                                                    </div>
                                                </div>

                                                {/* Subject Name - Improved Visibility & Wrapping */}
                                                <div className="mt-3 text-xs md:text-sm font-bold text-gray-800 dark:text-white text-center w-full leading-tight px-0.5 min-h-[2.5rem] flex items-start justify-center" title={item.name}>
                                                    <span className="line-clamp-2">{item.name}</span>
                                                </div>
                                                
                                                {/* Hours Detail (Small under name) */}
                                                <div className="text-[10px] text-gray-500 dark:text-gray-400 font-mono mt-0.5">
                                                    -{item.absent} {t.hours}
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- NEW: Academic Events Page ---
        const AcademicEventsPage = ({ onBack, lang }) => {
            const isAr = lang === 'ar';
            const [now, setNow] = useState(new Date());

            useEffect(() => {
                const timer = setInterval(() => setNow(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            const t = {
                title: isAr ? "ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ©" : "Academic Events",
                assignment: isAr ? "Ÿàÿßÿ¨ÿ®" : "Assignment",
                project: isAr ? "ŸÖÿ¥ÿ±Ÿàÿπ" : "Project",
                exam: isAr ? "ÿßÿÆÿ™ÿ®ÿßÿ±" : "Exam",
                remaining: isAr ? "ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä" : "Time Remaining",
                days: isAr ? "ŸäŸàŸÖ" : "d",
                hours: isAr ? "ÿ≥" : "h",
                min: isAr ? "ÿØ" : "m",
                sec: isAr ? "ÿ´" : "s",
                completed: isAr ? "ŸÖŸÜÿ™ŸáŸâ" : "Completed",
                due: isAr ? "ŸÖŸàÿπÿØ ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ" : "Due Date"
            };

            const events = [
                { id: 1, type: 'assignment', course: 'CS101', title: isAr ? 'Ÿàÿßÿ¨ÿ® 1: ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿßÿ™' : 'Homework 1: Algorithms', dueDate: new Date(Date.now() + 86400000 * 2 + 3600000 * 5) }, 
                { id: 2, type: 'project', course: 'CS204', title: isAr ? 'ŸÖÿ¥ÿ±Ÿàÿπ ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿßÿ™' : 'Algorithms Project', dueDate: new Date(Date.now() + 86400000 * 14) }, 
                { id: 3, type: 'exam', course: 'MATH201', title: isAr ? 'ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÜÿµŸÅŸä' : 'Midterm Exam', dueDate: new Date(Date.now() + 86400000 * 5 + 3600000 * 2) }, 
                { id: 4, type: 'assignment', course: 'SE301', title: isAr ? 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™' : 'Requirements Analysis', dueDate: new Date(Date.now() + 3600000 * 24) }, 
            ];

            const getTimeRemaining = (dueDate) => {
                const total = Date.parse(dueDate) - Date.parse(now);
                if (total <= 0) return null;
                const seconds = Math.floor((total / 1000) % 60);
                const minutes = Math.floor((total / 1000 / 60) % 60);
                const hours = Math.floor((total / (1000 * 60 * 60)) % 24);
                const days = Math.floor(total / (1000 * 60 * 60 * 24));
                return { total, days, hours, minutes, seconds };
            };

            const getTypeStyle = (type) => {
                switch(type) {
                    case 'exam': return { bg: 'bg-red-50 dark:bg-red-900/10', text: 'text-red-600 dark:text-red-400', border: 'border-red-100 dark:border-red-800' };
                    case 'project': return { bg: 'bg-purple-50 dark:bg-purple-900/10', text: 'text-purple-600 dark:text-purple-400', border: 'border-purple-100 dark:border-purple-800' };
                    default: return { bg: 'bg-blue-50 dark:bg-blue-900/10', text: 'text-blue-600 dark:text-blue-400', border: 'border-blue-100 dark:border-blue-800' };
                }
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} />
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {events.map(event => {
                            const remaining = getTimeRemaining(event.dueDate);
                            const style = getTypeStyle(event.type);
                            return (
                                <div key={event.id} className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm flex flex-col hover:shadow-md transition-all duration-300 overflow-hidden">
                                    <div className={`p-4 border-b ${style.border} ${style.bg}`}>
                                        <div className="flex justify-between items-start">
                                            <span className={`px-2 py-1 rounded-lg text-xs font-bold bg-white/50 dark:bg-black/20 ${style.text}`}>
                                                {t[event.type]}
                                            </span>
                                            <span className="text-xs font-mono font-bold text-gray-500 bg-white/50 dark:bg-black/20 px-2 py-1 rounded">{event.course}</span>
                                        </div>
                                        <h3 className="font-bold text-lg text-gray-800 dark:text-white mt-2 leading-tight">{event.title}</h3>
                                    </div>
                                    
                                    <div className="p-5 flex-1 flex flex-col justify-between gap-4">
                                        <div>
                                            <p className="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1">{t.due}</p>
                                            <div className="text-sm font-medium text-gray-600 dark:text-gray-300 flex items-center gap-2">
                                                <Calendar size={16} className="text-primary"/>
                                                <span className="dir-ltr">{event.dueDate.toLocaleDateString()}</span>
                                                <span className="text-gray-300">|</span>
                                                <span className="dir-ltr">{event.dueDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                                            </div>
                                        </div>

                                        <div className="bg-gray-50 dark:bg-gray-800/50 rounded-xl p-3 border border-gray-100 dark:border-gray-700">
                                            <p className="text-[10px] text-gray-400 font-bold mb-2 text-center">{t.remaining}</p>
                                            {remaining ? (
                                                <div className="flex gap-2 justify-center items-center font-mono text-gray-700 dark:text-gray-200 dir-ltr">
                                                    <div className="text-center"><span className="text-xl font-bold block leading-none">{remaining.days}</span><span className="text-[9px] text-gray-400">{t.days}</span></div>
                                                    <span className="text-gray-300 mb-3">:</span>
                                                    <div className="text-center"><span className="text-xl font-bold block leading-none">{remaining.hours}</span><span className="text-[9px] text-gray-400">{t.hours}</span></div>
                                                    <span className="text-gray-300 mb-3">:</span>
                                                    <div className="text-center"><span className="text-xl font-bold block leading-none">{remaining.minutes}</span><span className="text-[9px] text-gray-400">{t.min}</span></div>
                                                    <span className="text-gray-300 mb-3">:</span>
                                                    <div className="text-center"><span className="text-xl font-bold block leading-none text-primary">{remaining.seconds}</span><span className="text-[9px] text-gray-400">{t.sec}</span></div>
                                                </div>
                                            ) : (
                                                <div className="text-center text-red-500 font-bold flex items-center justify-center gap-2">
                                                    <Clock size={16}/> {t.completed}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // 1. ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä
        const SchedulePage = ({ onBack, t, lang }) => {
            const isAr = lang === 'ar';
            const weekDays = isAr 
                ? ['ÿßŸÑÿ£ÿ≠ÿØ', 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ', 'ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°', 'ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°', 'ÿßŸÑÿÆŸÖŸäÿ≥'] 
                : ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday'];
            
            const timeSlots = [];
            for (let i = 8; i <= 21; i++) {
                const start = i < 10 ? `0${i}` : i;
                const end = i < 10 ? `0${i}` : i;
                // Adjust time format based on language (RTL vs LTR presentation)
                const label = isAr ? `${end}:50 - ${start}:00` : `${start}:00 - ${end}:50`; 
                timeSlots.push({ hour: i, label: label });
            }

            // Labels for the Modal
            const labels = {
                college: isAr ? 'ÿßŸÑŸÉŸÑŸäÿ©' : 'College',
                type: isAr ? 'ÿßŸÑÿ™ÿµŸÜŸäŸÅ' : 'Type',
                mode: isAr ? 'ŸÜŸÖÿ∑ ÿßŸÑÿØÿ±ÿßÿ≥ÿ©' : 'Mode', // inferred label context
                time: isAr ? 'ÿßŸÑŸàŸÇÿ™' : 'Time',
                location: isAr ? 'ÿßŸÑŸÖŸàŸÇÿπ' : 'Location',
                room: isAr ? 'ÿßŸÑŸÇÿßÿπÿ©' : 'Room',
                prof: isAr ? 'ÿπÿ∂Ÿà ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿØÿ±Ÿäÿ≥' : 'Instructor',
                theory: isAr ? 'ŸÜÿ∏ÿ±Ÿä' : 'Theory',
                lab: isAr ? 'ÿπŸÖŸÑŸä' : 'Lab',
                inPerson: isAr ? 'ÿ≠ÿ∂Ÿàÿ±Ÿä' : 'In-Person',
                online: isAr ? 'ÿπŸÜ ÿ®ÿπÿØ' : 'Online'
            };

            // Updated Data with College, Type (Theory/Lab), Mode (In-person/Online)
            const schedule = {
                [weekDays[0]]: [
                    { id: 1, name: isAr ? 'ÿ•ÿ≠ÿµÿßÿ° ŸáŸÜÿØÿ≥Ÿä' : 'Engineering Statistics', code: 'MATH101', start: 8, dur: 2, color: 'bg-[#56AB7C]', text: 'text-white', room: '101', prof: isAr ? 'ÿØ. ÿ£ÿ≠ŸÖÿØ ÿ≥ÿßŸÑŸÖ' : 'Dr. Ahmed Salem', profEmail: 'ahmed.salem@uqu.edu.sa', type: 'lec', mode: 'in-person', bldg: isAr ? 'ŸÇÿßÿπÿ© ÿßŸÑÿÆŸàÿßÿ±ÿ≤ŸÖŸä - ÿßŸÑÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ£ÿ±ÿ∂Ÿä' : 'Al-Khwarizmi Hall - Ground Floor', college: isAr ? 'ÿßŸÑŸÉŸÑŸäÿ© ÿßŸÑÿ¨ÿßŸÖÿπŸäÿ©' : 'University College' },
                    { id: 2, name: isAr ? 'ÿ£ŸÖŸÜ ÿ≥Ÿäÿ®ÿ±ÿßŸÜŸä' : 'Cybersecurity', code: 'CS320', start: 18, dur: 2, color: 'bg-[#0082C0]', text: 'text-white', room: 'Virtual', prof: isAr ? 'ÿØ. ÿ≥ÿßÿ±ÿ© ÿßŸÑÿ¥Ÿáÿ±Ÿä' : 'Dr. Sara Al-Shehri', profEmail: 'sara.shehri@uqu.edu.sa', type: 'lec', mode: 'online', bldg: isAr ? 'ÿπŸÜ ÿ®ÿπÿØ - Blackboard' : 'Online - Blackboard', college: isAr ? 'ŸÉŸÑŸäÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä' : 'College of Computer Science' }
                ],
                [weekDays[1]]: [
                    { id: 3, name: isAr ? 'ÿ™ÿ≠ŸÑŸäŸÑ ŸÉŸäŸÖŸäÿßÿ¶Ÿä' : 'Chemical Analysis', code: 'CH202', start: 10, dur: 2, color: 'bg-[#4F46E5]', text: 'text-white', room: 'Lab 3', prof: isAr ? 'ÿ£. ŸÖÿ≠ŸÖÿØ ÿπŸÑŸä' : 'Mr. Mohamed Ali', profEmail: 'm.ali@uqu.edu.sa', type: 'lab', mode: 'in-person', bldg: isAr ? 'ŸÖÿ®ŸÜŸâ ÿßŸÑŸÖÿπÿßŸÖŸÑ (ÿ®) - ÿßŸÑÿØŸàÿ± ÿßŸÑÿ´ÿßŸÜŸä' : 'Labs Building (B) - 2nd Floor', college: isAr ? 'ŸÉŸÑŸäÿ© ÿßŸÑÿπŸÑŸàŸÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸäÿ©' : 'College of Applied Sciences' },
                    { id: 4, name: isAr ? 'ÿ´ŸÇÿßŸÅÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ©' : 'Islamic Culture', code: 'ISL101', start: 13, dur: 2, color: 'bg-[#E44B45]', text: 'text-white', room: 'Online', prof: isAr ? 'ÿØ. ÿπÿ®ÿØÿßŸÑŸÑŸá' : 'Dr. Abdullah', profEmail: 'abdullah@uqu.edu.sa', type: 'lec', mode: 'online', bldg: isAr ? 'ÿπŸÜ ÿ®ÿπÿØ' : 'Online', college: isAr ? 'ŸÉŸÑŸäÿ© ÿßŸÑÿØÿπŸàÿ© Ÿàÿ£ÿµŸàŸÑ ÿßŸÑÿØŸäŸÜ' : 'College of Da\'wah' }
                ],
                [weekDays[2]]: [
                    { id: 5, name: isAr ? 'ÿ™ÿµŸÖŸäŸÖ Ÿàÿßÿ¨Ÿáÿßÿ™' : 'UI Design', code: 'CS305', start: 16, dur: 2, color: 'bg-[#0082C0]', text: 'text-white', room: '205', prof: isAr ? 'ÿØ. ÿπŸÖÿ±' : 'Dr. Omar', profEmail: 'omar@uqu.edu.sa', type: 'lec', mode: 'in-person', bldg: isAr ? 'ŸÖÿ®ŸÜŸâ ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä - ÿßŸÑÿØŸàÿ± ÿßŸÑÿ´ÿßŸÜŸä' : 'Computer College - 2nd Floor', college: isAr ? 'ŸÉŸÑŸäÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä' : 'College of Computer Science' },
                ],
                [weekDays[3]]: [
                    { id: 7, name: isAr ? 'ÿßŸÑŸÇÿ±ÿ¢ŸÜ ÿßŸÑŸÉÿ±ŸäŸÖ' : 'Holy Quran', code: 'QR101', start: 18, dur: 2, color: 'bg-[#E44B45]', text: 'text-white', room: 'Msj', prof: isAr ? 'ÿØ. ÿÆÿßŸÑÿØ' : 'Dr. Khaled', profEmail: 'khaled@uqu.edu.sa', type: 'lec', mode: 'in-person', bldg: isAr ? 'ÿßŸÑŸÖÿµŸÑŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä' : 'Main Prayer Hall', college: isAr ? 'ŸÉŸÑŸäÿ© ÿßŸÑÿØÿπŸàÿ© Ÿàÿ£ÿµŸàŸÑ ÿßŸÑÿØŸäŸÜ' : 'College of Da\'wah' },
                    { id: 8, name: isAr ? 'ŸÖÿ¥ÿ±Ÿàÿπ ÿ™ÿÆÿ±ÿ¨ 1' : 'Graduation Project 1', code: 'GP401', start: 20, dur: 2, color: 'bg-[#9D79DC]', text: 'text-white', room: 'Lab 1', prof: isAr ? 'ÿ£. ŸÅŸáÿØ' : 'Mr. Fahad', profEmail: 'fahad@uqu.edu.sa', type: 'lab', mode: 'in-person', bldg: isAr ? 'ŸÖÿπŸÖŸÑ ÿßŸÑÿßÿ®ÿ™ŸÉÿßÿ± - ŸÖÿ®ŸÜŸâ 5' : 'Innovation Lab - Bldg 5', college: isAr ? 'ŸÉŸÑŸäÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä' : 'College of Computer Science' }
                ],
                [weekDays[4]]: [
                     { id: 9, name: isAr ? 'ŸÖÿ¥ÿ±Ÿàÿπ ÿ™ÿÆÿ±ÿ¨ 1' : 'Graduation Project 1', code: 'GP401', start: 19, dur: 2, color: 'bg-[#9D79DC]', text: 'text-white', room: 'Lab 1', prof: isAr ? 'ÿ£. ŸÅŸáÿØ' : 'Mr. Fahad', profEmail: 'fahad@uqu.edu.sa', type: 'lab', mode: 'in-person', bldg: isAr ? 'ŸÖÿπŸÖŸÑ ÿßŸÑÿßÿ®ÿ™ŸÉÿßÿ± - ŸÖÿ®ŸÜŸâ 5' : 'Innovation Lab - Bldg 5', college: isAr ? 'ŸÉŸÑŸäÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä' : 'College of Computer Science' }
                ]
            };

            const [selectedLecture, setSelectedLecture] = useState(null);
            
            const formatTimeRange = (start, dur) => {
                const endHour = start + dur - 1;
                const s = start < 10 ? `0${start}` : start;
                const e = endHour < 10 ? `0${endHour}` : endHour;
                // Translation for time range in modal
                return isAr ? `${e}:50 - ${s}:00` : `${s}:00 - ${e}:50`;
            };

            return (
                <div className="animate-fade-in space-y-6 relative h-full">
                    <HeaderPage title={t.schedule} onBack={onBack} lang={lang} extra={
                        <button className="hidden md:flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-teal-700 transition">
                            <Printer size={16}/> {t.print}
                        </button>
                    } />
                    
                    {/* Enhanced Modal */}
                    {selectedLecture && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onClick={() => setSelectedLecture(null)}>
                            <div className="bg-white dark:bg-dark-card w-full max-w-md rounded-3xl shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 transform transition-all scale-100 flex flex-col" onClick={e => e.stopPropagation()}>
                                {/* Header */}
                                <div className={`h-32 ${selectedLecture.color} relative flex flex-col items-center justify-center text-white`}>
                                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                                    <button onClick={() => setSelectedLecture(null)} className="absolute top-4 right-4 bg-black/20 text-white p-2 rounded-full hover:bg-black/40 transition z-10"><X size={20}/></button>
                                    <h3 className="text-2xl font-bold shadow-sm mt-2 relative z-10">{selectedLecture.name}</h3>
                                    <span className="text-sm font-mono opacity-90 bg-white/20 px-3 py-1 rounded-full mt-2 relative z-10 backdrop-blur-sm">{selectedLecture.code}</span>
                                </div>
                                
                                {/* Details Body */}
                                <div className="p-6 space-y-4">
                                    
                                    {/* New Section: College & Type Details */}
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="p-3 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700">
                                            <p className="text-xs text-gray-500 font-bold mb-1">{labels.college}</p>
                                            <p className="font-bold text-gray-800 dark:text-white text-xs">{selectedLecture.college}</p>
                                        </div>
                                        <div className="p-3 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700">
                                            <p className="text-xs text-gray-500 font-bold mb-1">{labels.type}</p>
                                            <div className="flex flex-wrap gap-1">
                                                <span className={`text-[10px] px-2 py-0.5 rounded font-bold ${selectedLecture.type === 'lec' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}`}>
                                                    {selectedLecture.type === 'lec' ? labels.theory : labels.lab}
                                                </span>
                                                <span className={`text-[10px] px-2 py-0.5 rounded font-bold ${selectedLecture.mode === 'in-person' ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'}`}>
                                                    {selectedLecture.mode === 'in-person' ? labels.inPerson : labels.online}
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Time */}
                                    <div className="flex items-center gap-4 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl transition border border-transparent hover:border-gray-100 dark:hover:border-gray-700">
                                        <div className="p-3 bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400 rounded-full"><Clock size={20}/></div>
                                        <div>
                                            <p className="text-xs text-gray-500 font-bold mb-0.5">{labels.time}</p>
                                            <p className="font-bold text-gray-800 dark:text-white dir-ltr">{formatTimeRange(selectedLecture.start, selectedLecture.dur)}</p>
                                        </div>
                                    </div>

                                    {/* Location */}
                                    <div className="flex items-center gap-4 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl transition border border-transparent hover:border-gray-100 dark:hover:border-gray-700">
                                        <div className="p-3 bg-purple-50 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400 rounded-full"><MapPin size={20}/></div>
                                        <div>
                                            <p className="text-xs text-gray-500 font-bold mb-0.5">{labels.location}</p>
                                            <p className="font-bold text-gray-800 dark:text-white text-sm">{selectedLecture.bldg}</p>
                                            <p className="text-xs text-gray-500 mt-0.5 bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded w-fit">{labels.room}: {selectedLecture.room}</p>
                                        </div>
                                    </div>

                                    {/* Professor Info */}
                                    <div className="flex items-center gap-4 p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl transition border border-transparent hover:border-gray-100 dark:hover:border-gray-700">
                                        <div className="p-3 bg-teal-50 text-teal-600 dark:bg-teal-900/20 dark:text-teal-400 rounded-full"><User size={20}/></div>
                                        <div className="flex-1">
                                            <p className="text-xs text-gray-500 font-bold mb-0.5">{labels.prof}</p>
                                            <p className="font-bold text-gray-800 dark:text-white">{selectedLecture.prof}</p>
                                            <a href={`mailto:${selectedLecture.profEmail}`} className="text-xs text-primary mt-1.5 font-mono flex items-center gap-1 hover:underline w-fit px-2 py-1 rounded bg-primary/5">
                                                {selectedLecture.profEmail} <Send size={10} className="rotate-180"/>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="bg-white dark:bg-dark-card rounded-lg border border-gray-200 dark:border-gray-700 overflow-x-auto shadow-sm">
                        <table className="w-full min-w-[800px] text-center table-fixed border-collapse">
                            <thead className="bg-white dark:bg-dark-card text-gray-800 dark:text-white border-b border-gray-200 dark:border-gray-700">
                                <tr>
                                    <th className="py-4 w-28 border-l border-gray-200 dark:border-gray-700"></th> 
                                    {weekDays.map(day => (
                                        <th key={day} className="py-4 border-l border-gray-200 dark:border-gray-700 text-sm font-bold">{day}</th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                {timeSlots.map((slot) => (
                                    <tr key={slot.hour} className="h-24">
                                        <td className="p-2 bg-white dark:bg-dark-card text-gray-600 dark:text-gray-400 text-xs font-bold border-l border-gray-200 dark:border-gray-700 font-mono align-top pt-8">
                                            {slot.label}
                                        </td>
                                        {weekDays.map((day, dayIdx) => {
                                            const lecture = schedule[day]?.find(l => l.start === slot.hour);
                                            const isOccupied = schedule[day]?.some(l => slot.hour > l.start && slot.hour < l.start + l.dur);
                                            if (lecture) {
                                                return (
                                                    <td key={dayIdx} rowSpan={lecture.dur} className="p-1 relative align-top h-full border-l border-gray-100 dark:border-gray-700/50">
                                                        <button 
                                                            onClick={() => setSelectedLecture(lecture)}
                                                            className={`w-full h-full rounded-lg ${lecture.color} ${lecture.text} flex flex-col items-center justify-center text-center shadow-sm hover:opacity-90 transition-opacity p-2 relative group`}
                                                        >
                                                            <div className="absolute top-2 left-3 opacity-60"><AlertCircle size={16}/></div>
                                                            <div className="flex flex-col items-center justify-center h-full w-full gap-1">
                                                                <span className="font-bold text-base leading-tight">{lecture.name}</span>
                                                                {lecture.code && <span className="text-sm opacity-90 font-mono bg-black/10 px-1.5 rounded text-[10px]">{lecture.code}</span>}
                                                                <span className="text-[10px] font-bold opacity-80 mt-1 dir-ltr font-mono tracking-wide">
                                                                    {formatTimeRange(lecture.start, lecture.dur)}
                                                                </span>
                                                            </div>
                                                        </button>
                                                    </td>
                                                );
                                            }
                                            if (isOccupied) return null;
                                            return <td key={dayIdx} className="border-l border-gray-100 dark:border-gray-700/50"></td>
                                        })}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // 2. ÿßŸÑÿÆÿ∑ÿ© ÿßŸÑÿØÿ±ÿßÿ≥Ÿäÿ©
        const PlanPage = ({ onBack, t, lang }) => {
            const isAr = lang === 'ar';
            
            // Text Labels
            const labels = {
                total: isAr ? "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿßÿπÿßÿ™" : "Total Hours",
                hrs: isAr ? "ÿ≥" : "Hrs",
                courses: isAr ? "ŸÖŸÇÿ±ÿ±ÿßÿ™" : "Courses",
                level: isAr ? "ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ" : "Level",
                prereq: isAr ? "ŸÖÿ™ÿ∑ŸÑÿ®" : "Prereq",
                equiv: isAr ? "ŸÖÿπÿßÿØŸÑÿ©" : "Equiv"
            };

            const levels = [
                { 
                    id: 1, 
                    courses: [
                        { code: 'MATH101', name: isAr ? 'ÿ™ŸÅÿßÿ∂ŸÑ Ÿàÿ™ŸÉÿßŸÖŸÑ 1' : 'Calculus 1', status: 'eq', grade: labels.equiv, hours: 4 }, 
                        { code: 'ENG101', name: isAr ? 'ŸÑÿ∫ÿ© ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© 1' : 'English Language 1', status: 'eq', grade: labels.equiv, hours: 3 }, 
                        { code: 'ISL101', name: isAr ? 'ÿ´ŸÇÿßŸÅÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ© 1' : 'Islamic Culture 1', status: 'done', grade: 'ÿ£', hours: 2 }, 
                        { code: 'PHYS101', name: isAr ? 'ŸÅŸäÿ≤Ÿäÿßÿ° ÿπÿßŸÖÿ© 1' : 'General Physics 1', status: 'done', grade: 'ÿ®+', hours: 4 }, 
                        { code: 'CS100', name: isAr ? 'ŸÖŸáÿßÿ±ÿßÿ™ ÿ≠ÿßÿ≥ÿ®' : 'Computer Skills', status: 'done', grade: 'ÿ£+', hours: 2 }
                    ] 
                },
                { 
                    id: 2, 
                    courses: [
                        { code: 'CS101', name: isAr ? 'ŸÖŸÇÿØŸÖÿ© ŸÅŸä ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ©' : 'Intro to Programming', status: 'done', grade: 'ÿ®+', hours: 4, pre: 'CS100' }, 
                        { code: 'MATH102', name: isAr ? 'ÿ™ŸÅÿßÿ∂ŸÑ Ÿàÿ™ŸÉÿßŸÖŸÑ 2' : 'Calculus 2', status: 'done', grade: 'ÿ¨+', hours: 4, pre: 'MATH101' }, 
                        { code: 'PHYS102', name: isAr ? 'ŸÅŸäÿ≤Ÿäÿßÿ° ÿπÿßŸÖÿ© 2' : 'General Physics 2', status: 'done', grade: 'ÿ®', hours: 4, pre: 'PHYS101' }, 
                        { code: 'ENG102', name: isAr ? 'ŸÑÿ∫ÿ© ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© 2' : 'English Language 2', status: 'done', grade: 'ÿ®+', hours: 3, pre: 'ENG101' }, 
                        { code: 'ISL102', name: isAr ? 'ÿ´ŸÇÿßŸÅÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ© 2' : 'Islamic Culture 2', status: 'lock', grade: '', hours: 2, pre: 'ISL101' }
                    ] 
                },
                { 
                    id: 3, 
                    courses: [
                        { code: 'CS201', name: isAr ? 'ÿ®ÿ±ŸÖÿ¨ÿ© 1' : 'Programming 1', status: 'done', grade: 'ÿ£+', pre: 'CS101', hours: 4 }, 
                        { code: 'MATH201', name: isAr ? 'ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™ ŸÖÿ™ŸÇÿ∑ÿπÿ©' : 'Discrete Math', status: 'done', grade: 'ÿ®', pre: 'MATH102', hours: 3 }
                    ] 
                },
                { 
                    id: 4, 
                    courses: [
                        { code: 'CS204', name: isAr ? 'ÿ®ÿ±ŸÖÿ¨ÿ© 2' : 'Programming 2', status: 'now', grade: '---', pre: 'CS201', hours: 4 }, 
                        { code: 'CS205', name: isAr ? 'ŸÇŸàÿßÿπÿØ ÿ®ŸäÿßŸÜÿßÿ™' : 'Databases', status: 'now', grade: '---', pre: 'CS101', hours: 3 }
                    ] 
                }
            ];
            
            // Generate dummy future levels
            for(let i=5; i<=8; i++) { 
                levels.push({ 
                    id: i, 
                    courses: [
                        { code: `CS${i}01`, name: isAr ? `ŸÖŸÇÿ±ÿ± ÿ™ÿÆÿµÿµ ${i}` : `Major Elective ${i}`, status: 'lock', pre: `CS${i-1}01`, hours: 3 }, 
                        { code: `SE${i}02`, name: isAr ? `ŸÖÿ¥ÿ±Ÿàÿπ ${i}` : `Project ${i}`, status: 'lock', hours: 4 }
                    ] 
                }); 
            }

            const getCourseName = (code) => {
                for (const level of levels) { const found = level.courses.find(c => c.code === code); if (found) return found.name; }
                return code;
            };
            const totalPlanHours = levels.reduce((acc, lvl) => acc + lvl.courses.reduce((sum, c) => sum + c.hours, 0), 0);
            
            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.plan} onBack={onBack} lang={lang} extra={<div className="bg-primary/10 text-primary px-3 py-1 rounded-lg text-sm font-bold border border-primary/20">{labels.total}: {totalPlanHours}{labels.hrs}</div>} />
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {levels.map((lvl) => {
                            const isLevelCompleted = lvl.courses.every(c => c.status === 'done' || c.status === 'eq');
                            const levelHours = lvl.courses.reduce((sum, c) => sum + c.hours, 0);
                            return (
                                <div key={lvl.id} className={`rounded-xl border overflow-hidden shadow-sm transition-all ${isLevelCompleted ? 'border-green-300 dark:border-green-800' : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-card'}`}>
                                    <div className={`p-3 border-b flex justify-between items-center ${isLevelCompleted ? 'bg-green-600 text-white border-green-700' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-800 dark:text-white'}`}>
                                        <h3 className="font-bold text-sm flex items-center gap-2">
                                            {isLevelCompleted ? <CheckCircle2 size={16} className="text-white"/> : <span className="w-4 h-4 rounded-full border-2 border-current opacity-50"></span>}
                                            {labels.level} {lvl.id}
                                        </h3>
                                        <div className="flex gap-2 text-[10px]">
                                            <span className={`px-2 py-0.5 rounded ${isLevelCompleted ? 'bg-green-500 text-white' : 'bg-white dark:bg-dark-card border text-gray-500'}`}>{lvl.courses.length} {labels.courses}</span>
                                            <span className={`px-2 py-0.5 rounded ${isLevelCompleted ? 'bg-green-500 text-white' : 'bg-white dark:bg-dark-card border text-gray-500'}`}>{levelHours}{labels.hrs}</span>
                                        </div>
                                    </div>
                                    <div className={`divide-y ${isLevelCompleted ? 'divide-green-100 dark:divide-green-900/30 bg-green-50 dark:bg-green-900/10' : 'divide-gray-100 dark:divide-gray-700'}`}>
                                        {lvl.courses.map((course, i) => {
                                            const isDone = course.status === 'done' || course.status === 'eq';
                                            return (
                                                <div key={i} className={`p-3 transition relative group ${isDone ? 'bg-green-50/50 dark:bg-green-900/20' : 'bg-white dark:bg-dark-card'}`}>
                                                    <div className="flex justify-between items-start">
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-9 h-9 rounded-lg flex items-center justify-center text-xs font-bold shadow-sm ${course.status === 'eq' ? 'bg-blue-100 text-blue-700 border border-blue-200' : course.status === 'done' ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-gray-50 dark:bg-gray-700 text-gray-400 border border-gray-200 dark:border-gray-600'}`}>
                                                                {course.status === 'eq' ? 'EQ' : course.status === 'done' ? <Check size={16}/> : <Lock size={16}/>}
                                                            </div>
                                                            <div>
                                                                <div className={`font-bold text-sm ${isDone ? 'text-gray-800 dark:text-gray-200' : 'text-gray-600 dark:text-gray-400'}`}>{course.name}</div>
                                                                <div className="flex items-center gap-2 mt-0.5">
                                                                    <span className="text-[10px] text-gray-500 font-mono bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded">{course.code}</span>
                                                                    <span className="text-[10px] font-bold text-primary dark:text-teal-400">{course.hours} {labels.hrs}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className={`text-xs font-bold px-2 py-1 rounded ${isDone ? 'text-green-700 dark:text-green-400 bg-green-100 dark:bg-green-900/30' : 'text-gray-300'}`}>{course.grade || '--'}</div>
                                                    </div>
                                                    {course.pre && <div className="mt-2 mr-12 flex items-center gap-1.5 text-[10px] text-orange-700 bg-orange-50 w-full md:w-fit px-2 py-1 rounded border border-orange-100 dark:bg-orange-900/20 dark:border-orange-800 dark:text-orange-300"><Link size={12} className="opacity-70" /><span className="opacity-70">{labels.prereq}:</span><span className="font-bold">{getCourseName(course.pre)}</span></div>}
                                                </div>
                                            )
                                        })}
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                </div>
            );
        };

        // 3. ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
        const ResultsPage = ({ onBack, t, lang, onOpenNotifications }) => {
            const isAr = lang === 'ar';
            
            // Labels
            const labels = {
                gpa: isAr ? 'ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä (GPA)' : 'Cumulative GPA',
                rating: isAr ? 'ÿ¨ŸäÿØ ÿ¨ÿØÿßŸã' : 'Very Good',
                trend: isAr ? 'ÿ£ŸÇŸÑ ÿ®ŸÄ 0.45' : 'Lower by 0.45',
                chartTitle: isAr ? 'ÿ™ÿ∑Ÿàÿ± ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä' : 'GPA Trend',
                detailsTitle: isAr ? 'ÿ™ŸÅÿßÿµŸäŸÑ ÿØÿ±ÿ¨ÿßÿ™ ÿßŸÑŸÅÿµŸÑ ÿßŸÑÿ≠ÿßŸÑŸä' : 'Current Semester Grades Details',
                assessment: isAr ? 'ÿßŸÑÿ™ŸÇŸäŸäŸÖ' : 'Assessment',
                yourGrade: isAr ? 'ÿØÿ±ÿ¨ÿßÿ™ŸÉ' : 'Your Score',
                classAvg: isAr ? 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ¥ÿπÿ®ÿ©' : 'Class Avg',
                totalScore: isAr ? 'ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÜŸáÿßÿ¶Ÿä' : 'Total Score',
                semPrefix: isAr ? 'ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ' : 'Level',
                current: isAr ? 'ÿßŸÑÿ≠ÿßŸÑŸä' : 'Current',
                tooltipAvg: isAr ? 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ¥ÿπÿ®ÿ©:' : 'Class Avg:',
                pendingGrade: isAr ? 'ÿ∫Ÿäÿ± ŸÖÿ±ÿµŸàÿØ' : 'Not Recorded'
            };

            const gpaTrend = [ 
                { sem: `${labels.semPrefix} 1`, gpa: 3.50 }, 
                { sem: `${labels.semPrefix} 2`, gpa: 3.65 }, 
                { sem: `${labels.semPrefix} 3`, gpa: 3.40 }, 
                { sem: `${labels.semPrefix} 4`, gpa: 3.80 }, 
                { sem: labels.current, gpa: 3.35 } 
            ];

            const componentLabels = {
                lab: isAr ? 'ÿßŸÑÿπŸÖŸÑŸä' : 'Lab',
                mid: isAr ? 'ÿßŸÑŸÜÿµŸÅŸä' : 'Midterm',
                cw: isAr ? 'ÿ£ÿπŸÖÿßŸÑ ÿ≥ŸÜÿ©' : 'Coursework',
                final: isAr ? 'ÿßŸÑŸÜŸáÿßÿ¶Ÿä' : 'Final'
            };

            const detailedResults = [
                { 
                    code: 'SE301', 
                    name: isAr ? 'ŸáŸÜÿØÿ≥ÿ© ÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™' : 'Software Engineering', 
                    total: 95, 
                    grade: 'ÿ£+', 
                    components: [
                        { label: componentLabels.lab, max: 20, student: 19, avg: 16 }, 
                        { label: componentLabels.mid, max: 20, student: 18, avg: 14 }, 
                        { label: componentLabels.cw, max: 20, student: 20, avg: 18 }, 
                        { label: componentLabels.final, max: 40, student: 38, avg: 32 }
                    ] 
                },
                { 
                    code: 'CS305', 
                    name: isAr ? 'ŸÜÿ∏ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ' : 'Operating Systems', 
                    total: 0, 
                    grade: 'NR', // Updated to match the alert
                    isPending: true,
                    components: [
                        { label: componentLabels.lab, max: 20, student: 15, avg: 17 }, 
                        { label: componentLabels.mid, max: 20, student: 14, avg: 15 }, 
                        { label: componentLabels.cw, max: 20, student: 18, avg: 18 }, 
                        { label: componentLabels.final, max: 40, student: 0, avg: 28 }
                    ] 
                },
                { 
                    code: 'MATH201', 
                    name: isAr ? 'ÿ•ÿ≠ÿµÿßÿ° ŸáŸÜÿØÿ≥Ÿä' : 'Engineering Statistics', 
                    total: 88, 
                    grade: 'ÿ®+', 
                    components: [
                        { label: componentLabels.lab, max: 25, student: 23, avg: 20 }, 
                        { label: componentLabels.mid, max: 25, student: 20, avg: 18 }, 
                        { label: componentLabels.final, max: 50, student: 45, avg: 35 }
                    ] 
                },
                { 
                    code: 'PHYS101', 
                    name: isAr ? 'ŸÅŸäÿ≤Ÿäÿßÿ° ÿπÿßŸÖÿ©' : 'General Physics', 
                    total: 55, 
                    grade: isAr ? 'ŸáŸÄ (ÿ±ÿßÿ≥ÿ®)' : 'F (Fail)', 
                    components: [
                        { label: componentLabels.lab, max: 25, student: 10, avg: 18 }, 
                        { label: componentLabels.mid, max: 25, student: 12, avg: 16 }, 
                        { label: componentLabels.final, max: 50, student: 33, avg: 30 }
                    ] 
                }
            ];

            const getScoreColor = (score, max) => { const pct = (score / max) * 100; if (pct >= 90) return 'bg-emerald-600 text-emerald-100'; if (pct >= 80) return 'bg-lime-400 text-lime-900'; if (pct >= 60) return 'bg-yellow-400 text-yellow-900'; return 'bg-red-500 text-white'; };
            const getScoreColorText = (score, max) => { const pct = (score / max) * 100; if (pct >= 90) return 'text-emerald-700'; if (pct >= 80) return 'text-lime-600'; if (pct >= 60) return 'text-yellow-600'; return 'text-red-600'; };
            const chartMax = 4.0;
            const chartPoints = gpaTrend.map((item, index) => { const x = 10 + (index / (gpaTrend.length - 1)) * 80; const y = 60 - ((item.gpa / chartMax) * 50); return { x, y, ...item }; });
            const pathData = "M" + chartPoints.map(p => `${p.x},${p.y}`).join(" L");

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage 
                        title={t.results} 
                        onBack={onBack} 
                        lang={lang} 
                        extra={
                            <div className="flex gap-2">
                                <NotificationBell onClick={onOpenNotifications} />
                                <button className="text-primary hover:bg-primary/10 p-2 rounded-lg transition"><Download size={20}/></button>
                            </div>
                        } 
                    />
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="bg-gradient-to-br from-primary to-teal-800 p-6 rounded-2xl text-white shadow-lg relative overflow-hidden flex flex-col justify-center">
                            <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -translate-y-10 translate-x-10"></div>
                            <div className="text-sm opacity-80 mb-2 font-medium">{labels.gpa}</div>
                            <div className="flex items-end gap-3"><span className="text-6xl font-bold tracking-tight">3.35</span><span className="text-xl opacity-70 mb-2">/ 4.00</span></div>
                            <div className="mt-4 flex gap-2"><div className="text-xs bg-lime-400 text-lime-900 inline-flex items-center gap-1 px-3 py-1 rounded-full font-bold shadow-sm"><Award size={12}/> {labels.rating}</div><div className="text-xs bg-red-600 text-white inline-flex items-center gap-1 px-3 py-1 rounded-full font-bold shadow-sm border border-red-500"><TrendingUp size={12} className="rotate-180"/> {labels.trend}</div></div>
                        </div>
                        <div className="lg:col-span-2 bg-white dark:bg-dark-card p-6 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm flex flex-col">
                            <h3 className="text-sm font-bold text-gray-700 dark:text-gray-300 mb-6 flex items-center gap-2"><TrendingUp size={16} className="text-primary"/> {labels.chartTitle}</h3>
                            <div className="flex-1 w-full relative px-4 pb-2"><svg viewBox="0 0 100 80" className="w-full h-full overflow-visible" preserveAspectRatio="none"><line x1="0" y1="22.5" x2="100" y2="22.5" stroke="#e5e7eb" strokeWidth="0.5" strokeDasharray="2" /><line x1="0" y1="35" x2="100" y2="35" stroke="#e5e7eb" strokeWidth="0.5" strokeDasharray="2" /><line x1="0" y1="47.5" x2="100" y2="47.5" stroke="#e5e7eb" strokeWidth="0.5" strokeDasharray="2" /><path d={pathData} fill="none" stroke="#006771" strokeWidth="1.5" strokeLinecap="round" vectorEffect="non-scaling-stroke" /><defs><linearGradient id="gradientArea" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stopColor="#006771" stopOpacity="0.2"/><stop offset="100%" stopColor="#006771" stopOpacity="0"/></linearGradient></defs><path d={`${pathData} L${chartPoints[chartPoints.length-1].x},80 L${chartPoints[0].x},80 Z`} fill="url(#gradientArea)" stroke="none" opacity="0.5" />{chartPoints.map((p, i) => (<g key={i}><circle cx={p.x} cy={p.y} r="1.5" fill="#fff" stroke="#006771" strokeWidth="0.5" className="hover:r-2 transition-all cursor-pointer"/><text x={p.x} y={p.y - 4} textAnchor="middle" fontSize="3" fill="#006771" fontWeight="bold">{p.gpa}</text><text x={p.x} y="72" textAnchor="middle" fontSize="3" fill="#6b7280" className="font-bold">{p.sem}</text></g>))}</svg></div>
                        </div>
                    </div>
                    <div className="space-y-4">
                        <h3 className={`font-bold text-gray-800 dark:text-white text-lg ${isAr ? 'border-r-4 pr-3' : 'border-l-4 pl-3'} border-primary`}>{labels.detailsTitle}</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {detailedResults.map((course, idx) => (
                                <div key={idx} className={`bg-white dark:bg-dark-card rounded-xl border shadow-sm overflow-hidden flex flex-col ${course.isPending ? 'border-amber-300 dark:border-amber-700' : (course.total < 60 ? 'border-red-200 dark:border-red-900/50' : 'border-gray-200 dark:border-gray-700')}`}>
                                    <div className={`p-4 border-b flex justify-between items-start ${course.isPending ? 'bg-amber-50 dark:bg-amber-900/20 border-amber-100' : (course.total < 60 ? 'bg-red-50 dark:bg-red-900/10 border-red-100' : 'bg-gray-50/50 dark:bg-gray-800/50 border-gray-100 dark:border-gray-700')}`}>
                                        <div>
                                            <h4 className="font-bold text-gray-800 dark:text-white text-sm">{course.name}</h4>
                                            <span className="text-[10px] font-mono text-gray-500 bg-white dark:bg-gray-700 border px-1.5 py-0.5 rounded mt-1 inline-block">{course.code}</span>
                                        </div>
                                        <div className="text-center">
                                            {course.isPending ? (
                                                <div className="text-amber-600 dark:text-amber-400 font-bold text-xs bg-white/50 px-2 py-1 rounded border border-amber-200">{labels.pendingGrade}</div>
                                            ) : (
                                                <>
                                                    <div className={`text-xl font-bold ${getScoreColorText(course.total, 100)}`}>{course.total}</div>
                                                    <div className={`text-[10px] font-bold px-2 py-0.5 rounded whitespace-nowrap ${getScoreColor(course.total, 100)}`}>{course.grade}</div>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                    <div className="p-4 space-y-4 flex-1">
                                        <div className="flex justify-between items-center text-[10px] text-gray-400 mb-2"><span>{labels.assessment}</span><div className="flex gap-3"><span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-primary"></div> {labels.yourGrade}</span><span className="flex items-center gap-1"><div className="w-0.5 h-3 bg-gray-400"></div> {labels.classAvg}</span></div></div>
                                        {course.components.map((comp, cIdx) => (
                                            <div key={cIdx} className="group">
                                                <div className="flex justify-between items-end mb-1"><span className="text-xs font-bold text-gray-600 dark:text-gray-400">{comp.label}</span><div className="flex items-end gap-1"><span className={`text-sm font-bold font-mono ${course.isPending && comp.label === componentLabels.final ? 'text-gray-400' : getScoreColorText(comp.student, comp.max)}`}>{course.isPending && comp.label === componentLabels.final ? '--' : comp.student}</span><span className="text-[10px] text-gray-400">/ {comp.max}</span></div></div>
                                                <div className="relative h-2.5 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-visible"><div className={`absolute top-0 ${isAr ? 'right-0' : 'left-0'} h-full rounded-full ${getScoreColor(comp.student, comp.max).split(' ')[0]}`} style={{ width: `${(comp.student / comp.max) * 100}%`, opacity: course.isPending && comp.label === componentLabels.final ? 0.3 : 1 }}></div><div className={`absolute top-[-2px] bottom-[-2px] w-0.5 bg-gray-800 dark:bg-white z-10 shadow-[0_0_2px_rgba(0,0,0,0.5)]`} style={{ [isAr ? 'right' : 'left']: `${(comp.avg / comp.max) * 100}%` }} title={`${labels.tooltipAvg} ${comp.avg}`}></div></div><div className={`text-[9px] text-gray-400 mt-0.5 dir-ltr font-mono ${isAr ? 'text-left' : 'text-right'}`}>Avg: {comp.avg}</div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className={`p-3 border-t flex justify-between items-center ${course.total < 60 ? 'bg-red-50 dark:bg-red-900/10 border-red-100' : 'bg-gray-50 dark:bg-gray-800/50 border-gray-100 dark:border-gray-700'}`}><span className="text-xs font-bold text-gray-500">{labels.totalScore}</span><span className="text-sm font-bold font-mono text-gray-800 dark:text-white">{course.isPending ? '--' : course.total} / 100</span></div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // 4. ÿ¨ÿØŸàŸÑ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™
        const ExamsPage = ({ onBack, lang }) => {
            const isAr = lang === 'ar';
            const [selectedExam, setSelectedExam] = useState(null);
            
            // Labels & Text
            const t = {
                title: isAr ? "ÿ¨ÿØŸàŸÑ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©" : "Final Exams Schedule",
                print: isAr ? "ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©" : "Print Card",
                nextExamLabel: isAr ? "ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÇÿßÿØŸÖ" : "Next Exam",
                days: isAr ? "ÿ£ŸäÿßŸÖ" : "Days",
                hours: isAr ? "ÿ≥ÿßÿπÿ©" : "Hours",
                minutes: isAr ? "ÿØŸÇŸäŸÇÿ©" : "Minutes",
                may: isAr ? "ŸÖÿßŸäŸà" : "May",
                seat: isAr ? "ÿ±ŸÇŸÖ ÿßŸÑŸÖŸÇÿπÿØ" : "Seat Number",
                hall: isAr ? "ÿßŸÑŸÇÿßÿπÿ©" : "Hall",
                dateTime: isAr ? "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑŸàŸÇÿ™" : "Date & Time",
                location: isAr ? "ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸä" : "Location Details",
                instructions: isAr ? "ÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸáÿßŸÖÿ©" : "Important Instructions",
                close: isAr ? "ÿ•ÿ∫ŸÑÿßŸÇ" : "Close"
            };

            const exams = [
                { 
                    id: 1, 
                    name: isAr ? 'ÿ£ŸÖŸÜ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™' : 'Information Security', 
                    code: 'CS320', 
                    date: '2024-05-15', 
                    time: '09:00 - 11:00', 
                    location: isAr ? 'ŸÖÿ®ŸÜŸâ ŸÇÿßÿπÿ© ÿßŸÑŸÖŸÑŸÉ ÿ≥ÿπŸàÿØ' : 'King Saud Hall Bldg', 
                    room: isAr ? 'ŸÇÿßÿπÿ© ÿ£' : 'Hall A', 
                    seat: '45', 
                    status: 'upcoming', 
                    instructions: isAr 
                        ? ['ÿ•ÿ≠ÿ∂ÿßÿ± ÿßŸÑŸáŸàŸäÿ© ÿßŸÑÿ¨ÿßŸÖÿπŸäÿ©', 'ŸÖŸÖŸÜŸàÿπ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ¢ŸÑÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿ©', 'ÿßŸÑÿ≠ÿ∂Ÿàÿ± ŸÇÿ®ŸÑ ÿßŸÑŸÖŸàÿπÿØ ÿ®ŸÄ 15 ÿØŸÇŸäŸÇÿ©']
                        : ['Bring University ID', 'Calculators not allowed', 'Arrive 15 mins early']
                },
                { 
                    id: 2, 
                    name: isAr ? 'ÿ•ÿ≠ÿµÿßÿ° ŸáŸÜÿØÿ≥Ÿä' : 'Engineering Statistics', 
                    code: 'MATH201', 
                    date: '2024-05-18', 
                    time: '08:00 - 10:00', 
                    location: isAr ? 'ŸÉŸÑŸäÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ®' : 'College of Computer Science', 
                    room: '101', 
                    seat: '12', 
                    status: 'upcoming', 
                    instructions: isAr 
                        ? ['ÿ•ÿ≠ÿ∂ÿßÿ± ÿßŸÑÿ¢ŸÑÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿ© (ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ®ÿ±ŸÖÿ¨ÿ©)', 'ŸÇŸÑŸÖ ÿ±ÿµÿßÿµ HB2']
                        : ['Bring non-programmable calculator', 'HB2 Pencil required']
                },
                { 
                    id: 3, 
                    name: isAr ? 'ÿ´ŸÇÿßŸÅÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ© 3' : 'Islamic Culture 3', 
                    code: 'ISL103', 
                    date: '2024-05-22', 
                    time: '13:00 - 14:00', 
                    location: isAr ? 'ŸÖÿ®ŸÜŸâ ÿßŸÑŸÅÿµŸàŸÑ ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ©' : 'Common Classrooms Bldg', 
                    room: '205', 
                    seat: '88', 
                    status: 'upcoming', 
                    instructions: isAr 
                        ? ['ÿßÿÆÿ™ÿ®ÿßÿ± ŸÖŸàÿ∂ŸàÿπŸä (ÿ™ÿ∏ŸÑŸäŸÑ)', 'ÿ•ÿ≠ÿ∂ÿßÿ± ÿßŸÑŸáŸàŸäÿ©']
                        : ['Objective Test (OMR)', 'Bring ID']
                },
                { 
                    id: 4, 
                    name: isAr ? 'ŸÖÿ¥ÿ±Ÿàÿπ ÿ™ÿÆÿ±ÿ¨ 1' : 'Graduation Project 1', 
                    code: 'GP401', 
                    date: '2024-05-25', 
                    time: '10:00 - 12:00', 
                    location: isAr ? 'ŸÖÿ®ŸÜŸâ ÿßŸÑÿ≠ÿßÿ≥ÿ®' : 'Computer Building', 
                    room: isAr ? 'ÿßŸÑŸÖÿπŸÖŸÑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä' : 'Main Lab', 
                    seat: '-', 
                    status: 'upcoming', 
                    instructions: isAr 
                        ? ['ÿ™ÿ≥ŸÑŸäŸÖ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ŸÖÿ∑ÿ®Ÿàÿπ', 'ÿπÿ±ÿ∂ ÿ™ŸÇÿØŸäŸÖŸä 10 ÿØŸÇÿßÿ¶ŸÇ']
                        : ['Submit printed report', '10 min presentation']
                }
            ];
            const nextExam = exams[0];
            const daysLeft = 5;

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} extra={<button className="text-primary bg-primary/10 px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-primary/20 transition"><Printer size={18}/> {t.print}</button>} />
                    <div className="bg-gradient-to-r from-primary to-teal-800 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                        <div className="relative z-10 flex flex-col md:flex-row justify-between items-center gap-6">
                            <div className="text-center md:text-right">
                                <div className="inline-block px-3 py-1 bg-white/20 rounded-full text-xs font-bold mb-2 backdrop-blur-sm border border-white/10">{t.nextExamLabel}</div>
                                <h2 className="text-3xl font-bold mb-1">{nextExam.name}</h2>
                                <p className="text-teal-100 text-sm flex items-center justify-center md:justify-start gap-2 opacity-90"><Clock size={16}/> {nextExam.date} ‚Ä¢ {nextExam.time}</p>
                            </div>
                            <div className="flex gap-4 items-center bg-white/10 p-4 rounded-2xl border border-white/10 backdrop-blur-md">
                                <div className="text-center"><span className="block text-2xl font-bold font-mono">{daysLeft}</span><span className="text-[10px] text-teal-200">{t.days}</span></div><div className="w-px h-8 bg-white/20"></div>
                                <div className="text-center"><span className="block text-2xl font-bold font-mono">14</span><span className="text-[10px] text-teal-200">{t.hours}</span></div><div className="w-px h-8 bg-white/20"></div>
                                <div className="text-center"><span className="block text-2xl font-bold font-mono">30</span><span className="text-[10px] text-teal-200">{t.minutes}</span></div>
                            </div>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {exams.map((exam) => (
                            <button key={exam.id} onClick={() => setSelectedExam(exam)} className={`group relative bg-white dark:bg-dark-card border border-gray-200 dark:border-gray-700 rounded-2xl p-5 hover:border-primary dark:hover:border-primary hover:shadow-lg transition-all ${isAr ? 'text-right' : 'text-left'} flex items-stretch overflow-hidden`}>
                                <div className={`absolute top-0 ${isAr ? 'right-0' : 'left-0'} w-1.5 h-full bg-gray-200 group-hover:bg-primary transition-colors`}></div>
                                <div className={`flex flex-col items-center justify-center ${isAr ? 'pl-4 border-l' : 'pr-4 border-r'} border-gray-100 dark:border-gray-700 min-w-[80px]`}><span className="text-3xl font-bold text-gray-800 dark:text-white font-mono">{exam.date.split('-')[2]}</span><span className="text-xs font-bold text-gray-500 uppercase">{t.may}</span></div>
                                <div className={`flex-1 ${isAr ? 'pr-4' : 'pl-4'} py-1`}><div className="flex justify-between items-start mb-2"><div><h3 className="font-bold text-lg text-gray-800 dark:text-white group-hover:text-primary transition-colors">{exam.name}</h3><span className="text-xs font-mono text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded">{exam.code}</span></div><div className="bg-gray-50 dark:bg-gray-800 p-2 rounded-lg text-gray-400 group-hover:text-primary transition-colors"><ArrowRight size={20} className={`transform ${isAr ? 'rotate-180' : ''}`} /></div></div><div className="flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400 mt-3"><span className="flex items-center gap-1.5"><Clock size={14}/> {exam.time}</span><span className="flex items-center gap-1.5"><MapPin size={14}/> {exam.room}</span></div></div>
                            </button>
                        ))}
                    </div>
                    {selectedExam && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onClick={() => setSelectedExam(null)}>
                            <div className="bg-white dark:bg-dark-card w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 transform transition-all scale-100 flex flex-col" onClick={e => e.stopPropagation()}>
                                <div className="relative h-32 bg-primary flex items-center justify-center overflow-hidden">
                                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                                    <div className="absolute -bottom-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
                                    <button onClick={() => setSelectedExam(null)} className={`absolute top-4 ${isAr ? 'right-4' : 'left-4'} bg-black/20 text-white p-2 rounded-full hover:bg-black/40 transition z-10`}><X size={20}/></button>
                                    <div className="text-center relative z-10"><h3 className="text-2xl font-bold text-white mb-1">{selectedExam.name}</h3><span className="inline-block bg-white/20 text-white text-xs px-3 py-1 rounded-full font-mono backdrop-blur-sm">{selectedExam.code}</span></div>
                                </div>
                                <div className="p-6 space-y-6">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-2xl text-center border border-gray-100 dark:border-gray-700"><span className="block text-xs text-gray-500 mb-1">{t.seat}</span><span className="block text-2xl font-bold text-primary font-mono">{selectedExam.seat}</span></div>
                                        <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-2xl text-center border border-gray-100 dark:border-gray-700"><span className="block text-xs text-gray-500 mb-1">{t.hall}</span><span className="block text-lg font-bold text-gray-800 dark:text-white">{selectedExam.room}</span></div>
                                    </div>
                                    <div className="space-y-4">
                                        <div className="flex items-start gap-4"><div className="p-2.5 bg-blue-50 text-blue-600 rounded-xl mt-1"><Calendar size={20}/></div><div><h4 className="font-bold text-gray-800 dark:text-white text-sm">{t.dateTime}</h4><p className="text-sm text-gray-500 dark:text-gray-400 mt-0.5">{selectedExam.date}</p><p className={`text-sm text-gray-800 dark:text-gray-200 font-bold font-mono dir-ltr ${isAr ? 'text-right' : 'text-left'}`}>{selectedExam.time}</p></div></div>
                                        <div className="flex items-start gap-4"><div className="p-2.5 bg-purple-50 text-purple-600 rounded-xl mt-1"><MapPin size={20}/></div><div><h4 className="font-bold text-gray-800 dark:text-white text-sm">{t.location}</h4><p className="text-sm text-gray-500 dark:text-gray-400 mt-0.5">{selectedExam.location}</p></div></div>
                                        <div className="flex items-start gap-4"><div className="p-2.5 bg-orange-50 text-orange-600 rounded-xl mt-1"><AlertCircle size={20}/></div><div><h4 className="font-bold text-gray-800 dark:text-white text-sm">{t.instructions}</h4><ul className="text-sm text-gray-500 dark:text-gray-400 mt-1 list-disc list-inside space-y-1">{selectedExam.instructions.map((inst, i) => (<li key={i}>{inst}</li>))}</ul></div></div>
                                    </div>
                                </div>
                                <div className="p-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50"><button onClick={() => setSelectedExam(null)} className="w-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white font-bold py-3 rounded-xl hover:bg-gray-300 dark:hover:bg-gray-600 transition">{t.close}</button></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 5. ÿ≥ÿ¨ŸÑ ÿßŸÑÿ∫Ÿäÿßÿ®
        const AbsencesPage = ({ onBack, lang }) => {
            const isAr = lang === 'ar';
            const t = translations[lang];

            const labels = {
                title: isAr ? "ÿ≥ÿ¨ŸÑ ÿßŸÑÿ∫Ÿäÿßÿ® ŸàÿßŸÑÿ≠ÿ∂Ÿàÿ±" : "Attendance & Absence Record",
                regulations: isAr ? "ŸÑÿßÿ¶ÿ≠ÿ© ÿßŸÑÿ∫Ÿäÿßÿ®" : "Attendance Policy",
                totalHours: isAr ? "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿßÿπÿßÿ™" : "Total Hours",
                absentHours: isAr ? "ÿ≥ÿßÿπÿßÿ™ ÿßŸÑÿ∫Ÿäÿßÿ®" : "Absent Hours",
                daysRecord: isAr ? "ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ŸäÿßŸÖ" : "Absence History",
                hrs: isAr ? "ÿ≥ÿßÿπÿßÿ™" : "hrs",
                noAbsences: isAr ? "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∫Ÿäÿßÿ®ÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ© ŸÑŸáÿ∞Ÿá ÿßŸÑŸÖÿßÿØÿ©" : "No absences recorded for this course",
                excused: isAr ? "ÿ®ÿπÿ∞ÿ±" : "Excused",
                unexcused: isAr ? "ÿ®ÿØŸàŸÜ ÿπÿ∞ÿ±" : "Unexcused"
            };

            const courses = [
                { 
                    name: isAr ? 'ÿ®ÿ±ŸÖÿ¨ÿ© ŸÖÿ™ŸÇÿØŸÖÿ©' : 'Advanced Programming', 
                    code: 'CS204', 
                    absencePct: 0, 
                    excused: false, 
                    totalHours: 48, 
                    absentHours: 0, 
                    records: [] 
                },
                { 
                    name: isAr ? 'ÿ™ÿ≠ŸÑŸäŸÑ ŸÉŸäŸÖŸäÿßÿ¶Ÿä' : 'Chemical Analysis', 
                    code: 'CH202', 
                    absencePct: 12, 
                    excused: false, 
                    totalHours: 32, 
                    absentHours: 4, 
                    records: [
                        { date: '2024-02-12', day: isAr ? 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ' : 'Monday', hours: 2, status: 'unexcused', note: isAr ? 'ÿ∫ÿßÿ¶ÿ®' : 'Absent' }, 
                        { date: '2024-03-04', day: isAr ? 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ' : 'Monday', hours: 2, status: 'unexcused', note: isAr ? 'ÿ∫ÿßÿ¶ÿ®' : 'Absent' }
                    ] 
                },
                { 
                    name: isAr ? 'ÿ•ÿ≠ÿµÿßÿ° ŸáŸÜÿØÿ≥Ÿä' : 'Engineering Statistics', 
                    code: 'MATH201', 
                    absencePct: 20, 
                    excused: true, 
                    totalHours: 40, 
                    absentHours: 8, 
                    records: [
                        { date: '2024-01-28', day: isAr ? 'ÿßŸÑÿ£ÿ≠ÿØ' : 'Sunday', hours: 2, status: 'excused', note: isAr ? 'ÿ™ŸÇÿ±Ÿäÿ± ÿ∑ÿ®Ÿä #442' : 'Medical Report #442' }, 
                        { date: '2024-02-11', day: isAr ? 'ÿßŸÑÿ£ÿ≠ÿØ' : 'Sunday', hours: 2, status: 'excused', note: isAr ? 'ÿπÿ∞ÿ± ŸÖŸÇÿ®ŸàŸÑ' : 'Accepted Excuse' }, 
                        { date: '2024-03-10', day: isAr ? 'ÿßŸÑÿ£ÿ≠ÿØ' : 'Sunday', hours: 2, status: 'unexcused', note: isAr ? 'ÿ∫ÿßÿ¶ÿ®' : 'Absent' }, 
                        { date: '2024-03-24', day: isAr ? 'ÿßŸÑÿ£ÿ≠ÿØ' : 'Sunday', hours: 2, status: 'excused', note: isAr ? 'ÿ∏ÿ±ŸÅ ÿπÿßÿ¶ŸÑŸä' : 'Family Emergency' }
                    ] 
                },
                { 
                    name: isAr ? 'ŸÅŸäÿ≤Ÿäÿßÿ° ÿπÿßŸÖÿ©' : 'General Physics', 
                    code: 'PHYS101', 
                    absencePct: 25, 
                    excused: true, 
                    totalHours: 60, 
                    absentHours: 15, 
                    records: [
                        { date: '2024-02-05', day: isAr ? 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ' : 'Monday', hours: 4, status: 'unexcused', note: isAr ? 'ÿ∫ÿßÿ¶ÿ®' : 'Absent' }, 
                        { date: '2024-03-11', day: isAr ? 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ' : 'Monday', hours: 2, status: 'unexcused', note: isAr ? 'ÿ∫ÿßÿ¶ÿ®' : 'Absent' }, 
                        { date: '2024-04-01', day: isAr ? 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ' : 'Monday', hours: 4, status: 'excused', note: isAr ? 'ŸÖÿ±ÿßÿ¨ÿπÿ© ŸÖÿ≥ÿ™ÿ¥ŸÅŸâ' : 'Hospital Appointment' }
                    ] 
                },
            ];

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={labels.title} onBack={onBack} lang={lang} extra={<div className="bg-primary/10 text-primary px-3 py-1 rounded-lg text-sm font-bold border border-primary/20 flex items-center gap-2"><FileText size={16}/> {labels.regulations}</div>} />
                    <div className="grid grid-cols-1 gap-6">
                        {courses.map((course, idx) => {
                            const progressPercent = Math.min((course.absencePct / 25) * 100, 100);
                            let statusColor = "bg-green-500";
                            let statusText = ""; 
                            
                            // Logic for Horman (Denial) & Warnings
                            if (course.absencePct === 0) { 
                                statusColor = "bg-emerald-500"; 
                                statusText = t['status-perfect']; 
                            } 
                            else if (course.absencePct < 10) { 
                                statusColor = "bg-green-500"; 
                                statusText = t['status-safe']; 
                            } 
                            else if (course.absencePct >= 10 && course.absencePct < 15) { 
                                statusColor = "bg-yellow-500"; 
                                statusText = t['status-warning']; 
                            } 
                            else if (course.absencePct >= 25) {
                                // Horman (Denial) regardless of excuse if >= 25%
                                statusColor = "bg-red-600";
                                statusText = t['status-denial-limit'];
                            }
                            else if (course.absencePct >= 15) { 
                                if (course.excused) { 
                                    // High but excused (below 25%)
                                    statusColor = "bg-orange-400"; 
                                    statusText = t['status-high-excused']; 
                                } else { 
                                    // Unexcused >= 15% -> Denial
                                    statusColor = "bg-red-600"; 
                                    statusText = t['status-denial']; 
                                } 
                            }

                            return (
                                <div key={idx} className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden">
                                    <div className="p-6 border-b border-gray-100 dark:border-gray-700">
                                        <div className="flex justify-between items-center mb-4">
                                            <div><h3 className="font-bold text-lg text-gray-800 dark:text-white flex items-center gap-2">{course.name}<span className="text-xs font-normal text-gray-500 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full font-mono">{course.code}</span></h3><div className="text-xs text-gray-500 mt-1 flex gap-3"><span>{labels.totalHours}: {course.totalHours}</span><span className="text-red-500">{labels.absentHours}: {course.absentHours}</span></div></div>
                                            <div className="text-left">{statusText && (<span className={`block text-xs px-2 py-1 rounded font-bold text-white shadow-sm mb-1 text-center ${statusColor}`}>{statusText}</span>)}<span className={`text-xl font-bold font-mono ${course.absencePct >= 15 && !course.excused ? 'text-red-500' : 'text-gray-700 dark:text-gray-300'}`}>{course.absencePct}%</span></div>
                                        </div>
                                        {/* Adjusted Progress Bar Logic for RTL/LTR */}
                                        <div className="relative w-full h-10">
                                            <div className="absolute top-3 w-full h-3 bg-gray-100 dark:bg-gray-700 rounded-full overflow-visible">
                                                <div className="absolute inset-0 rounded-full overflow-hidden">
                                                    <div className={`h-full transition-all duration-1000 ${statusColor}`} style={{ width: `${progressPercent}%` }}></div>
                                                </div>
                                                <div className="absolute -top-1 bottom-0 w-0.5 bg-gray-300 dark:bg-gray-600 z-10" style={{ [isAr ? 'right' : 'left']: '60%' }}></div>
                                                <div className={`absolute top-4 text-[9px] font-bold text-gray-400 ${isAr ? 'translate-x-1/2' : '-translate-x-1/2'}`} style={{ [isAr ? 'right' : 'left']: '60%' }}>15%</div>
                                                <div className="absolute -top-1 bottom-0 w-0.5 bg-red-300 dark:bg-red-800 z-10" style={{ [isAr ? 'right' : 'left']: '99%' }}></div>
                                                <div className={`absolute top-4 text-[9px] font-bold text-red-400 ${isAr ? 'translate-x-full' : '-translate-x-full'}`} style={{ [isAr ? 'right' : 'left']: '99%' }}>25%</div>
                                                <div className="absolute top-4 text-[9px] text-gray-400" style={{ [isAr ? 'right' : 'left']: '0%' }}>0%</div>
                                            </div>
                                        </div>
                                    </div>
                                    {course.records.length > 0 ? (
                                        <div className="bg-gray-50 dark:bg-gray-800/30">
                                            <div className="px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-100 dark:border-gray-700">{labels.daysRecord}</div>
                                            <div className="divide-y divide-gray-100 dark:divide-gray-700">
                                                {course.records.map((rec, rIdx) => {
                                                    const percentage = ((rec.hours / course.totalHours) * 100).toFixed(1);
                                                    return (
                                                        <div key={rIdx} className="px-6 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800 transition">
                                                            <div className="flex items-center gap-4"><div className={`p-2 rounded-lg ${rec.status === 'excused' ? 'bg-orange-100 text-orange-600' : 'bg-red-100 text-red-600'}`}><Calendar size={16}/></div><div><p className="text-sm font-bold text-gray-800 dark:text-gray-200">{rec.day} <span className="font-mono font-normal text-gray-500 text-xs dir-ltr">{rec.date}</span></p><div className="text-xs text-gray-500 flex items-center gap-1 mt-1"><span className="font-bold">{rec.hours} {labels.hrs}</span><span className="text-red-500 font-mono text-[10px] bg-red-50 dark:bg-red-900/30 px-1.5 rounded border border-red-100 dark:border-red-900">({percentage}%)</span><span className="text-gray-300 mx-1">‚Ä¢</span><span>{rec.note}</span></div></div></div>
                                                            <span className={`text-[10px] font-bold px-2 py-1 rounded ${rec.status === 'excused' ? 'bg-orange-100 text-orange-700' : 'bg-red-100 text-red-700'}`}>{rec.status === 'excused' ? labels.excused : labels.unexcused}</span>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ) : <div className="p-6 text-center text-gray-400 text-sm flex flex-col items-center gap-2"><CheckCircle2 size={24} className="text-emerald-500 opacity-50"/>{labels.noAbsences}</div>}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // 6. ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä
        const AcademicRecordPage = ({ onBack, lang, t, onOpenNotifications }) => {
            const isAr = lang === 'ar';
            
            // Labels
            const labels = {
                title: isAr ? "ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä" : "Academic Record",
                // ... (existing labels)
                code: isAr ? "ÿ±ŸÖÿ≤ ÿßŸÑŸÖŸÇÿ±ÿ±" : "Course Code",
                courseName: isAr ? "ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÇÿ±ÿ±" : "Course Name",
                hours: isAr ? "ÿßŸÑÿ≥ÿßÿπÿßÿ™" : "Hours",
                earned: isAr ? "ÿßŸÑŸÖŸÉÿ™ÿ≥ÿ®ÿ©" : "Earned",
                grade: isAr ? "ÿßŸÑÿØÿ±ÿ¨ÿ©" : "Grade",
                points: isAr ? "ÿßŸÑŸÜŸÇÿßÿ∑" : "Points",
                // ...
                earnedHours: isAr ? "ÿ≥ÿßÿπÿßÿ™ ŸÖŸÉÿ™ÿ≥ÿ®ÿ©" : "Earned Hours",
                semGPA: isAr ? "ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑŸÅÿµŸÑŸä" : "Sem GPA",
                cumGPA: isAr ? "ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä" : "Cum GPA"
            };

            const recordData = {
                student: { 
                    name: isAr ? "ŸÅŸäÿµŸÑ ÿπÿ®ÿØÿßŸÑŸÑŸá ÿßŸÑÿÆÿßŸÑÿØ" : "Faisal Abdullah Al-Khalid", 
                    id: "444002548", 
                    college: isAr ? "ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä ŸàŸÜÿ∏ŸÖ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™" : "Computer & Information Systems",
                    major: isAr ? "ŸáŸÜÿØÿ≥ÿ© ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™" : "Software Engineering",
                    plan: isAr ? "ÿ∑ÿßŸÑÿ® ÿ®ŸÉÿßŸÑŸàÿ±ŸäŸàÿ≥ - ÿÆÿ∑ÿ© 2022" : "Bachelor Student - Plan 2022",
                    status: isAr ? "ŸÖŸÜÿ™ÿ∏ŸÖ" : "Regular",
                    warnings: 0 
                },
                semesters: [
                    { 
                        term: isAr ? "ÿßŸÑŸÅÿµŸÑ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä ÿßŸÑÿ£ŸàŸÑ 1445" : "First Semester 1445", 
                        courses: [ 
                            { code: "SE301", name: isAr ? "ŸáŸÜÿØÿ≥ÿ© ÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™" : "Software Engineering", hours: 3, earned: 3, grade: "ÿ£+", points: "95" }, 
                            { code: "CS305", name: isAr ? "ŸÜÿ∏ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ" : "Operating Systems", hours: 3, earned: 0, grade: "NR", points: "--", isPending: true }, // Updated with Alert
                            { code: "MATH201", name: isAr ? "ÿ•ÿ≠ÿµÿßÿ° ŸáŸÜÿØÿ≥Ÿä" : "Engineering Statistics", hours: 2, earned: 2, grade: "ÿ®+", points: "88" }, 
                            { code: "PHYS101", name: isAr ? "ŸÅŸäÿ≤Ÿäÿßÿ° ÿπÿßŸÖÿ©" : "General Physics", hours: 4, earned: 0, grade: isAr ? "ŸáŸÄ" : "F", points: "55" } 
                        ], 
                        gpaSem: 3.15, 
                        gpaCum: 3.35 
                    },
                    { 
                        term: isAr ? "ÿßŸÑŸÅÿµŸÑ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä ÿßŸÑÿ´ÿßŸÜŸä 1444" : "Second Semester 1444", 
                        courses: [ 
                            { code: "CS204", name: isAr ? "ÿ®ÿ±ŸÖÿ¨ÿ© 2" : "Programming 2", hours: 4, earned: 4, grade: "ÿ£", points: "92" }, 
                            { code: "CS205", name: isAr ? "ŸÇŸàÿßÿπÿØ ÿ®ŸäÿßŸÜÿßÿ™" : "Databases", hours: 3, earned: 3, grade: "ÿ®+", points: "86" }, 
                            { code: "ISL102", name: isAr ? "ÿ´ŸÇÿßŸÅÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ© 2" : "Islamic Culture 2", hours: 2, earned: 2, grade: "ÿ£+", points: "98" } 
                        ], 
                        gpaSem: 3.80, 
                        gpaCum: 3.45 
                    }
                ]
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage 
                        title={labels.title} 
                        onBack={onBack} 
                        lang={lang} 
                        extra={
                            <div className="flex gap-2">
                                <NotificationBell onClick={onOpenNotifications} />
                                <button className="hidden md:flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-teal-700 transition"><Printer size={16}/> {isAr ? "ÿ∑ÿ®ÿßÿπÿ©" : "Print"}</button>
                            </div>
                        } 
                    />
                    <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 p-6 shadow-sm">
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-sm">
                            <div><span className="block text-gray-500 text-xs mb-1">{labels.college}</span><span className="font-bold text-gray-800 dark:text-white">{recordData.student.college}</span></div>
                            <div><span className="block text-gray-500 text-xs mb-1">{labels.major}</span><span className="font-bold text-gray-800 dark:text-white">{recordData.student.major}</span></div>
                            <div><span className="block text-gray-500 text-xs mb-1">{labels.planType}</span><span className="font-bold text-gray-800 dark:text-white">{recordData.student.plan}</span></div>
                            <div><span className="block text-gray-500 text-xs mb-1">{labels.status}</span><span className="inline-flex items-center gap-2 font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded border border-emerald-100">{recordData.student.status} <CheckCircle2 size={14}/></span></div>
                            <div><span className="block text-gray-500 text-xs mb-1">{labels.warnings}</span><span className={`font-bold ${recordData.student.warnings > 0 ? 'text-red-600' : 'text-gray-800 dark:text-white'}`}>{recordData.student.warnings}</span></div>
                        </div>
                    </div>
                    {recordData.semesters.map((sem, idx) => {
                        const totalEarned = sem.courses.reduce((acc, course) => acc + course.earned, 0);
                        return (
                            <div key={idx} className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden">
                                <div className="bg-gray-50 dark:bg-gray-800/50 p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"><h3 className="font-bold text-primary text-base flex items-center gap-2"><div className="w-1.5 h-6 bg-primary rounded-full"></div>{sem.term}</h3></div>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-right text-sm">
                                        <thead className="bg-white dark:bg-gray-800 border-b dark:border-gray-700 text-gray-500 text-xs uppercase tracking-wider">
                                            <tr>
                                                <th className={`p-4 ${!isAr ? 'text-left' : ''}`}>{labels.code}</th>
                                                <th className={`p-4 ${!isAr ? 'text-left' : ''}`}>{labels.courseName}</th>
                                                <th className="p-4 text-center">{labels.hours}</th>
                                                <th className="p-4 text-center">{labels.earned}</th>
                                                <th className="p-4 text-center">{labels.grade}</th>
                                                <th className="p-4 text-center">{labels.points}</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                            {sem.courses.map((course, cIdx) => (
                                                <tr key={cIdx} className={`hover:bg-gray-50 dark:hover:bg-gray-800/50 transition ${course.isPending ? 'bg-amber-50/50 dark:bg-amber-900/10' : ''}`}>
                                                    <td className={`p-4 font-mono text-gray-600 ${!isAr ? 'text-left' : ''}`}>{course.code}</td>
                                                    <td className={`p-4 font-bold text-gray-800 dark:text-white ${!isAr ? 'text-left' : ''} ${course.isPending ? 'flex items-center gap-2' : ''}`}>
                                                        {course.name}
                                                        {course.isPending && <AlertCircle size={14} className="text-amber-500 animate-pulse" title="ÿØÿ±ÿ¨ÿ© ÿ∫Ÿäÿ± ŸÖÿ±ÿµŸàÿØÿ©"/>}
                                                    </td>
                                                    <td className="p-4 text-center text-gray-600">{course.hours}</td>
                                                    <td className="p-4 text-center text-gray-600">{course.earned}</td>
                                                    <td className="p-4 text-center">
                                                        <span className={`px-2 py-1 rounded text-xs font-bold ${course.isPending ? 'bg-amber-100 text-amber-700' : (course.grade.includes('ŸáŸÄ') || course.grade === 'F' || course.grade === 'ÿ≠' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700')}`}>
                                                            {course.grade}
                                                        </span>
                                                    </td>
                                                    <td className="p-4 text-center font-mono font-bold text-gray-700 dark:text-gray-300">{course.points}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                        <tfoot className="bg-gray-50 dark:bg-gray-800/50 border-t border-gray-200 dark:border-gray-700">
                                            <tr>
                                                <td colSpan="6" className="p-4">
                                                    <div className="flex flex-col sm:flex-row justify-end gap-4 sm:gap-8 text-sm">
                                                        <div className="flex items-center justify-between sm:justify-start gap-2 bg-emerald-50 dark:bg-emerald-900/20 px-4 py-2 rounded-lg border border-emerald-100 dark:border-emerald-800 shadow-sm"><span className="text-gray-500 dark:text-gray-400 text-xs">{labels.earnedHours}</span><span className="font-bold text-lg text-emerald-600 dark:text-emerald-400 font-mono">{totalEarned}</span></div>
                                                        <div className="flex items-center justify-between sm:justify-start gap-2 bg-white dark:bg-gray-700 px-4 py-2 rounded-lg border border-gray-100 dark:border-gray-600 shadow-sm"><span className="text-gray-500 dark:text-gray-400 text-xs">{labels.semGPA}</span><span className="font-bold text-lg text-primary font-mono">{sem.gpaSem}</span></div>
                                                        <div className="flex items-center justify-between sm:justify-start gap-2 bg-primary/5 dark:bg-primary/20 px-4 py-2 rounded-lg border border-primary/10 dark:border-primary/30 shadow-sm"><span className="text-gray-500 dark:text-gray-400 text-xs">{labels.cumGPA}</span><span className="font-bold text-lg text-primary font-mono">{sem.gpaCum}</span></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        };

        // 7. ÿßŸÑÿ≠ÿ∞ŸÅ ŸàÿßŸÑÿ•ÿ∂ÿßŸÅÿ©
        const AddDropPage = ({ onBack, lang }) => {
            const isAr = lang === 'ar';
            
            const t = {
                title: isAr ? "ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä (ÿßŸÑÿ≠ÿ∞ŸÅ ŸàÿßŸÑÿ•ÿ∂ÿßŸÅÿ©)" : "E-Registration (Add/Drop)",
                registered: isAr ? "ÿßŸÑŸÖÿ≥ÿ¨ŸÑ" : "Registered",
                hours: isAr ? "ÿ≥ÿßÿπÿßÿ™" : "Hrs",
                closesIn: isAr ? "Ÿäÿ∫ŸÑŸÇ ÿßŸÑÿ≠ÿ∞ŸÅ ŸàÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿÆŸÑÿßŸÑ" : "Add/Drop closes in",
                modifyMsg: isAr ? "ÿ®ÿßÿØÿ± ÿ®ÿ™ÿπÿØŸäŸÑ ÿ¨ÿØŸàŸÑŸÉ ŸÇÿ®ŸÑ ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿ∏ÿßŸÖ" : "Modify your schedule before the system closes",
                day: isAr ? "ŸäŸàŸÖ" : "Day",
                hour: isAr ? "ÿ≥ÿßÿπÿ©" : "Hour",
                min: isAr ? "ÿØŸÇŸäŸÇÿ©" : "Min",
                sec: isAr ? "ÿ´ÿßŸÜŸäÿ©" : "Sec",
                currReg: isAr ? "ÿßŸÑŸÖŸÇÿ±ÿ±ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ¨ŸÑÿ© ÿ≠ÿßŸÑŸäÿßŸã" : "Currently Registered Courses",
                noReg: isAr ? "ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸÇÿ±ÿ±ÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ©" : "No registered courses",
                offered: isAr ? "ÿßŸÑŸÖŸÇÿ±ÿ±ÿßÿ™ ÿßŸÑŸÖÿ∑ÿ±Ÿàÿ≠ÿ©" : "Offered Courses",
                search: isAr ? "ÿ™ÿµŸÅŸäÿ© ÿ®ÿßŸÑŸàŸÇÿ™ (ŸÖÿ´ŸÑÿßŸã 10:00)..." : "Filter by time (e.g. 10:00)...",
                noMatch: isAr ? "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸàÿßÿØ ŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÑŸÑÿ®ÿ≠ÿ´" : "No matching courses found",
                credits: isAr ? "ÿ≥ÿßÿπÿßÿ™ ŸÖÿπÿ™ŸÖÿØÿ©" : "Credits",
                sectionsAvail: isAr ? "ÿ¥ÿπÿ® ŸÖÿ™ÿßÿ≠ÿ©" : "Sections Available",
                add: isAr ? "ÿ•ÿ∂ÿßŸÅÿ©" : "Add",
                dropTitle: isAr ? "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ≠ÿ∞ŸÅ" : "Confirm Drop",
                dropMsg: isAr ? "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ±ÿ∫ÿ®ÿ™ŸÉ ŸÅŸä ÿ≠ÿ∞ŸÅ ŸÖŸÇÿ±ÿ±" : "Are you sure you want to drop",
                addTitle: isAr ? "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©" : "Confirm Add",
                addMsg: isAr ? "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿ∂ÿßŸÅÿ©" : "Are you sure you want to add",
                section: isAr ? "ÿ¥ÿπÿ®ÿ©" : "Section",
                confirm: isAr ? "ÿ™ÿ£ŸÉŸäÿØ" : "Confirm",
                cancel: isAr ? "ÿ•ŸÑÿ∫ÿßÿ°" : "Cancel",
                successDrop: isAr ? "ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÇÿ±ÿ± ÿ®ŸÜÿ¨ÿßÿ≠" : "Course dropped successfully",
                successAdd: isAr ? "ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÇÿ±ÿ± ÿ®ŸÜÿ¨ÿßÿ≠" : "Course added successfully",
                closedErr: isAr ? "ÿπÿ∞ÿ±ÿßŸãÿå Ÿáÿ∞Ÿá ÿßŸÑÿ¥ÿπÿ®ÿ© ŸÖÿ∫ŸÑŸÇÿ©" : "Sorry, this section is closed",
                status: isAr ? "ÿßŸÑÿ≠ÿßŸÑÿ©" : "Status",
                open: isAr ? "ŸÖÿ™ÿßÿ≠" : "Open",
                closed: isAr ? "ŸÖÿ∫ŸÑŸÇ" : "Closed",
                instructor: isAr ? "ÿßŸÑŸÖÿ≠ÿßÿ∂ÿ±" : "Instructor",
                timeDays: isAr ? "ÿßŸÑŸàŸÇÿ™ / ÿßŸÑÿ£ŸäÿßŸÖ" : "Time / Days",
                selectSecHeader: isAr ? "ÿßÿÆÿ™ÿ± ÿßŸÑÿ¥ÿπÿ®ÿ© ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ© ŸÑÿ•ÿ∂ÿßŸÅÿ™Ÿáÿß ŸÑÿ¨ÿØŸàŸÑŸÉ" : "Select a section to add",
                selectSec: isAr ? "ÿßŸÑÿ¥ÿπÿ®ÿ©" : "Section",
                drop: isAr ? "ÿ≠ÿ∞ŸÅ" : "Drop"
            };

            const courseNames = {
                'PHYS101': { ar: 'ŸÅŸäÿ≤Ÿäÿßÿ° ÿπÿßŸÖÿ©', en: 'General Physics' },
                'ISL101': { ar: 'ÿ´ŸÇÿßŸÅÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ©', en: 'Islamic Culture' },
                'CS204': { ar: 'ÿ™ÿ±ÿßŸÉŸäÿ® ÿ®ŸäÿßŸÜÿßÿ™', en: 'Data Structures' },
                'CS101': { ar: 'ŸÖŸÇÿØŸÖÿ© ŸÅŸä ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ©', en: 'Intro to Programming' },
                'MATH101': { ar: 'ÿ™ŸÅÿßÿ∂ŸÑ Ÿàÿ™ŸÉÿßŸÖŸÑ', en: 'Calculus' }
            };

            const getName = (code) => courseNames[code] ? (isAr ? courseNames[code].ar : courseNames[code].en) : code;

            const [availableCourses, setAvailableCourses] = useState([ 
                { code: 'PHYS101', hours: 4, sections: [ { id: 's1', section: '302', profAr: 'ÿØ. ÿ≥ÿßŸÖŸä ÿßŸÑÿ≠ÿ±ÿ®Ÿä', profEn: 'Dr. Sami', time: '10:00 - 11:50', daysAr: 'ÿßŸÑÿ£ÿ≠ÿØ - ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°', daysEn: 'Sun - Tue', status: 'open' }, { id: 's2', section: '305', profAr: 'ÿ£. ŸÖÿßÿ¨ÿØ ÿßŸÑŸÅŸáŸÖŸä', profEn: 'Mr. Majed', time: '08:00 - 09:50', daysAr: 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ - ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°', daysEn: 'Mon - Wed', status: 'open' }, { id: 's3', section: '308', profAr: 'ÿØ. ÿ±Ÿàÿ®ÿ±ÿ™', profEn: 'Dr. Robert', time: '13:00 - 14:50', daysAr: 'ÿßŸÑÿ£ÿ≠ÿØ - ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°', daysEn: 'Sun - Tue', status: 'closed' } ] }, 
                { code: 'ISL101', hours: 2, sections: [ { id: 's4', section: '401', profAr: 'ÿØ. ÿπÿ®ÿØÿßŸÑÿ±ÿ≠ŸÖŸÜ', profEn: 'Dr. Abdulrahman', time: '08:00 - 08:50', daysAr: 'ÿπŸÜ ÿ®ÿπÿØ', daysEn: 'Online', status: 'open' }, { id: 's5', section: '402', profAr: 'ÿØ. ÿπÿ®ÿØÿßŸÑŸÑŸá', profEn: 'Dr. Abdullah', time: '09:00 - 09:50', daysAr: 'ÿπŸÜ ÿ®ÿπÿØ', daysEn: 'Online', status: 'open' } ] }, 
                { code: 'CS204', hours: 3, sections: [ { id: 's6', section: '201', profAr: 'ÿØ. ÿπŸÑŸä ÿßŸÑŸÇÿ≠ÿ∑ÿßŸÜŸä', profEn: 'Dr. Ali', time: '10:00 - 10:50', daysAr: 'ÿßŸÑÿ£ÿ≠ÿØ - ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ° - ÿßŸÑÿÆŸÖŸäÿ≥', daysEn: 'Sun - Tue - Thu', status: 'open' } ] } 
            ]);
            const [enrolled, setEnrolled] = useState([ 
                { id: 1, code: 'CS101', hours: 3, section: '201', profAr: 'ÿØ. ÿÆÿßŸÑÿØ', profEn: 'Dr. Khaled', time: '08:00 - 08:50' }, 
                { id: 2, code: 'MATH101', hours: 4, section: '105', profAr: 'ÿØ. ŸÖÿµÿ∑ŸÅŸâ', profEn: 'Dr. Mustafa', time: '09:00 - 09:50' } 
            ]);
            
            const [filterTime, setFilterTime] = useState('');
            const [selectedCourseForAdd, setSelectedCourseForAdd] = useState(null);
            const [confirmationModal, setConfirmationModal] = useState(null); 
            const [message, setMessage] = useState(null);
            
            // --- NEW: Timer State Logic ---
            const [timeLeft, setTimeLeft] = useState({ days: 2, hours: 14, minutes: 30, seconds: 59 });

            useEffect(() => {
                const timer = setInterval(() => {
                    setTimeLeft(prev => {
                        if (prev.seconds > 0) return { ...prev, seconds: prev.seconds - 1 };
                        if (prev.minutes > 0) return { ...prev, minutes: prev.minutes - 1, seconds: 59 };
                        if (prev.hours > 0) return { ...prev, hours: prev.hours - 1, minutes: 59, seconds: 59 };
                        if (prev.days > 0) return { ...prev, days: prev.days - 1, hours: 23, minutes: 59, seconds: 59 };
                        return prev; 
                    });
                }, 1000);
                return () => clearInterval(timer);
            }, []);
            // -----------------------------

            const filteredAvailable = availableCourses.filter(course => { if (!filterTime) return true; return course.sections.some(sec => sec.time.includes(filterTime)); });
            
            const handleDropClick = (course) => { 
                setConfirmationModal({ type: 'drop', item: course, title: t.dropTitle, text: `${t.dropMsg} ${getName(course.code)}?` }); 
            };
            const handleAddClick = (course) => { setSelectedCourseForAdd(course); };
            const handleSectionSelect = (course, section) => { 
                if (section.status === 'closed') { setMessage({ text: t.closedErr, type: 'error' }); setTimeout(() => setMessage(null), 3000); return; } 
                setConfirmationModal({ type: 'add', item: { ...course, ...section, id: Date.now() }, title: t.addTitle, text: `${t.addMsg} ${getName(course.code)} - ${t.section} ${section.section}?` }); 
            };
            
            const executeAction = () => { 
                const action = confirmationModal.type; 
                const item = confirmationModal.item; 
                if (action === 'drop') { 
                    setEnrolled(enrolled.filter(c => c.id !== item.id)); 
                    setMessage({ text: t.successDrop, type: 'success' }); 
                } else if (action === 'add') { 
                    setEnrolled([...enrolled, item]); 
                    setSelectedCourseForAdd(null); 
                    setMessage({ text: t.successAdd, type: 'success' }); 
                } 
                setConfirmationModal(null); 
                setTimeout(() => setMessage(null), 3000); 
            };
            
            return (
                <div className="animate-fade-in space-y-6 relative">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} extra={<div className="flex gap-2"><span className="bg-primary/10 text-primary px-3 py-1 rounded-lg text-xs font-bold border border-primary/20">{t.registered}: {enrolled.reduce((acc, c) => acc + c.hours, 0)} {t.hours}</span></div>} />
                    
                    {/* --- NEW: Countdown Timer Component --- */}
                    <div className="bg-gradient-to-l from-primary to-teal-800 rounded-2xl p-6 text-white shadow-lg flex flex-col md:flex-row items-center justify-between gap-6 relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        
                        <div className="relative z-10 text-center md:text-right">
                            <h3 className="text-xl font-bold mb-1 flex items-center justify-center md:justify-start gap-2">
                                <Clock className="animate-pulse" size={24}/> {t.closesIn}
                            </h3>
                            <p className="text-teal-100 text-sm opacity-90">{t.modifyMsg}</p>
                        </div>

                        <div className="relative z-10 flex gap-4">
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.days}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">{t.day}</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.hours}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">{t.hour}</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.minutes}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">{t.min}</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.seconds}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">{t.sec}</span>
                            </div>
                        </div>
                    </div>
                    {/* -------------------------------------- */}

                    {message && <div className={`fixed top-4 left-1/2 -translate-x-1/2 px-6 py-3 rounded-full shadow-xl text-white font-bold text-sm flex items-center gap-2 z-[60] animate-fade-in ${message.type === 'success' ? 'bg-green-600' : 'bg-red-600'}`}>{message.type === 'success' ? <CheckCircle2 size={18}/> : <AlertTriangle size={18}/>}{message.text}</div>}
                    {confirmationModal && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
                            <div className="bg-white dark:bg-dark-card w-full max-w-sm rounded-2xl shadow-2xl p-6 border border-gray-100 dark:border-gray-700">
                                <div className={`w-12 h-12 rounded-full flex items-center justify-center mb-4 mx-auto ${confirmationModal.type === 'add' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}>{confirmationModal.type === 'add' ? <PlusCircle size={24}/> : <MinusCircle size={24}/>}</div>
                                <h3 className="text-lg font-bold text-center mb-2 text-gray-800 dark:text-white">{confirmationModal.title}</h3><p className="text-sm text-gray-500 text-center mb-6">{confirmationModal.text}</p>
                                <div className="flex gap-3"><button onClick={executeAction} className={`flex-1 py-2.5 rounded-xl text-white font-bold transition ${confirmationModal.type === 'add' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`}>{t.confirm}</button><button onClick={() => setConfirmationModal(null)} className="flex-1 py-2.5 rounded-xl bg-gray-100 text-gray-700 font-bold hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300">{t.cancel}</button></div>
                            </div>
                        </div>
                    )}
                    {selectedCourseForAdd && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onClick={() => setSelectedCourseForAdd(null)}>
                            <div className="bg-white dark:bg-dark-card w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
                                <div className="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/80 dark:bg-gray-800/80"><div><h3 className="font-bold text-lg text-primary">{getName(selectedCourseForAdd.code)}</h3><p className="text-xs text-gray-500">{t.selectSecHeader}</p></div><button onClick={() => setSelectedCourseForAdd(null)} className="p-2 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200"><X size={18}/></button></div>
                                <div className="overflow-y-auto p-4"><table className="w-full text-sm text-right"><thead className="text-gray-500 font-medium bg-gray-50 dark:bg-gray-800/50 rounded-lg"><tr><th className="p-3 rounded-r-lg">{t.selectSec}</th><th className="p-3">{t.timeDays}</th><th className="p-3">{t.instructor}</th><th className="p-3">{t.status}</th><th className="p-3 rounded-l-lg"></th></tr></thead><tbody className="divide-y divide-gray-100 dark:divide-gray-700">{selectedCourseForAdd.sections.map((sec, idx) => (<tr key={idx} className={`hover:bg-gray-50 dark:hover:bg-gray-800/30 transition ${sec.status === 'closed' ? 'opacity-60 grayscale' : ''}`}><td className="p-3 font-bold font-mono text-primary">{sec.section}</td><td className="p-3"><div className="font-bold text-gray-800 dark:text-gray-200 dir-ltr text-right">{sec.time}</div><div className="text-[10px] text-gray-500">{isAr ? (sec.daysAr || sec.days) : (sec.daysEn || sec.days)}</div></td><td className="p-3 text-gray-600 dark:text-gray-400">{isAr ? (sec.profAr || sec.prof) : (sec.profEn || sec.prof)}</td><td className="p-3"><span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sec.status === 'open' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{sec.status === 'open' ? t.open : t.closed}</span></td><td className="p-3 text-left"><button onClick={() => handleSectionSelect(selectedCourseForAdd, sec)} disabled={sec.status === 'closed'} className={`p-2 rounded-lg transition ${sec.status === 'open' ? 'bg-primary text-white hover:bg-teal-700 shadow-sm' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}><PlusCircle size={18}/></button></td></tr>))}</tbody></table></div>
                            </div>
                        </div>
                    )}
                    <div className="grid grid-cols-1 gap-6">
                        <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm p-5"><h3 className="font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2 border-b border-gray-100 pb-3"><FileCheck className="text-green-600" size={20}/> {t.currReg}</h3><div className="space-y-3">{enrolled.length === 0 ? <p className="text-center text-gray-400 py-4 text-sm">{t.noReg}</p> : enrolled.map(c => (<div key={c.id} className="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700 group hover:border-red-200 transition-colors"><div><div className="font-bold text-gray-800 dark:text-white flex items-center gap-2">{getName(c.code)}<span className="text-[10px] px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded font-mono text-gray-600">{c.section}</span></div><div className="text-xs text-gray-500 mt-1 flex gap-3 items-center"><span className="font-mono bg-white dark:bg-gray-700 px-1 rounded border dark:border-gray-600">{c.code}</span><span className="flex items-center gap-1"><User size={10}/> {isAr ? (c.profAr || c.prof) : (c.profEn || c.prof)}</span><span className="flex items-center gap-1 dir-ltr"><Clock size={10}/> {c.time}</span></div></div><button onClick={() => handleDropClick(c)} className="p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-500 hover:text-white transition shadow-sm border border-red-100" title={t.drop}><LogOut size={18} className="rotate-180"/></button></div>))}</div></div>
                        <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm p-5"><div className="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4 border-b border-gray-100 pb-3"><h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2"><Layers className="text-primary" size={20}/> {t.offered}</h3><div className="relative"><Search size={16} className="absolute top-1/2 right-3 -translate-y-1/2 text-gray-400"/><input type="text" placeholder={t.search} value={filterTime} onChange={(e) => setFilterTime(e.target.value)} className="w-full md:w-64 pl-4 pr-9 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary/20 transition"/></div></div><div className="space-y-3">{filteredAvailable.length === 0 ? <p className="text-center text-gray-400 py-8 text-sm">{t.noMatch}</p> : filteredAvailable.map(c => (<div key={c.code} className="flex justify-between items-center p-4 bg-white border border-gray-200 dark:border-gray-700 rounded-xl hover:border-primary transition shadow-sm"><div><div className="font-bold text-gray-800 dark:text-white text-base">{getName(c.code)}</div><div className="text-xs text-gray-500 mt-1 flex gap-3"><span className="font-mono bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded">{c.code}</span><span>{c.hours} {t.credits}</span><span className="text-primary font-bold">{c.sections.length} {t.sectionsAvail}</span></div></div><button onClick={() => handleAddClick(c)} className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg text-xs font-bold hover:bg-teal-700 shadow-sm transition-transform active:scale-95"><PlusCircle size={16}/> {t.add}</button></div>))}</div></div>
                    </div>
                </div>
            );
        };

        // 8. ÿßŸÑŸÖŸÇÿ±ÿ±ÿßÿ™ ÿßŸÑŸÖÿ∑ÿ±Ÿàÿ≠ÿ© (ÿ®ÿ≠ÿ´ ÿπÿßŸÖ)
        const OfferedCoursesPage = ({ onBack, lang }) => {
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCourse, setSelectedCourse] = useState(null);
            const isAr = lang === 'ar';

            const t = {
                title: isAr ? "ÿßŸÑŸÖŸÇÿ±ÿ±ÿßÿ™ ÿßŸÑŸÖÿ∑ÿ±Ÿàÿ≠ÿ©" : "Offered Courses",
                searchPlaceholder: isAr ? "ÿßÿ®ÿ≠ÿ´ ÿ®ÿ±ŸÖÿ≤ ÿßŸÑŸÖŸÇÿ±ÿ± ÿ£Ÿà ÿßŸÑÿßÿ≥ŸÖ..." : "Search by course code or name...",
                viewSections: isAr ? "ÿπÿ±ÿ∂ ÿßŸÑÿ¥ÿπÿ®" : "View Sections",
                section: isAr ? "ÿßŸÑÿ¥ÿπÿ®ÿ©" : "Section",
                timeDays: isAr ? "ÿßŸÑŸàŸÇÿ™ / ÿßŸÑÿ£ŸäÿßŸÖ" : "Time / Days",
                instructor: isAr ? "ÿßŸÑŸÖÿ≠ÿßÿ∂ÿ±" : "Instructor",
                status: isAr ? "ÿßŸÑÿ≠ÿßŸÑÿ©" : "Status",
                open: isAr ? "ŸÖÿ™ÿßÿ≠" : "Open",
                closed: isAr ? "ŸÖÿ∫ŸÑŸÇ" : "Closed",
                // Additional labels used in cards
                credits: isAr ? "ÿ≥ÿßÿπÿßÿ™ ŸÖÿπÿ™ŸÖÿØÿ©" : "Credits", // though not explicitly labeled in card, context is hours
                sectionsAvailable: isAr ? "ÿ¥ÿπÿ® ŸÖÿ™ÿßÿ≠ÿ©" : "Sections Available"
            };

            const courses = [
                { 
                    code: 'MATH101', 
                    name: isAr ? 'ÿ™ŸÅÿßÿ∂ŸÑ Ÿàÿ™ŸÉÿßŸÖŸÑ 1' : 'Calculus 1', 
                    college: isAr ? 'ÿßŸÑÿπŸÑŸàŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©' : 'Basic Sciences',
                    sections: [
                        { section: '101', time: '08:00 - 09:50', days: isAr ? 'ÿßŸÑÿ£ÿ≠ÿØ - ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°' : 'Sun - Tue', prof: isAr ? 'ÿØ. ÿ£ÿ≠ŸÖÿØ ÿ≥ÿßŸÑŸÖ' : 'Dr. Ahmed Salem', status: 'open' },
                        { section: '102', time: '10:00 - 11:50', days: isAr ? 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ - ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°' : 'Mon - Wed', prof: isAr ? 'ÿØ. ŸÖÿ≠ŸÖÿØ ÿπŸÑŸä' : 'Dr. Mohamed Ali', status: 'closed' }
                    ]
                },
                { 
                    code: 'CS101', 
                    name: isAr ? 'ŸÖŸÇÿØŸÖÿ© ŸÅŸä ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ©' : 'Introduction to Programming', 
                    college: isAr ? 'ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä' : 'Computer Science',
                    sections: [
                        { section: '201', time: '08:00 - 08:50', days: isAr ? 'ÿßŸÑÿ£ÿ≠ÿØ - ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ° - ÿßŸÑÿÆŸÖŸäÿ≥' : 'Sun - Tue - Thu', prof: isAr ? 'ÿ£. ÿÆÿßŸÑÿØ' : 'Mr. Khaled', status: 'open' },
                        { section: '202', time: '09:00 - 09:50', days: isAr ? 'ÿßŸÑÿ£ÿ≠ÿØ - ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ° - ÿßŸÑÿÆŸÖŸäÿ≥' : 'Sun - Tue - Thu', prof: isAr ? 'ÿØ. ÿ≥ÿßÿ±ÿ©' : 'Dr. Sara', status: 'open' },
                        { section: '203', time: '13:00 - 13:50', days: isAr ? 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ - ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°' : 'Mon - Wed', prof: isAr ? 'ÿØ. ÿπŸÖÿ±' : 'Dr. Omar', status: 'open' }
                    ]
                },
                { 
                    code: 'ISL101', 
                    name: isAr ? 'ÿ´ŸÇÿßŸÅÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ© 1' : 'Islamic Culture 1', 
                    college: isAr ? 'ÿßŸÑÿØÿ±ÿßÿ≥ÿßÿ™ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ©' : 'Islamic Studies',
                    sections: [
                        { section: '301', time: '13:00 - 13:50', days: isAr ? 'ÿπŸÜ ÿ®ÿπÿØ' : 'Online', prof: isAr ? 'ÿØ. ÿπŸÑŸä' : 'Dr. Ali', status: 'open' },
                        { section: '302', time: '14:00 - 14:50', days: isAr ? 'ÿπŸÜ ÿ®ÿπÿØ' : 'Online', prof: isAr ? 'ÿØ. ÿπÿ®ÿØÿßŸÑŸÑŸá' : 'Dr. Abdullah', status: 'open' }
                    ]
                },
                { 
                    code: 'SE301', 
                    name: isAr ? 'ŸáŸÜÿØÿ≥ÿ© ÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™' : 'Software Engineering', 
                    college: isAr ? 'ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä' : 'Computer Science',
                    sections: [
                        { section: '401', time: '10:00 - 11:50', days: isAr ? 'ÿßŸÑÿßÿ´ŸÜŸäŸÜ' : 'Mon', prof: isAr ? 'ÿØ. ŸÅŸáÿØ' : 'Dr. Fahad', status: 'open' }
                    ]
                },
            ];

            const filtered = courses.filter(c => c.name.toLowerCase().includes(searchTerm.toLowerCase()) || c.code.toLowerCase().includes(searchTerm.toLowerCase()));

            return (
                <div className="animate-fade-in space-y-6 relative">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} />
                    
                    {/* Modal for Sections */}
                    {selectedCourse && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" onClick={() => setSelectedCourse(null)}>
                            <div className="bg-white dark:bg-dark-card w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden border border-gray-100 dark:border-gray-700 flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
                                <div className="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/80 dark:bg-gray-800/80">
                                    <div>
                                        <h3 className="font-bold text-lg text-primary">{selectedCourse.name}</h3>
                                        <p className="text-xs text-gray-500 font-mono">{selectedCourse.code}</p>
                                    </div>
                                    <button onClick={() => setSelectedCourse(null)} className="p-2 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200 text-gray-500"><X size={18}/></button>
                                </div>
                                <div className="overflow-y-auto p-4">
                                    <table className="w-full text-sm text-right">
                                        <thead className="text-gray-500 font-medium bg-gray-50 dark:bg-gray-800/50 rounded-lg">
                                            <tr>
                                                <th className="p-3 rounded-r-lg">{t.section}</th>
                                                <th className="p-3">{t.timeDays}</th>
                                                <th className="p-3">{t.instructor}</th>
                                                <th className="p-3 rounded-l-lg">{t.status}</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                            {selectedCourse.sections.map((sec, idx) => (
                                                <tr key={idx} className="hover:bg-gray-50 dark:hover:bg-gray-800/30 transition">
                                                    <td className="p-3 font-bold font-mono text-primary">{sec.section}</td>
                                                    <td className="p-3">
                                                        <div className="font-bold text-gray-800 dark:text-gray-200 dir-ltr text-right">{sec.time}</div>
                                                        <div className="text-[10px] text-gray-500">{sec.days}</div>
                                                    </td>
                                                    <td className="p-3 text-gray-600 dark:text-gray-400">{sec.prof}</td>
                                                    <td className="p-3">
                                                        <span className={`px-2 py-0.5 rounded text-[10px] font-bold ${sec.status === 'open' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                                            {sec.status === 'open' ? t.open : t.closed}
                                                        </span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="relative">
                        <Search className="absolute top-1/2 right-4 -translate-y-1/2 text-gray-400" size={20} />
                        <input 
                            type="text" 
                            placeholder={t.searchPlaceholder} 
                            className="w-full p-4 pr-12 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-card shadow-sm focus:ring-2 focus:ring-primary/20 outline-none dark:text-white"
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                        />
                    </div>
                    <div className="grid gap-3">
                        {filtered.map((c, i) => (
                            <div key={i} className="bg-white dark:bg-dark-card p-4 rounded-xl border border-gray-200 dark:border-gray-700 flex justify-between items-center hover:border-primary transition shadow-sm">
                                <div>
                                    <h4 className="font-bold text-gray-800 dark:text-white">{c.name}</h4>
                                    <div className="text-xs text-gray-500 mt-1 flex gap-2">
                                        <span className="bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded font-mono">{c.code}</span>
                                        <span>{c.college}</span>
                                    </div>
                                </div>
                                <button 
                                    onClick={() => setSelectedCourse(c)}
                                    className="text-primary bg-primary/5 px-4 py-2 rounded-lg text-sm font-bold hover:bg-primary/10 transition flex items-center gap-2"
                                >
                                    <Layers size={16}/>
                                    {t.viewSections}
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // 9. ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÇÿ≥ŸÖ (ÿ•ÿ∂ÿßŸÅÿ©ÿå ÿ™ÿ∫ŸäŸäÿ± ÿ¥ÿπÿ®ÿ©ÿå ÿ≠ÿ∞ŸÅ) - ŸÖŸÉŸàŸÜ ŸÖŸàÿ≠ÿØ
        const DepartmentRequestPage = ({ onBack, type, lang }) => {
            const isAr = lang === 'ar';
            
            const titles = {
                'add': isAr ? 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÇÿ±ÿ± ÿ®ŸÖŸàÿßŸÅŸÇÿ© ÿßŸÑŸÇÿ≥ŸÖ' : 'Add Course (Dept Approval)',
                'drop': isAr ? 'ÿ≠ÿ∞ŸÅ ŸÖŸÇÿ±ÿ± ÿ®ŸÖŸàÿßŸÅŸÇÿ© ÿßŸÑŸÇÿ≥ŸÖ' : 'Drop Course (Dept Approval)',
                'change': isAr ? 'ÿ™ÿ∫ŸäŸäÿ± ÿ¥ÿπÿ®ÿ© ÿ®ŸÖŸàÿßŸÅŸÇÿ© ÿßŸÑŸÇÿ≥ŸÖ' : 'Change Section (Dept Approval)'
            };

            const t = {
                selectAdd: isAr ? 'ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸÇÿ±ÿ± ÿßŸÑŸÖÿ±ÿßÿØ ÿ•ÿ∂ÿßŸÅÿ™Ÿá' : 'Select course to add',
                selectDrop: isAr ? 'ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸÇÿ±ÿ± ÿßŸÑŸÖÿ±ÿßÿØ ÿ≠ÿ∞ŸÅŸá' : 'Select course to drop',
                selectChange: isAr ? 'ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸÇÿ±ÿ± ÿßŸÑŸÖÿ±ÿßÿØ ÿ™ÿ∫ŸäŸäÿ± ÿ¥ÿπÿ®ÿ™Ÿá' : 'Select course to change section',
                sectionNum: isAr ? 'ÿ±ŸÇŸÖ ÿßŸÑÿ¥ÿπÿ®ÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©' : 'Required Section Number',
                justification: isAr ? 'ÿßŸÑŸÖÿ®ÿ±ÿ±ÿßÿ™' : 'Justification',
                defaultOption: isAr ? '-- ÿßÿÆÿ™ÿ± ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© --' : '-- Select from list --',
                secPlaceholder: isAr ? 'ŸÖÿ´ÿßŸÑ: 201' : 'e.g. 201',
                justPlaceholder: isAr ? 'Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ÿ≥ÿ®ÿ® ÿ™ŸÇÿØŸäŸÖ ÿßŸÑÿ∑ŸÑÿ® ÿ®Ÿàÿ∂Ÿàÿ≠...' : 'Please state the reason clearly...',
                submit: isAr ? 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®' : 'Submit Request',
                successTitle: isAr ? 'ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠' : 'Request Submitted Successfully',
                reqId: isAr ? 'ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®:' : 'Request ID:',
                backMenu: isAr ? 'ÿπŸàÿØÿ© ŸÑŸÑŸÇÿßÿ¶ŸÖÿ©' : 'Back to Menu'
            };

            const myCourses = [
                { code: 'CS204', nameAr: 'ÿ®ÿ±ŸÖÿ¨ÿ© 2 - CS204', nameEn: 'Programming 2 - CS204' },
                { code: 'CS205', nameAr: 'ŸÇŸàÿßÿπÿØ ÿ®ŸäÿßŸÜÿßÿ™ - CS205', nameEn: 'Databases - CS205' },
                { code: 'ISL102', nameAr: 'ÿ´ŸÇÿßŸÅÿ© ÿ•ÿ≥ŸÑÿßŸÖŸäÿ© 2 - ISL102', nameEn: 'Islamic Culture 2 - ISL102' }
            ];

            const offeredCourses = [
                { code: 'SE301', nameAr: 'ŸáŸÜÿØÿ≥ÿ© ÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™ - SE301', nameEn: 'Software Engineering - SE301' },
                { code: 'CS305', nameAr: 'ŸÜÿ∏ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ - CS305', nameEn: 'Operating Systems - CS305' },
                { code: 'NET201', nameAr: 'ÿ™ÿ±ÿßÿ≥ŸÑ ÿ®ŸäÿßŸÜÿßÿ™ - NET201', nameEn: 'Data Communication - NET201' },
                { code: 'MATH201', nameAr: 'ÿ•ÿ≠ÿµÿßÿ° ŸáŸÜÿØÿ≥Ÿä - MATH201', nameEn: 'Engineering Statistics - MATH201' }
            ];

            const coursesList = type === 'add' ? offeredCourses : myCourses;
            const labelText = type === 'add' ? t.selectAdd : (type === 'drop' ? t.selectDrop : t.selectChange);

            const [submitted, setSubmitted] = useState(false);
            const [selectedCourse, setSelectedCourse] = useState('');

            if(submitted) {
                return (
                    <div className="animate-fade-in text-center py-20">
                        <div className="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6"><Check size={40}/></div>
                        <h3 className="text-2xl font-bold text-gray-800 dark:text-white mb-2">{t.successTitle}</h3>
                        <p className="text-gray-500 mb-6">{t.reqId} #REQ-{Math.floor(Math.random()*10000)}</p>
                        <button onClick={onBack} className="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg font-bold hover:bg-gray-200">{t.backMenu}</button>
                    </div>
                )
            }

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={titles[type]} onBack={onBack} lang={lang} />
                    <div className="bg-white dark:bg-dark-card p-6 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm">
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">{labelText}</label>
                                <div className="relative">
                                    <select 
                                        className="w-full p-3 pr-10 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none appearance-none text-gray-700 dark:text-gray-200"
                                        value={selectedCourse}
                                        onChange={(e) => setSelectedCourse(e.target.value)}
                                    >
                                        <option value="" disabled>{t.defaultOption}</option>
                                        {coursesList.map((c, i) => (
                                            <option key={i} value={c.code}>{isAr ? c.nameAr : c.nameEn}</option>
                                        ))}
                                    </select>
                                    <ChevronDown className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" size={18}/>
                                </div>
                            </div>
                            
                            {type !== 'drop' && (
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">{t.sectionNum}</label>
                                    <input type="number" className="w-full p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none" placeholder={t.secPlaceholder} />
                                </div>
                            )}

                            <div>
                                <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">{t.justification}</label>
                                <textarea className="w-full p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none h-32" placeholder={t.justPlaceholder}></textarea>
                            </div>

                            <button 
                                onClick={() => setSubmitted(true)} 
                                disabled={!selectedCourse}
                                className={`w-full font-bold py-3 rounded-xl transition shadow-lg ${!selectedCourse ? 'bg-gray-300 text-gray-500 cursor-not-allowed shadow-none' : 'bg-primary text-white hover:bg-teal-700 shadow-primary/20'}`}
                            >
                                {t.submit}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 10. ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä
        const RegistrationRequestsPage = ({ onBack, lang }) => {
            const isAr = lang === 'ar';
            
            const t = {
                title: isAr ? "ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä" : "Registration Requests",
                reqDate: isAr ? "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ŸÑÿ®:" : "Request Date:",
                details: isAr ? "ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ" : "View Details",
                pending: isAr ? "ŸÇŸäÿØ ÿßŸÑÿØÿ±ÿßÿ≥ÿ©" : "Pending",
                approved: isAr ? "ŸÖŸÇÿ®ŸàŸÑ" : "Approved",
                rejected: isAr ? "ŸÖÿ±ŸÅŸàÿ∂" : "Rejected",
                types: {
                    add: isAr ? 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÇÿ±ÿ±' : 'Add Course',
                    change: isAr ? 'ÿ™ÿ∫ŸäŸäÿ± ÿ¥ÿπÿ®ÿ©' : 'Change Section',
                    drop: isAr ? 'ÿ≠ÿ∞ŸÅ ŸÖŸÇÿ±ÿ±' : 'Drop Course'
                }
            };

            const requests = [
                { id: 501, typeKey: 'add', date: '2024-05-10', status: 'pending', course: 'CS302' },
                { id: 402, typeKey: 'change', date: '2024-05-08', status: 'approved', course: 'MATH201' },
                { id: 305, typeKey: 'drop', date: '2024-05-01', status: 'rejected', course: 'ISL101' },
            ];

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} />
                    <div className="space-y-3">
                        {requests.map(req => (
                            <div key={req.id} className="bg-white dark:bg-dark-card p-4 rounded-xl border border-gray-200 dark:border-gray-700 flex justify-between items-center shadow-sm">
                                <div>
                                    <div className="font-bold text-gray-800 dark:text-white flex items-center gap-2">
                                        {t.types[req.typeKey]}
                                        <span className="text-xs bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded font-mono text-gray-500">{req.course}</span>
                                    </div>
                                    <div className="text-xs text-gray-400 mt-1">{t.reqDate} {req.date}</div>
                                </div>
                                <div>
                                    {req.status === 'pending' && <span className="bg-yellow-100 text-yellow-700 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1"><Clock size={12}/> {t.pending}</span>}
                                    {req.status === 'approved' && <span className="bg-green-100 text-green-700 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1"><Check size={12}/> {t.approved}</span>}
                                    {req.status === 'rejected' && <span className="bg-red-100 text-red-700 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1"><X size={12}/> {t.rejected}</span>}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // 11. ÿ∑ŸÑÿ® ÿ≠ÿ±ŸÉÿ© ÿ£ŸÉÿßÿØŸäŸÖŸäÿ© (ÿ¨ÿØŸäÿØ)
        const NewAcademicActionPage = ({ onBack, lang }) => {
            const [actionType, setActionType] = useState('');
            const [submitted, setSubmitted] = useState(false);
            const isAr = lang === 'ar';

            const t = {
                title: isAr ? "ÿ∑ŸÑÿ® ÿ≠ÿ±ŸÉÿ© ÿ£ŸÉÿßÿØŸäŸÖŸäÿ©" : "New Academic Action Request",
                typeLabel: isAr ? "ŸÜŸàÿπ ÿßŸÑÿ≠ÿ±ŸÉÿ© ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ©" : "Academic Action Type",
                defaultOption: isAr ? "-- ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑÿ≠ÿ±ŸÉÿ© --" : "-- Select Action Type --",
                options: {
                    apology: isAr ? "ÿßÿπÿ™ÿ∞ÿßÿ± ÿπŸÜ ŸÅÿµŸÑ ÿØÿ±ÿßÿ≥Ÿä" : "Semester Apology",
                    postpone: isAr ? "ÿ™ÿ£ÿ¨ŸäŸÑ ÿßŸÑÿØÿ±ÿßÿ≥ÿ©" : "Study Postponement",
                    reenroll: isAr ? "ÿ•ÿπÿßÿØÿ© ŸÇŸäÿØ" : "Re-enrollment",
                    chance: isAr ? "ŸÅÿ±ÿµÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©" : "Additional Chance"
                },
                warningApology: isAr ? "ÿ™ŸÜÿ®ŸäŸá: ÿßŸÑÿßÿπÿ™ÿ∞ÿßÿ± ÿπŸÜ ÿßŸÑŸÅÿµŸÑ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä ÿ≥Ÿäÿ™ŸÖ ÿßÿ≠ÿ™ÿ≥ÿßÿ®Ÿá ÿ∂ŸÖŸÜ ÿßŸÑŸÖÿØÿ© ÿßŸÑŸÜÿ∏ÿßŸÖŸäÿ© ŸÑŸÑÿØÿ±ÿßÿ≥ÿ©." : "Warning: Semester apology will be counted within the regular study duration.",
                justificationLabel: isAr ? "ÿßŸÑŸÖÿ®ÿ±ÿ±ÿßÿ™ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)" : "Justification (Optional)",
                justificationPlaceholder: isAr ? "ÿßŸÉÿ™ÿ® ŸÖÿ®ÿ±ÿ±ÿßÿ™ ÿßŸÑÿ∑ŸÑÿ® ŸáŸÜÿß..." : "Write justification here...",
                attachmentsLabel: isAr ? "ÿßŸÑŸÖÿ±ŸÅŸÇÿßÿ™ (ÿ™ŸÇÿ±Ÿäÿ± ÿ∑ÿ®Ÿäÿå ÿ•ŸÑÿÆ)" : "Attachments (Medical Report, etc.)",
                uploadText: isAr ? "ÿßÿ∂ÿ∫ÿ∑ ŸÑÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿ£Ÿà ÿßÿ≥ÿ≠ÿ®Ÿáÿß ŸáŸÜÿß" : "Click to upload or drag files here",
                submitButton: isAr ? "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®" : "Confirm Request",
                successTitle: isAr ? "ÿ™ŸÖ ÿ™ŸÇÿØŸäŸÖ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠" : "Request Submitted Successfully",
                successDesc: isAr ? "ÿ≥Ÿäÿ™ŸÖ ŸÖÿ±ÿßÿ¨ÿπÿ© ÿ∑ŸÑÿ®ŸÉ ŸÖŸÜ ŸÇÿ®ŸÑ ÿßŸÑÿ¨Ÿáÿ© ÿßŸÑŸÖÿÆÿ™ÿµÿ©" : "Your request will be reviewed by the concerned department",
                backButton: isAr ? "ÿπŸàÿØÿ©" : "Back"
            };

            if(submitted) {
                return (
                    <div className="animate-fade-in text-center py-20">
                        <div className="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6"><Check size={40}/></div>
                        <h3 className="text-2xl font-bold text-gray-800 dark:text-white mb-2">{t.successTitle}</h3>
                        <p className="text-gray-500 mb-6">{t.successDesc}</p>
                        <button onClick={onBack} className="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg font-bold hover:bg-gray-200">{t.backButton}</button>
                    </div>
                )
            }

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} />
                    <div className="bg-white dark:bg-dark-card p-6 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm">
                        <div className="space-y-5">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">{t.typeLabel}</label>
                                <div className="relative">
                                    <select 
                                        className="w-full p-3 pr-10 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none appearance-none text-gray-700 dark:text-gray-200"
                                        value={actionType}
                                        onChange={(e) => setActionType(e.target.value)}
                                    >
                                        <option value="" disabled>{t.defaultOption}</option>
                                        <option value="apology">{t.options.apology}</option>
                                        <option value="postpone">{t.options.postpone}</option>
                                        <option value="reenroll">{t.options.reenroll}</option>
                                        <option value="chance">{t.options.chance}</option>
                                    </select>
                                    <ChevronDown className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" size={18}/>
                                </div>
                            </div>

                            {actionType === 'apology' && (
                                <div className="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-xl border border-yellow-100 dark:border-yellow-800 text-sm text-yellow-800 dark:text-yellow-200 flex gap-2">
                                    <AlertCircle size={18} className="shrink-0"/>
                                    <p>{t.warningApology}</p>
                                </div>
                            )}

                            <div>
                                <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">{t.justificationLabel}</label>
                                <textarea className="w-full p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none h-32" placeholder={t.justificationPlaceholder}></textarea>
                            </div>

                            <div>
                                <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">{t.attachmentsLabel}</label>
                                <div className="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-6 text-center hover:border-primary transition cursor-pointer bg-gray-50 dark:bg-gray-800/50">
                                    <Upload className="mx-auto text-gray-400 mb-2" size={24}/>
                                    <span className="text-sm text-gray-500">{t.uploadText}</span>
                                </div>
                            </div>

                            <button 
                                onClick={() => setSubmitted(true)} 
                                disabled={!actionType}
                                className={`w-full font-bold py-3 rounded-xl transition shadow-lg ${!actionType ? 'bg-gray-300 text-gray-500 cursor-not-allowed shadow-none' : 'bg-primary text-white hover:bg-teal-700 shadow-primary/20'}`}
                            >
                                {t.submitButton}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 12. ÿπÿ±ÿ∂ ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ© (ÿ¨ÿØŸäÿØ)
        const ViewAcademicActionsPage = ({ onBack, lang }) => {
            const isAr = lang === 'ar';
            
            const t = {
                title: isAr ? "ÿπÿ±ÿ∂ ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ©" : "View Academic Actions",
                noActions: isAr ? "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ÿ±ŸÉÿßÿ™ ÿ£ŸÉÿßÿØŸäŸÖŸäÿ© ÿ≥ÿßÿ®ŸÇÿ©" : "No previous academic actions found",
                reqId: isAr ? "ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®:" : "Req ID:",
                note: isAr ? "ŸÖŸÑÿßÿ≠ÿ∏ÿ©:" : "Note:",
                status: {
                    approved: isAr ? "ŸÖŸÇÿ®ŸàŸÑ" : "Approved",
                    rejected: isAr ? "ŸÖÿ±ŸÅŸàÿ∂" : "Rejected",
                    pending: isAr ? "ŸÇŸäÿØ ÿßŸÑÿØÿ±ÿßÿ≥ÿ©" : "Pending"
                }
            };

            const actions = [
                { id: 2055, type: isAr ? 'ÿßÿπÿ™ÿ∞ÿßÿ± ÿπŸÜ ŸÅÿµŸÑ' : 'Semester Apology', term: isAr ? 'ÿßŸÑŸÅÿµŸÑ ÿßŸÑÿ´ÿßŸÜŸä 1444' : '2nd Semester 1444', status: 'approved', date: '2023-01-15' },
                { id: 1089, type: isAr ? 'ÿ™ÿ£ÿ¨ŸäŸÑ ÿØÿ±ÿßÿ≥ÿ©' : 'Study Postponement', term: isAr ? 'ÿßŸÑŸÅÿµŸÑ ÿßŸÑÿ£ŸàŸÑ 1444' : '1st Semester 1444', status: 'rejected', date: '2022-09-01', note: isAr ? 'ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑÿ≠ÿØ ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠ ŸÑŸÑÿ™ÿ£ÿ¨ŸäŸÑ' : 'Exceeded postponement limit' },
            ];

            const getStatusBadge = (status) => {
                const label = t.status[status];
                if (status === 'approved') return <span className="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><Check size={12}/> {label}</span>;
                if (status === 'rejected') return <span className="bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><X size={12}/> {label}</span>;
                return <span className="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><Clock size={12}/> {label}</span>;
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} />
                    {actions.length === 0 ? (
                        <div className="text-center py-10 text-gray-500">{t.noActions}</div>
                    ) : (
                        <div className="space-y-4">
                            {actions.map(action => (
                                <div key={action.id} className="bg-white dark:bg-dark-card p-5 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <h4 className="font-bold text-gray-800 dark:text-white text-lg">{action.type}</h4>
                                            <p className="text-sm text-gray-500">{action.term}</p>
                                        </div>
                                        {getStatusBadge(action.status)}
                                    </div>
                                    <div className="border-t border-gray-100 dark:border-gray-700 pt-3 flex flex-col gap-2">
                                        <div className="flex justify-between text-xs text-gray-400">
                                            <span>{t.reqId} #{action.id}</span>
                                            <span>{action.date}</span>
                                        </div>
                                        {action.note && <p className="text-xs text-red-500 bg-red-50 dark:bg-red-900/20 p-2 rounded">{t.note} {action.note}</p>}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // 13. ÿ∑ŸÑÿ® ÿ™ÿ∫ŸäŸäÿ± ÿ™ÿÆÿµÿµ (ÿ¨ÿØŸäÿØ)
        const MajorChangeRequestPage = ({ onBack, lang }) => {
            const [submitted, setSubmitted] = useState(false);
            const isAr = lang === 'ar';

            const t = {
                title: isAr ? "ÿ∑ŸÑÿ® ÿ™ÿ∫ŸäŸäÿ± ÿ™ÿÆÿµÿµ" : "Request Major Change",
                currentMajor: isAr ? "ÿßŸÑÿ™ÿÆÿµÿµ ÿßŸÑÿ≠ÿßŸÑŸä" : "Current Major",
                currentMajorVal: isAr ? "ŸáŸÜÿØÿ≥ÿ© ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™" : "Software Engineering",
                gpa: isAr ? "ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä" : "GPA",
                sectionTitle: isAr ? "ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ" : "Transfer Details",
                targetCollege: isAr ? "ÿßŸÑŸÉŸÑŸäÿ© ÿßŸÑŸÖÿ±ÿßÿØ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸäŸáÿß" : "Target College",
                targetMajor: isAr ? "ÿßŸÑÿ™ÿÆÿµÿµ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®" : "Target Major",
                note: isAr ? "Ÿäÿ¨ÿ® ÿ£ŸÑÿß ŸäŸÇŸÑ ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä ÿπŸÜ 3.50 ŸÑŸÑÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸâ ÿπŸÑŸàŸÖ ÿßŸÑÿ≠ÿßÿ≥ÿ®." : "GPA must be at least 3.50 for Computer Science transfer.",
                submit: isAr ? "ÿ™ŸÇÿØŸäŸÖ ÿ∑ŸÑÿ® ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ" : "Submit Transfer Request",
                successTitle: isAr ? "ÿ™ŸÖ ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿ∑ŸÑÿ® ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ" : "Transfer Request Received",
                successDesc: isAr ? "ŸäŸÖŸÉŸÜŸÉ ŸÖÿ™ÿßÿ®ÿπÿ© ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ® ŸÖŸÜ ÿµŸÅÿ≠ÿ© \"ÿπÿ±ÿ∂ ÿ∑ŸÑÿ®ÿßÿ™ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ™ÿÆÿµÿµ\"" : "You can track the request status from 'View Major Change Requests' page",
                back: isAr ? "ÿπŸàÿØÿ© ŸÑŸÑŸÇÿßÿ¶ŸÖÿ©" : "Back to Menu",
                colleges: [
                    isAr ? "ŸÉŸÑŸäÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä ŸàŸÜÿ∏ŸÖ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™" : "College of Computer & Info Systems",
                    isAr ? "ŸÉŸÑŸäÿ© ÿßŸÑŸáŸÜÿØÿ≥ÿ© ŸàÿßŸÑÿπŸÖÿßÿ±ÿ© ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ©" : "College of Engineering & Islamic Arch",
                    isAr ? "ŸÉŸÑŸäÿ© ÿßŸÑÿπŸÑŸàŸÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸäÿ©" : "College of Applied Sciences"
                ],
                majors: [
                    isAr ? "ÿπŸÑŸàŸÖ ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä" : "Computer Science",
                    isAr ? "ŸÜÿ∏ŸÖ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™" : "Information Systems",
                    isAr ? "ŸáŸÜÿØÿ≥ÿ© ÿ≠ÿßÿ≥ÿ® ÿ¢ŸÑŸä" : "Computer Engineering"
                ]
            };
            
            if(submitted) {
                return (
                    <div className="animate-fade-in text-center py-20">
                        <div className="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6"><Check size={40}/></div>
                        <h3 className="text-2xl font-bold text-gray-800 dark:text-white mb-2">{t.successTitle}</h3>
                        <p className="text-gray-500 mb-6">{t.successDesc}</p>
                        <button onClick={onBack} className="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg font-bold hover:bg-gray-200">{t.back}</button>
                    </div>
                )
            }

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} />
                    
                    {/* ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ≠ÿßŸÑŸäÿ© */}
                    <div className="bg-primary/5 border border-primary/10 p-4 rounded-xl flex justify-between items-center">
                        <div>
                            <p className="text-xs text-gray-500 mb-1">{t.currentMajor}</p>
                            <p className="font-bold text-primary">{t.currentMajorVal}</p>
                        </div>
                        <div className="text-left">
                            <p className="text-xs text-gray-500 mb-1">{t.gpa}</p>
                            <p className="font-bold text-gray-800 dark:text-white font-mono">3.35</p>
                        </div>
                    </div>

                    <div className="bg-white dark:bg-dark-card p-6 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm space-y-5">
                        <h3 className="font-bold border-b border-gray-100 dark:border-gray-700 pb-2">{t.sectionTitle}</h3>
                        
                        <div>
                            <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">{t.targetCollege}</label>
                            <div className="relative">
                                <select className="w-full p-3 pr-10 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none appearance-none text-gray-700 dark:text-gray-200">
                                    {t.colleges.map((c, i) => <option key={i}>{c}</option>)}
                                </select>
                                <ChevronDown className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" size={18}/>
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">{t.targetMajor}</label>
                            <div className="relative">
                                <select className="w-full p-3 pr-10 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:border-primary outline-none appearance-none text-gray-700 dark:text-gray-200">
                                    {t.majors.map((m, i) => <option key={i}>{m}</option>)}
                                </select>
                                <ChevronDown className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" size={18}/>
                            </div>
                        </div>

                        <div className="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg text-xs text-blue-700 dark:text-blue-300">
                            {t.note}
                        </div>

                        <button onClick={() => setSubmitted(true)} className="w-full bg-primary text-white font-bold py-3 rounded-xl hover:bg-teal-700 transition shadow-lg shadow-primary/20">
                            {t.submit}
                        </button>
                    </div>
                </div>
            );
        };

        // 14. ÿπÿ±ÿ∂ ÿ∑ŸÑÿ®ÿßÿ™ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ™ÿÆÿµÿµ (ÿ¨ÿØŸäÿØ)
        const ViewMajorChangeRequestsPage = ({ onBack, lang }) => {
            const isAr = lang === 'ar';
            
            const t = {
                title: isAr ? "ÿ∑ŸÑÿ®ÿßÿ™ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ™ÿÆÿµÿµ" : "Major Change Requests",
                transferTo: isAr ? "ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸâ" : "Transfer to",
                reqDate: isAr ? "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ŸÑÿ®:" : "Req Date:",
                statusLabel: isAr ? "ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®:" : "Status Note:",
                status: {
                    approved: isAr ? "ŸÖŸÇÿ®ŸàŸÑ" : "Approved",
                    rejected: isAr ? "ŸÖÿ±ŸÅŸàÿ∂" : "Rejected",
                    pending: isAr ? "ŸÇŸäÿØ ÿßŸÑÿØÿ±ÿßÿ≥ÿ©" : "Pending"
                }
            };

            const requests = [
                { id: 9901, target: isAr ? 'ÿπŸÑŸàŸÖ ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä' : 'Computer Science', date: '2023-05-10', status: 'pending', note: isAr ? 'ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ± ŸÖŸàÿßŸÅŸÇÿ© ÿπŸÖŸäÿØ ÿßŸÑŸÉŸÑŸäÿ©' : 'Awaiting Dean approval' },
                { id: 8820, target: isAr ? 'ÿ£ŸÖŸÜ ÿ≥Ÿäÿ®ÿ±ÿßŸÜŸä' : 'Cybersecurity', date: '2022-12-01', status: 'rejected', note: isAr ? 'ÿßŸÑŸÖÿπÿØŸÑ ŸÑÿß Ÿäÿ≥ÿ™ŸàŸÅŸä ÿßŸÑÿ¥ÿ±Ÿàÿ∑' : 'GPA does not meet requirements' }
            ];

            const getStatusBadge = (status) => {
                const label = t.status[status];
                if (status === 'approved') return <span className="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><Check size={12}/> {label}</span>;
                if (status === 'rejected') return <span className="bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><X size={12}/> {label}</span>;
                return <span className="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs font-bold flex items-center gap-1 w-fit"><Clock size={12}/> {label}</span>;
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} />
                    <div className="space-y-4">
                        {requests.map(req => (
                            <div key={req.id} className="bg-white dark:bg-dark-card p-5 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
                                <div className="flex justify-between items-start mb-2">
                                    <div>
                                        <div className="text-xs text-gray-400 mb-1">{t.transferTo}</div>
                                        <h4 className="font-bold text-gray-800 dark:text-white text-lg">{req.target}</h4>
                                    </div>
                                    {getStatusBadge(req.status)}
                                </div>
                                <div className="border-t border-gray-100 dark:border-gray-700 mt-3 pt-3">
                                    <div className="flex justify-between text-xs text-gray-500 mb-2">
                                        <span>{t.reqDate} {req.date}</span>
                                        <span>#{req.id}</span>
                                    </div>
                                    {req.note && <div className="bg-gray-50 dark:bg-gray-800 p-2 rounded text-xs text-gray-600 dark:text-gray-300">{t.statusLabel} {req.note}</div>}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // 15. ÿßŸÑÿßŸÜÿ≥ÿ≠ÿßÿ® ŸÖŸÜ ŸÖŸÇÿ±ÿ±
        const WithdrawPage = ({ onBack, lang }) => {
            const isAr = lang === 'ar';
            
            const t = {
                title: isAr ? "ÿßŸÑÿßŸÜÿ≥ÿ≠ÿßÿ® ŸÖŸÜ ŸÖŸÇÿ±ÿ±" : "Course Withdrawal",
                warning: isAr ? "ÿ™ŸÜÿ®ŸäŸá: ÿßŸÑÿßŸÜÿ≥ÿ≠ÿßÿ® ŸÖŸÜ ÿßŸÑŸÖŸÇÿ±ÿ± ÿ≥Ÿäÿ§ÿØŸä ÿ•ŸÑŸâ ÿ±ÿµÿØ ÿ™ŸÇÿØŸäÿ± (ÿπ) ŸÅŸä ÿ≥ÿ¨ŸÑŸÉ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä ŸàŸÑŸÜ ŸäÿØÿÆŸÑ ŸÅŸä ÿßÿ≠ÿ™ÿ≥ÿßÿ® ÿßŸÑŸÖÿπÿØŸÑÿå ŸàŸÑŸÉŸÜ ÿ≥ÿ™ÿ≠ÿ≥ÿ® ÿßŸÑÿ≥ÿßÿπÿßÿ™ ÿ∂ŸÖŸÜ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠ ÿ®Ÿá." 
                              : "Warning: Course withdrawal will result in a (W) grade in your academic record. It will not affect your GPA but will count towards the maximum allowed hours.",
                withdrawBtn: isAr ? "ÿßŸÜÿ≥ÿ≠ÿßÿ®" : "Withdraw",
                confirmPre: isAr ? "ÿ≥Ÿäÿ™ŸÖ ÿ±ÿµÿØ ÿ™ŸÇÿØŸäÿ± (ÿπ) ŸÑŸÖŸÇÿ±ÿ±" : "A grade of (W) will be recorded for course",
                confirmPost: isAr ? ". ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØÿü" : ". Are you sure?"
            };

            const courses = [
                { code: 'CS101', nameAr: 'ŸÖŸÇÿØŸÖÿ© ŸÅŸä ÿßŸÑÿ®ÿ±ŸÖÿ¨ÿ©', nameEn: 'Intro to Programming' },
                { code: 'MATH101', nameAr: 'ÿ™ŸÅÿßÿ∂ŸÑ Ÿàÿ™ŸÉÿßŸÖŸÑ', nameEn: 'Calculus' }
            ];
            
            const handleWithdraw = (c) => {
                const name = isAr ? c.nameAr : c.nameEn;
                alert(`${t.confirmPre} ${name}${t.confirmPost}`);
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.title} onBack={onBack} lang={lang} />
                    <div className="bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-800 p-4 rounded-xl flex gap-3">
                        <AlertTriangle className="text-red-600 shrink-0"/>
                        <p className="text-sm text-red-700 dark:text-red-200">{t.warning}</p>
                    </div>
                    
                    <div className="space-y-3">
                        {courses.map((c, i) => (
                            <div key={i} className="bg-white dark:bg-dark-card p-4 rounded-xl border border-gray-200 dark:border-gray-700 flex justify-between items-center shadow-sm">
                                <div>
                                    <h4 className="font-bold text-gray-800 dark:text-white">{isAr ? c.nameAr : c.nameEn}</h4>
                                    <span className="text-xs font-mono text-gray-500">{c.code}</span>
                                </div>
                                <button onClick={() => handleWithdraw(c)} className="bg-red-50 text-red-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-red-600 hover:text-white transition border border-red-100">{t.withdrawBtn}</button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // 16. ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸÖÿπ Stepper
        const RegistrationPage = ({ onBack, lang }) => {
            const steps = [
                { id: 1, label: 'ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', status: 'completed' },
                { id: 2, label: 'ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ±ÿ∫ÿ®ÿßÿ™', status: 'current' },
                { id: 3, label: 'ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ¨ÿØŸàŸÑ', status: 'pending' },
                { id: 4, label: 'ÿ∑ÿ®ÿßÿπÿ©', status: 'pending' }
            ];

            // ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ (ÿ®ÿØÿ°ÿßŸã ŸÖŸÜ 2 ŸäŸàŸÖ Ÿà 14 ÿ≥ÿßÿπÿ© ŸÉŸÖÿ´ÿßŸÑ)
            const [timeLeft, setTimeLeft] = useState({ days: 2, hours: 14, minutes: 30, seconds: 59 });

            useEffect(() => {
                const timer = setInterval(() => {
                    setTimeLeft(prev => {
                        if (prev.seconds > 0) return { ...prev, seconds: prev.seconds - 1 };
                        if (prev.minutes > 0) return { ...prev, minutes: prev.minutes - 1, seconds: 59 };
                        if (prev.hours > 0) return { ...prev, hours: prev.hours - 1, minutes: 59, seconds: 59 };
                        if (prev.days > 0) return { ...prev, days: prev.days - 1, hours: 23, minutes: 59, seconds: 59 };
                        return prev; // ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™
                    });
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä" onBack={onBack} lang={lang} />

                    {/* ÿπÿØÿßÿØ ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä */}
                    <div className="bg-gradient-to-l from-primary to-teal-800 rounded-2xl p-6 text-white shadow-lg flex flex-col md:flex-row items-center justify-between gap-6 relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                        
                        <div className="relative z-10 text-center md:text-right">
                            <h3 className="text-xl font-bold mb-1 flex items-center justify-center md:justify-start gap-2">
                                <Clock className="animate-pulse" size={24}/> ŸäŸÜÿ™ŸáŸä ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆŸÑÿßŸÑ
                            </h3>
                            <p className="text-teal-100 text-sm opacity-90">ÿ®ÿßÿØÿ± ÿ®ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖŸÇÿ±ÿ±ÿßÿ™ŸÉ ŸÇÿ®ŸÑ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©</p>
                        </div>

                        <div className="relative z-10 flex gap-4">
                            {/* ÿßŸÑÿ£ŸäÿßŸÖ (ŸäŸÖŸäŸÜ ŸÑÿ£ŸÜ ÿßŸÑÿßÿ™ÿ¨ÿßŸá RTL) */}
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.days}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">ŸäŸàŸÖ</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.hours}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">ÿ≥ÿßÿπÿ©</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.minutes}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">ÿØŸÇŸäŸÇÿ©</span>
                            </div>
                            <div className="flex flex-col items-center bg-white/10 backdrop-blur-md rounded-lg p-3 min-w-[70px] border border-white/10 shadow-inner">
                                <span className="text-3xl font-bold font-mono">{timeLeft.seconds}</span>
                                <span className="text-[10px] uppercase text-teal-200 font-bold">ÿ´ÿßŸÜŸäÿ©</span>
                            </div>
                        </div>
                    </div>
                    
                    {/* Stepper */}
                    <div className="bg-white dark:bg-dark-card p-6 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700">
                        <div className="flex items-center justify-between relative">
                            <div className="absolute left-0 right-0 top-1/2 h-0.5 bg-gray-200 dark:bg-gray-700 -z-0"></div>
                            {steps.map((step, idx) => (
                                <div key={step.id} className="relative z-10 flex flex-col items-center bg-white dark:bg-dark-card px-2">
                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center border-2 text-sm font-bold transition-colors ${step.status === 'completed' ? 'bg-primary border-primary text-white' : step.status === 'current' ? 'border-primary text-primary' : 'border-gray-300 text-gray-300'}`}>
                                        {step.status === 'completed' ? <Check size={16}/> : step.id}
                                    </div>
                                    <span className={`text-xs mt-2 font-bold ${step.status === 'current' ? 'text-primary' : 'text-gray-500'}`}>{step.label}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800 flex gap-3">
                        <AlertCircle className="text-blue-600 shrink-0" />
                        <div>
                            <h4 className="font-bold text-blue-800 dark:text-blue-200 text-sm">ÿ™ŸÜÿ®ŸäŸá ŸáÿßŸÖ</h4>
                            <p className="text-xs text-blue-600 dark:text-blue-300 mt-1">Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ÿ™ÿπÿßÿ±ÿ∂ ŸÅŸä ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ© ŸÇÿ®ŸÑ ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ¨ÿØŸàŸÑ.</p>
                        </div>
                    </div>

                    <div className="text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-300">
                        <Layers size={48} className="mx-auto text-gray-300 mb-4"/>
                        <p className="text-gray-500 font-bold">ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖÿ™ÿßÿ≠ÿ© ÿ≠ÿßŸÑŸäÿßŸã ŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ±ÿ∫ÿ®ÿßÿ™</p>
                        <button className="mt-4 bg-primary text-white px-6 py-2 rounded-lg font-bold hover:bg-teal-700 transition">ÿßÿ®ÿØÿ£ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ</button>
                    </div>
                </div>
            );
        };

        // 17. ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ© (RequestsPage OLD - can be removed or kept as generic view)
        const RequestsPage = ({ onBack, lang }) => {
            const requests = [
                { id: 1023, type: 'ÿ•ÿπÿßÿØÿ© ŸÇŸäÿØ', date: '2023-12-01', status: 'pending', desc: 'ÿ∑ŸÑÿ® ÿ•ÿπÿßÿØÿ© ŸÇŸäÿØ ŸÑŸÑŸÅÿµŸÑ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä ÿßŸÑÿ´ÿßŸÜŸä' },
                { id: 1011, type: 'ÿ™ÿ∫ŸäŸäÿ± ÿ™ÿÆÿµÿµ', date: '2023-09-15', status: 'rejected', desc: 'ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ŸÖŸÜ ŸáŸÜÿØÿ≥ÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿ•ŸÑŸâ ŸáŸÜÿØÿ≥ÿ© ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™' },
                { id: 985, type: 'ÿßÿπÿ™ÿ∞ÿßÿ± ÿπŸÜ ŸÅÿµŸÑ', date: '2023-05-20', status: 'approved', desc: 'ÿßŸÑÿßÿπÿ™ÿ∞ÿßÿ± ÿπŸÜ ÿßŸÑŸÅÿµŸÑ ÿßŸÑÿµŸäŸÅŸä ŸÑÿ∏ÿ±ŸàŸÅ ÿµÿ≠Ÿäÿ©' },
            ];

            const getStatusChip = (status) => {
                switch(status) {
                    case 'approved': return <span className="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-bold flex items-center gap-1"><CheckCircle2 size={12}/> ŸÖŸÇÿ®ŸàŸÑ</span>;
                    case 'rejected': return <span className="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-bold flex items-center gap-1"><X size={12}/> ŸÖÿ±ŸÅŸàÿ∂</span>;
                    default: return <span className="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-bold flex items-center gap-1"><Clock size={12}/> ŸÇŸäÿØ ÿßŸÑÿØÿ±ÿßÿ≥ÿ©</span>;
                }
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ©" onBack={onBack} lang={lang} extra={<button className="bg-primary text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2"><PlusCircle size={16}/> ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ</button>} />
                    <div className="space-y-4">
                        {requests.map(req => (
                            <div key={req.id} className="bg-white dark:bg-dark-card p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition">
                                <div className="flex justify-between items-start mb-2">
                                    <div>
                                        <div className="flex items-center gap-2">
                                            <h3 className="font-bold text-gray-800 dark:text-white">{req.type}</h3>
                                            <span className="text-xs text-gray-400">#{req.id}</span>
                                        </div>
                                        <p className="text-sm text-gray-500 mt-1">{req.desc}</p>
                                    </div>
                                    {getStatusChip(req.status)}
                                </div>
                                <div className="border-t border-gray-100 dark:border-gray-700 mt-3 pt-3 flex justify-between items-center text-xs text-gray-400">
                                    <span>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ŸÑÿ®: {req.date}</span>
                                    <button className="text-primary font-bold hover:underline">ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        // 18. ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä (ŸÖÿ≠ÿØÿ´ ŸÑŸäÿ¥ŸÖŸÑ ŸÉÿßŸÅÿ© ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ ÿßŸÑÿ¨ÿØŸäÿØÿ©)
        const PersonalPage = ({ onBack, activeView, lang }) => {
            const isAr = lang === 'ar';
            const [imgSrc, setImgSrc] = useState(null);
            const [toast, setToast] = useState(null);
            const fileInputRef = useRef(null);

            const t = {
                titles: {
                    'id-photo': isAr ? 'ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿ¥ÿÆÿµŸäÿ©' : 'Personal Photo Upload',
                    'finance': isAr ? 'ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿßŸÑŸä' : 'Financial Record',
                    'rewards': isAr ? 'ÿ≥ÿ¨ŸÑ ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™' : 'Rewards Record',
                    'penalties': isAr ? 'ÿßŸÑÿπŸÇŸàÿ®ÿßÿ™' : 'Penalties & Violations',
                    'allowances': isAr ? 'ÿßŸÑÿ®ÿØŸÑÿßÿ™' : 'Allowances',
                    'docs': isAr ? 'ÿßŸÑŸàÿ´ÿßÿ¶ŸÇ ŸàÿßŸÑÿ•ŸÅÿßÿØÿßÿ™' : 'Documents & Certificates'
                },
                photo: {
                    title: isAr ? "ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿ¨ÿßŸÖÿπŸäÿ©" : "University Photo",
                    desc: isAr ? "Ÿäÿ±ÿ¨Ÿâ ÿ±ŸÅÿπ ÿµŸàÿ±ÿ© ŸÖŸÑŸàŸÜÿ© ÿ≠ÿØŸäÿ´ÿ© ÿ®ÿÆŸÑŸÅŸäÿ© ÿ®Ÿäÿ∂ÿßÿ°ÿå ÿ®ÿßŸÑÿ≤Ÿä ÿßŸÑÿ±ÿ≥ŸÖŸäÿå Ÿàÿ®ÿØŸàŸÜ ŸÅŸÑÿßÿ™ÿ± ÿ£Ÿà ÿ™ÿπÿØŸäŸÑÿßÿ™." : "Please upload a recent color photo with white background, in official attire, no filters.",
                    note: isAr ? "ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ÿßŸÑÿµŸàÿ±ÿ© ÿ≥ÿ™ÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸä ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿ¨ÿßŸÖÿπŸäÿ©." : "Note: Photo will be used for university ID.",
                    choose: isAr ? "ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸàÿ±ÿ©" : "Choose Photo",
                    delete: isAr ? "ÿ≠ÿ∞ŸÅ" : "Delete",
                    success: isAr ? "ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ© ÿ®ŸÜÿ¨ÿßÿ≠! ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿßÿπÿ™ŸÖÿßÿØ." : "Photo uploaded! Awaiting approval.",
                    deleted: isAr ? "ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿµŸàÿ±ÿ©" : "Photo deleted"
                },
                finance: {
                    total: isAr ? "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿ™ÿ≠ŸÇÿßÿ™" : "Total Due",
                    deductions: isAr ? "ÿßŸÑŸÖÿÆÿµŸàŸÖÿßÿ™" : "Deductions",
                    balance: isAr ? "ÿßŸÑÿ±ÿµŸäÿØ ÿßŸÑŸÖÿ≠ŸàŸÑ" : "Transferred Balance",
                    item: isAr ? "ÿßŸÑÿ®ŸÜÿØ" : "Item",
                    month: isAr ? "ÿßŸÑÿ¥Ÿáÿ±" : "Month",
                    amount: isAr ? "ÿßŸÑŸÖÿ®ŸÑÿ∫" : "Amount",
                    status: isAr ? "ÿßŸÑÿ≠ÿßŸÑÿ©" : "Status",
                    stipend: isAr ? "ŸÖŸÉÿßŸÅÿ£ÿ© ÿ¥Ÿáÿ±Ÿäÿ©" : "Monthly Stipend",
                    housingDed: isAr ? "ÿÆÿµŸÖ (ÿ∫Ÿäÿßÿ® ÿ≥ŸÉŸÜ)" : "Deduction (Housing)",
                    transferred: isAr ? "ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ" : "Transferred",
                    deducted: isAr ? "ŸÖÿÆÿµŸàŸÖ" : "Deducted"
                },
                rewards: {
                    total: isAr ? "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™ ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖÿ©" : "Total Rewards Received",
                    since: isAr ? "ŸÖŸÜÿ∞ ÿßŸÑÿßŸÑÿ™ÿ≠ÿßŸÇ ÿ®ÿßŸÑÿ¨ÿßŸÖÿπÿ©" : "Since joining",
                    type: isAr ? "ŸÜŸàÿπ ÿßŸÑŸÖŸÉÿßŸÅÿ£ÿ©" : "Reward Type",
                    month: isAr ? "ÿßŸÑÿ¥Ÿáÿ± / ÿßŸÑÿ≥ŸÜÿ©" : "Month / Year",
                    value: isAr ? "ÿßŸÑŸÇŸäŸÖÿ©" : "Value",
                    date: isAr ? "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßÿ≥ÿ™ÿ≠ŸÇÿßŸÇ" : "Due Date",
                    status: isAr ? "ÿßŸÑÿ≠ÿßŸÑÿ©" : "Status",
                    stipend: isAr ? "ŸÖŸÉÿßŸÅÿ£ÿ© ÿ¥Ÿáÿ±Ÿäÿ©" : "Monthly Stipend",
                    excellence: isAr ? "ŸÖŸÉÿßŸÅÿ£ÿ© ÿ™ŸÅŸàŸÇ" : "Excellence Reward",
                    deposited: isAr ? "ÿ™ŸÖ ÿßŸÑÿ•ŸäÿØÿßÿπ" : "Deposited"
                },
                penalties: {
                    cleanTitle: isAr ? "ÿ≥ÿ¨ŸÑŸÉ ŸÜÿ∏ŸäŸÅ!" : "Your record is clean!",
                    cleanDesc: isAr ? "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿπŸÑŸäŸÉ ÿ£Ÿä ÿπŸÇŸàÿ®ÿßÿ™ ÿ£Ÿà ŸÖÿÆÿßŸÑŸÅÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ©." : "No penalties or violations recorded.",
                    archive: isAr ? "ÿ£ÿ±ÿ¥ŸäŸÅ ÿßŸÑŸÖÿÆÿßŸÑŸÅÿßÿ™ (ŸÖÿ´ÿßŸÑ)" : "Violations Archive (Example)",
                    violation: isAr ? "ÿßŸÑŸÖÿÆÿßŸÑŸÅÿ©" : "Violation",
                    penalty: isAr ? "ÿßŸÑÿπŸÇŸàÿ®ÿ©" : "Penalty",
                    date: isAr ? "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ" : "Date"
                },
                allowances: {
                    type: isAr ? "ŸÜŸàÿπ ÿßŸÑÿ®ÿØŸÑ" : "Allowance Type",
                    amount: isAr ? "ÿßŸÑŸÖÿ®ŸÑÿ∫" : "Amount",
                    date: isAr ? "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿµÿ±ŸÅ" : "Disbursement Date",
                    status: isAr ? "ÿßŸÑÿ≠ÿßŸÑÿ©" : "Status",
                    books: isAr ? "ÿ®ÿØŸÑ ŸÉÿ™ÿ® ŸàŸÖÿ±ÿßÿ¨ÿπ" : "Books & References Allowance",
                    tools: isAr ? "ÿ®ÿØŸÑ ÿ£ÿØŸàÿßÿ™ ÿπŸÑŸÖŸäÿ©" : "Scientific Tools Allowance",
                    thesis: isAr ? "ÿ®ÿØŸÑ ÿ∑ÿ®ÿßÿπÿ© ÿ±ÿ≥ÿßŸÑÿ©" : "Thesis Printing Allowance",
                    disbursed: isAr ? "ÿµŸèÿ±ŸÅÿ™" : "Disbursed",
                    notEligible: isAr ? "ÿ∫Ÿäÿ± ŸÖÿ≥ÿ™ÿ≠ŸÇ" : "Not Eligible"
                },
                docs: {
                    enrollment: isAr ? "ÿ•ŸÅÿßÿØÿ© ÿßŸÜÿ™ÿ∏ÿßŸÖ" : "Enrollment Certificate",
                    enrollmentDesc: isAr ? "ŸÖŸàÿ¨Ÿáÿ© ŸÑŸÑÿ¨Ÿáÿßÿ™ ÿßŸÑÿ≠ŸÉŸàŸÖŸäÿ© ŸàÿßŸÑÿÆÿßÿµÿ©" : "For government/private entities",
                    record: isAr ? "ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä" : "Academic Record",
                    recordDesc: isAr ? "ŸÜÿ≥ÿÆÿ© ÿ±ÿ≥ŸÖŸäÿ© (ÿπÿ±ÿ®Ÿä/ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿä)" : "Official Copy (Ar/En)",
                    stipend: isAr ? "ŸÖÿ¥ŸáÿØ ŸÖŸÉÿßŸÅÿ£ÿ©" : "Stipend Certificate",
                    stipendDesc: isAr ? "ÿ™ÿπÿ±ŸäŸÅ ÿ®ÿßŸÑÿ±ÿßÿ™ÿ® ŸàÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™" : "Salary/Stipend Definition"
                }
            };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const url = URL.createObjectURL(file);
                    setImgSrc(url);
                    setToast({ type: 'success', message: t.photo.success });
                    setTimeout(() => setToast(null), 3000);
                }
            };

            const translateMonth = (txt) => {
                if(isAr) return txt;
                const map = {
                    'ÿ¥ŸàÿßŸÑ': 'Shawwal', 'ÿ±ŸÖÿ∂ÿßŸÜ': 'Ramadan', 'ÿ¥ÿπÿ®ÿßŸÜ': 'Sha\'ban', 'ÿ±ÿ¨ÿ®': 'Rajab',
                    'ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ¢ÿÆÿ±ÿ©': 'Jumada II', 'ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ£ŸàŸÑŸâ': 'Jumada I', 'ÿ±ÿ®Ÿäÿπ ÿßŸÑÿ´ÿßŸÜŸä': 'Rabi\' II',
                    'ÿ±ÿ®Ÿäÿπ ÿßŸÑÿ£ŸàŸÑ': 'Rabi\' I', 'ÿµŸÅÿ±': 'Safar', 'ŸÖÿ≠ÿ±ŸÖ': 'Muharram', 'ÿ∞Ÿà ÿßŸÑÿ≠ÿ¨ÿ©': 'Dhu al-Hijjah', 'ÿ∞Ÿà ÿßŸÑŸÇÿπÿØÿ©': 'Dhu al-Qi\'dah'
                };
                let parts = txt.split(' ');
                if(parts.length > 1 && map[parts[0]]) return `${map[parts[0]]} ${parts[1]}`;
                return txt;
            }

            // ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™ ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ©
            const rewardsHistory = [
                { id: 1, type: 'monthly', month: 'ÿ¥ŸàÿßŸÑ 1445', amount: '990', status: 'deposited', date: '1445/10/25', isBonus: false },
                { id: 2, type: 'monthly', month: 'ÿ±ŸÖÿ∂ÿßŸÜ 1445', amount: '990', status: 'deposited', date: '1445/09/25', isBonus: false },
                { id: 3, type: 'monthly', month: 'ÿ¥ÿπÿ®ÿßŸÜ 1445', amount: '990', status: 'deposited', date: '1445/08/25', isBonus: false },
                { id: 4, type: 'monthly', month: 'ÿ±ÿ¨ÿ® 1445', amount: '990', status: 'deposited', date: '1445/07/25', isBonus: false },
                { id: 5, type: 'monthly', month: 'ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ¢ÿÆÿ±ÿ© 1445', amount: '990', status: 'deposited', date: '1445/06/25', isBonus: false },
                { id: 6, type: 'monthly', month: 'ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ£ŸàŸÑŸâ 1445', amount: '990', status: 'deposited', date: '1445/05/25', isBonus: false },
                { id: 7, type: 'monthly', month: 'ÿ±ÿ®Ÿäÿπ ÿßŸÑÿ´ÿßŸÜŸä 1445', amount: '990', status: 'deposited', date: '1445/04/25', isBonus: false },
                { id: 8, type: 'monthly', month: 'ÿ±ÿ®Ÿäÿπ ÿßŸÑÿ£ŸàŸÑ 1445', amount: '990', status: 'deposited', date: '1445/03/25', isBonus: false },
                { id: 9, type: 'monthly', month: 'ÿµŸÅÿ± 1445', amount: '990', status: 'deposited', date: '1445/02/25', isBonus: false },
                { id: 10, type: 'monthly', month: 'ŸÖÿ≠ÿ±ŸÖ 1445', amount: '990', status: 'deposited', date: '1445/01/25', isBonus: false },
                // ÿ≥ŸÜÿ© 1444
                { id: 11, type: 'excellence', month: 'ÿ∞Ÿà ÿßŸÑÿ≠ÿ¨ÿ© 1444', amount: '1000', status: 'deposited', date: '1444/12/20', isBonus: true },
                { id: 12, type: 'monthly', month: 'ÿ∞Ÿà ÿßŸÑÿ≠ÿ¨ÿ© 1444', amount: '990', status: 'deposited', date: '1444/12/25', isBonus: false },
                { id: 13, type: 'monthly', month: 'ÿ∞Ÿà ÿßŸÑŸÇÿπÿØÿ© 1444', amount: '990', status: 'deposited', date: '1444/11/25', isBonus: false },
                { id: 14, type: 'monthly', month: 'ÿ¥ŸàÿßŸÑ 1444', amount: '990', status: 'deposited', date: '1444/10/25', isBonus: false },
                { id: 15, type: 'monthly', month: 'ÿ±ŸÖÿ∂ÿßŸÜ 1444', amount: '990', status: 'deposited', date: '1444/09/25', isBonus: false },
                { id: 16, type: 'monthly', month: 'ÿ¥ÿπÿ®ÿßŸÜ 1444', amount: '990', status: 'deposited', date: '1444/08/25', isBonus: false },
                { id: 17, type: 'monthly', month: 'ÿ±ÿ¨ÿ® 1444', amount: '990', status: 'deposited', date: '1444/07/25', isBonus: false },
                { id: 18, type: 'monthly', month: 'ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ¢ÿÆÿ±ÿ© 1444', amount: '990', status: 'deposited', date: '1444/06/25', isBonus: false },
                { id: 19, type: 'monthly', month: 'ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ£ŸàŸÑŸâ 1444', amount: '990', status: 'deposited', date: '1444/05/25', isBonus: false },
                { id: 20, type: 'monthly', month: 'ÿ±ÿ®Ÿäÿπ ÿßŸÑÿ´ÿßŸÜŸä 1444', amount: '990', status: 'deposited', date: '1444/04/25', isBonus: false },
                { id: 21, type: 'monthly', month: 'ÿ±ÿ®Ÿäÿπ ÿßŸÑÿ£ŸàŸÑ 1444', amount: '990', status: 'deposited', date: '1444/03/25', isBonus: false },
            ];

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title={t.titles[activeView]} onBack={onBack} lang={lang} />
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}

                    {/* 1. ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿ¥ÿÆÿµŸäÿ© */}
                    {activeView === 'id-photo' && (
                        <div className="bg-white dark:bg-dark-card p-8 rounded-2xl border border-gray-200 dark:border-gray-700 text-center shadow-sm">
                            <div className="relative w-40 h-40 mx-auto mb-6 group">
                                <div className="w-full h-full rounded-full overflow-hidden border-4 border-gray-100 dark:border-gray-700 shadow-inner bg-gray-50 dark:bg-gray-800">
                                    {imgSrc ? <img src={imgSrc} alt="Profile" className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-gray-300"><User size={64}/></div>}
                                </div>
                                <button onClick={() => fileInputRef.current.click()} className="absolute bottom-2 right-2 p-3 bg-primary text-white rounded-full shadow-lg hover:scale-110 transition border-4 border-white dark:border-dark-card"><Camera size={20}/></button>
                                <input type="file" ref={fileInputRef} onChange={handleFileChange} className="hidden" accept="image/*"/>
                            </div>
                            <h3 className="font-bold text-xl text-gray-800 dark:text-white">{t.photo.title}</h3>
                            <p className="text-sm text-gray-500 mt-2 max-w-md mx-auto leading-relaxed">
                                {t.photo.desc}
                                <br/><span className="text-xs text-red-500">{t.photo.note}</span>
                            </p>
                            <div className="mt-8 flex justify-center gap-3">
                                <button onClick={() => fileInputRef.current.click()} className="px-6 py-2.5 bg-primary text-white rounded-xl font-bold hover:bg-teal-700 transition flex items-center gap-2 shadow-lg shadow-primary/20"><Upload size={18}/> {t.photo.choose}</button>
                                {imgSrc && <button onClick={() => {setImgSrc(null); setToast({type:'error', message:t.photo.deleted}); setTimeout(()=>setToast(null),3000)}} className="px-6 py-2.5 bg-red-50 text-red-600 rounded-xl font-bold hover:bg-red-100 transition">{t.photo.delete}</button>}
                            </div>
                        </div>
                    )}

                    {/* 2. ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿßŸÑŸä (ÿ¥ÿßŸÖŸÑ) */}
                    {activeView === 'finance' && (
                        <div className="space-y-6">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div className="bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-xl border border-emerald-100 dark:border-emerald-800">
                                    <span className="text-emerald-600 dark:text-emerald-400 text-xs font-bold">{t.finance.total}</span>
                                    <div className="text-2xl font-bold text-emerald-800 dark:text-emerald-200 mt-1 font-mono">21,790 SAR</div>
                                </div>
                                <div className="bg-red-50 dark:bg-red-900/20 p-4 rounded-xl border border-red-100 dark:border-red-800">
                                    <span className="text-red-600 dark:text-red-400 text-xs font-bold">{t.finance.deductions}</span>
                                    <div className="2xl font-bold text-red-800 dark:text-red-200 mt-1 font-mono">-50 SAR</div>
                                </div>
                                <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800">
                                    <span className="text-blue-600 dark:text-blue-400 text-xs font-bold">{t.finance.balance}</span>
                                    <div className="2xl font-bold text-blue-800 dark:text-blue-200 mt-1 font-mono">21,740 SAR</div>
                                </div>
                            </div>

                            <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm">
                                 <table className="w-full text-right text-sm">
                                    <thead className="bg-gray-50 dark:bg-gray-800/50 text-gray-500 font-medium text-xs uppercase">
                                        <tr><th className="p-4">{t.finance.item}</th><th className="p-4">{t.finance.month}</th><th className="p-4">{t.finance.amount}</th><th className="p-4">{t.finance.status}</th></tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                        <tr><td className="p-4 font-bold text-gray-800 dark:text-gray-200">{t.finance.stipend}</td><td className="p-4 text-gray-500">{translateMonth("ÿ±ÿ¨ÿ® 1445")}</td><td className="p-4 font-mono font-bold text-gray-800 dark:text-white">990 SAR</td><td className="p-4"><span className="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold">{t.finance.transferred}</span></td></tr>
                                        <tr><td className="p-4 font-bold text-gray-800 dark:text-gray-200">{t.finance.stipend}</td><td className="p-4 text-gray-500">{translateMonth("ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ¢ÿÆÿ±ÿ© 1445")}</td><td className="p-4 font-mono font-bold text-gray-800 dark:text-white">990 SAR</td><td className="p-4"><span className="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold">{t.finance.transferred}</span></td></tr>
                                        <tr><td className="p-4 font-bold text-gray-800 dark:text-gray-200">{t.finance.housingDed}</td><td className="p-4 text-gray-500">{translateMonth("ÿ¨ŸÖÿßÿØŸâ ÿßŸÑÿ£ŸàŸÑŸâ 1445")}</td><td className="p-4 font-mono font-bold text-red-600">-50 SAR</td><td className="p-4"><span className="bg-gray-100 text-gray-600 px-2 py-1 rounded text-[10px] font-bold">{t.finance.deducted}</span></td></tr>
                                    </tbody>
                                 </table>
                            </div>
                        </div>
                    )}

                    {/* 3. ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™ (ÿ≥ÿ¨ŸÑ ÿ™ÿßÿ±ŸäÿÆŸä ŸÉÿßŸÖŸÑ) */}
                    {activeView === 'rewards' && (
                        <div className="space-y-4">
                            <div className="bg-gradient-to-br from-gold to-yellow-600 p-6 rounded-2xl text-white shadow-lg relative overflow-hidden flex justify-between items-center">
                                <div className="relative z-10">
                                    <h3 className="font-bold text-xl mb-1">{t.rewards.total}</h3>
                                    <p className="text-yellow-100 text-sm">{t.rewards.since}</p>
                                    <p className="text-3xl font-bold font-mono mt-2">21,790 SAR</p>
                                </div>
                                <div className="bg-white/20 p-4 rounded-full backdrop-blur-sm"><Coins size={36}/></div>
                            </div>
                            
                            <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm">
                                <div className="max-h-[500px] overflow-y-auto">
                                    <table className="w-full text-right text-sm">
                                        <thead className="bg-gray-50 dark:bg-gray-800/50 text-gray-500 font-medium sticky top-0 z-10">
                                            <tr><th className="p-4">{t.rewards.type}</th><th className="p-4">{t.rewards.month}</th><th className="p-4">{t.rewards.value}</th><th className="p-4">{t.rewards.date}</th><th className="p-4">{t.rewards.status}</th></tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                            {rewardsHistory.map((reward) => (
                                                <tr key={reward.id} className={reward.isBonus ? "bg-yellow-50/50 dark:bg-yellow-900/10" : "hover:bg-gray-50 dark:hover:bg-gray-800/50 transition"}>
                                                    <td className="p-4">
                                                        <div className="font-bold text-gray-800 dark:text-white flex items-center gap-2">
                                                            {reward.isBonus && <Award size={16} className="text-gold"/>}
                                                            {reward.type === 'monthly' ? t.rewards.stipend : t.rewards.excellence}
                                                        </div>
                                                    </td>
                                                    <td className="p-4 text-gray-600 dark:text-gray-400">{translateMonth(reward.month)}</td>
                                                    <td className={`p-4 font-mono font-bold ${reward.isBonus ? 'text-gold' : 'text-primary'}`}>{reward.amount} SAR</td>
                                                    <td className="p-4 font-mono text-gray-500 text-xs">{reward.date}</td>
                                                    <td className="p-4"><span className="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold">{reward.status === 'deposited' ? t.rewards.deposited : reward.status}</span></td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 4. ÿßŸÑÿπŸÇŸàÿ®ÿßÿ™ */}
                    {activeView === 'penalties' && (
                        <div className="space-y-6">
                            {/* ÿ≠ÿßŸÑÿ© ŸÜÿ∏ŸäŸÅÿ© */}
                            <div className="bg-white dark:bg-dark-card p-10 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm text-center">
                                <div className="w-20 h-20 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <ShieldAlert size={40}/>
                                </div>
                                <h3 className="xl font-bold text-gray-800 dark:text-white">{t.penalties.cleanTitle}</h3>
                                <p className="text-gray-500 mt-2">{t.penalties.cleanDesc}</p>
                            </div>

                            {/* ŸÖÿ´ÿßŸÑ ŸÑÿ¨ÿØŸàŸÑ ŸÅÿßÿ±ÿ∫ (ÿ£Ÿà ŸÖŸÖÿ™ŸÑÿ¶ ÿ•ÿ∞ÿß ÿ£ÿ±ÿØÿ™ ÿ•ÿ∏Ÿáÿßÿ± ÿπŸÇŸàÿ®ÿßÿ™) */}
                            <div className="opacity-50 pointer-events-none grayscale" aria-hidden="true">
                                <h4 className="text-sm font-bold text-gray-400 mb-2">{t.penalties.archive}</h4>
                                <div className="bg-white dark:bg-dark-card rounded-xl border border-gray-200 dark:border-gray-700 p-4">
                                    <table className="w-full text-right text-sm">
                                        <thead><tr><th className="pb-2">{t.penalties.violation}</th><th className="pb-2">{t.penalties.penalty}</th><th className="pb-2">{t.penalties.date}</th></tr></thead>
                                        <tbody><tr><td className="py-2">---</td><td>---</td><td>---</td></tr></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 5. ÿßŸÑÿ®ÿØŸÑÿßÿ™ */}
                    {activeView === 'allowances' && (
                        <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm">
                             <table className="w-full text-right text-sm">
                                <thead className="bg-gray-50 dark:bg-gray-800/50 text-gray-500 font-medium">
                                    <tr><th className="p-4">{t.allowances.type}</th><th className="p-4">{t.allowances.amount}</th><th className="p-4">{t.allowances.date}</th><th className="p-4">{t.allowances.status}</th></tr>
                                </thead>
                                <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
                                    <tr><td className="p-4 font-bold text-gray-800 dark:text-white">{t.allowances.books}</td><td className="p-4 font-bold text-primary font-mono">850 SAR</td><td className="p-4 font-mono">1445/01/15</td><td className="p-4"><span className="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold">{t.allowances.disbursed}</span></td></tr>
                                    <tr><td className="p-4 font-bold text-gray-800 dark:text-white">{t.allowances.tools}</td><td className="p-4 font-bold text-primary font-mono">400 SAR</td><td className="p-4 font-mono">1445/01/15</td><td className="p-4"><span className="bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold">{t.allowances.disbursed}</span></td></tr>
                                    <tr><td className="p-4 font-bold text-gray-800 dark:text-white">{t.allowances.thesis}</td><td className="p-4 font-bold text-gray-400 font-mono">--</td><td className="p-4 font-mono">--</td><td className="p-4"><span className="bg-gray-100 text-gray-500 px-2 py-1 rounded text-[10px] font-bold">{t.allowances.notEligible}</span></td></tr>
                                </tbody>
                             </table>
                        </div>
                    )}
                    
                    {/* 6. ÿßŸÑŸàÿ´ÿßÿ¶ŸÇ ŸàÿßŸÑÿ•ŸÅÿßÿØÿßÿ™ */}
                    {activeView === 'docs' && (
                        <div className="space-y-4">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="p-5 border border-gray-200 dark:border-gray-700 rounded-xl flex items-center justify-between bg-white dark:bg-dark-card hover:border-primary transition group shadow-sm">
                                    <div className="flex items-center gap-4">
                                        <div className="p-3 bg-blue-50 text-blue-600 rounded-lg group-hover:bg-blue-600 group-hover:text-white transition"><ScrollText size={24}/></div>
                                        <div><h4 className="font-bold text-gray-800 dark:text-white">{t.docs.enrollment}</h4><p className="text-xs text-gray-500">{t.docs.enrollmentDesc}</p></div>
                                    </div>
                                    <button className="text-primary hover:bg-primary/10 p-2 rounded-lg"><Printer size={20}/></button>
                                </div>
                                <div className="p-5 border border-gray-200 dark:border-gray-700 rounded-xl flex items-center justify-between bg-white dark:bg-dark-card hover:border-primary transition group shadow-sm">
                                    <div className="flex items-center gap-4">
                                        <div className="p-3 bg-purple-50 text-purple-600 rounded-lg group-hover:bg-purple-600 group-hover:text-white transition"><FileBadge size={24}/></div>
                                        <div><h4 className="font-bold text-gray-800 dark:text-white">{t.docs.record}</h4><p className="text-xs text-gray-500">{t.docs.recordDesc}</p></div>
                                    </div>
                                    <button className="text-primary hover:bg-primary/10 p-2 rounded-lg"><Download size={20}/></button>
                                </div>
                                <div className="p-5 border border-gray-200 dark:border-gray-700 rounded-xl flex items-center justify-between bg-white dark:bg-dark-card hover:border-primary transition group shadow-sm">
                                    <div className="flex items-center gap-4">
                                        <div className="p-3 bg-teal-50 text-teal-600 rounded-lg group-hover:bg-teal-600 group-hover:text-white transition"><CreditCard size={24}/></div>
                                        <div><h4 className="font-bold text-gray-800 dark:text-white">{t.docs.stipend}</h4><p className="text-xs text-gray-500">{t.docs.stipendDesc}</p></div>
                                    </div>
                                    <button className="text-primary hover:bg-primary/10 p-2 rounded-lg"><Printer size={20}/></button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- NEW: ÿµŸÅÿ≠ÿ© ÿ≠ÿ≥ÿßÿ®Ÿä (User Account) ---
        const UserAccountPage = ({ onBack, lang }) => {
            const user = {
                name: "ŸÅŸäÿµŸÑ ÿπÿ®ÿØÿßŸÑŸÑŸá ÿßŸÑÿÆÿßŸÑÿØ",
                id: "444002548",
                email: "s444002548@st.uqu.edu.sa",
                college: "ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä ŸàŸÜÿ∏ŸÖ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™",
                dept: "ŸáŸÜÿØÿ≥ÿ© ÿßŸÑÿ≠ÿßÿ≥ÿ® ÿßŸÑÿ¢ŸÑŸä",
                major: "ŸáŸÜÿØÿ≥ÿ© ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™",
                degree: "ÿ®ŸÉÿßŸÑŸàÿ±ŸäŸàÿ≥",
                type: "ÿßŸÜÿ™ÿ∏ÿßŸÖ",
                advisor: "ÿØ. ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ∫ÿßŸÖÿØŸä",
                advisorEmail: "advisor@uqu.edu.sa"
            };

            const handleEmailAdvisor = () => {
                window.location.href = `mailto:${user.advisorEmail}`;
            };

            return (
                <div className="animate-fade-in space-y-6">
                    <HeaderPage title="ÿ≠ÿ≥ÿßÿ®Ÿä" onBack={onBack} lang={lang} />
                    
                    {/* ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿ∑ÿßŸÑÿ® */}
                    <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 p-8 shadow-sm flex flex-col items-center text-center relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-24 bg-gradient-to-r from-primary to-teal-800"></div>
                        <div className="relative z-10 mt-4">
                            <div className="w-28 h-28 rounded-full border-4 border-white dark:border-dark-card shadow-lg bg-gray-200 flex items-center justify-center mx-auto overflow-hidden">
                                <User size={64} className="text-gray-400"/>
                            </div>
                            <h2 className="text-2xl font-bold text-gray-800 dark:text-white mt-4">{user.name}</h2>
                            <p className="text-gray-500 font-mono text-sm mt-1">{user.email}</p>
                            <span className="inline-block mt-3 bg-primary/10 text-primary px-3 py-1 rounded-full text-xs font-bold border border-primary/20">ÿ∑ÿßŸÑÿ® {user.type}</span>
                        </div>
                    </div>

                    {/* ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ© */}
                    <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden">
                        <div className="bg-gray-50 dark:bg-gray-800/50 px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2"><GraduationCap size={20} className="text-primary"/> ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸäÿ©</h3>
                        </div>
                        <div className="divide-y divide-gray-100 dark:divide-gray-700">
                            <div className="p-4 flex justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition">
                                <span className="text-gray-500 text-sm">ÿßŸÑŸÉŸÑŸäÿ©</span>
                                <span className="font-bold text-gray-800 dark:text-white text-sm">{user.college}</span>
                            </div>
                            <div className="p-4 flex justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition">
                                <span className="text-gray-500 text-sm">ÿßŸÑŸÇÿ≥ŸÖ</span>
                                <span className="font-bold text-gray-800 dark:text-white text-sm">{user.dept}</span>
                            </div>
                            <div className="p-4 flex justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition">
                                <span className="text-gray-500 text-sm">ÿßŸÑÿ™ÿÆÿµÿµ</span>
                                <span className="font-bold text-gray-800 dark:text-white text-sm">{user.major}</span>
                            </div>
                            <div className="p-4 flex justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition">
                                <span className="text-gray-500 text-sm">ÿßŸÑÿØÿ±ÿ¨ÿ© ÿßŸÑÿπŸÑŸÖŸäÿ©</span>
                                <span className="font-bold text-gray-800 dark:text-white text-sm">{user.degree}</span>
                            </div>
                        </div>
                    </div>

                    {/* ÿßŸÑŸÖÿ±ÿ¥ÿØ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä */}
                    <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm p-4 flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center border border-blue-100 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-400">
                                <User size={24} />
                            </div>
                            <div>
                                <span className="block text-xs text-gray-500 dark:text-gray-400 mb-0.5">ÿßŸÑŸÖÿ±ÿ¥ÿØ ÿßŸÑÿ£ŸÉÿßÿØŸäŸÖŸä</span>
                                <h4 className="font-bold text-gray-800 dark:text-white">{user.advisor}</h4>
                            </div>
                        </div>
                        <button 
                            onClick={handleEmailAdvisor}
                            className="flex items-center gap-2 bg-primary text-white px-4 py-2.5 rounded-xl text-sm font-bold hover:bg-teal-700 transition shadow-lg shadow-primary/20 active:scale-95"
                        >
                            <Send size={16} className="rotate-180" />
                            <span className="hidden sm:inline">ŸÖÿ±ÿßÿ≥ŸÑÿ©</span>
                        </button>
                    </div>

                    {/* ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ® */}
                    <div className="bg-white dark:bg-dark-card rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden">
                        <div className="bg-gray-50 dark:bg-gray-800/50 px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2"><Lock size={20} className="text-primary"/> ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ŸÖÿßŸÜ</h3>
                        </div>
                        <div className="divide-y divide-gray-100 dark:divide-gray-700">
                            <button className="w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition text-right group">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-blue-50 text-blue-600 rounded-lg"><User size={18}/></div>
                                    <span className="font-bold text-gray-700 dark:text-gray-200 text-sm">ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä</span>
                                </div>
                                <ChevronLeft size={18} className="text-gray-400 group-hover:text-primary transition-transform group-hover:-translate-x-1"/>
                            </button>
                            <button className="w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition text-right group">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-purple-50 text-purple-600 rounded-lg"><ShieldAlert size={18}/></div>
                                    <span className="font-bold text-gray-700 dark:text-gray-200 text-sm">ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ®ÿÆÿ∑Ÿàÿ™ŸäŸÜ (2FA)</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <span className="text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded font-bold">ŸÖŸÅÿπŸÑ</span>
                                    <ChevronLeft size={18} className="text-gray-400 group-hover:text-primary transition-transform group-hover:-translate-x-1"/>
                                </div>
                            </button>
                            <button className="w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition text-right group">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-orange-50 text-orange-600 rounded-lg"><Lock size={18}/></div>
                                    <span className="font-bold text-gray-700 dark:text-gray-200 text-sm">ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</span>
                                </div>
                                <ChevronLeft size={18} className="text-gray-400 group-hover:text-primary transition-transform group-hover:-translate-x-1"/>
                            </button>
                            <button className="w-full p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800/30 transition text-right group">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-gray-100 text-gray-600 rounded-lg"><CreditCard size={18}/></div>
                                    <span className="font-bold text-gray-700 dark:text-gray-200 text-sm">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿ¨Ÿáÿ≤ÿ© ŸàÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™</span>
                                </div>
                                <ChevronLeft size={18} className="text-gray-400 group-hover:text-primary transition-transform group-hover:-translate-x-1"/>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 19. ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© (Home View)
        const HomeView = ({ t, openService, lang }) => {
            const isAr = lang === 'ar';
            const completed = studentData.completedHours;
            const current = studentData.currentHours;
            const remaining = studentData.totalHours - (completed + current);
            const total = studentData.totalHours;
            const completedPct = (completed / total) * 100;
            const currentPct = (current / total) * 100;

            const upcomingExams = isAr ? [
                { subject: "ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÉŸäŸÖŸäÿßÿ¶Ÿä", date: "2024-05-15", time: "09:00", room: "109/ŸÇ6", daysLeft: 2 },
                { subject: "ÿßŸÑÿ•ÿ≠ÿµÿßÿ° ÿßŸÑÿπŸÖŸÑŸä", date: "2024-05-20", time: "10:30", room: "ŸÖÿπŸÖŸÑ 2", daysLeft: 7 },
            ] : [
                { subject: "Chemical Analysis", date: "2024-05-15", time: "09:00", room: "109/C6", daysLeft: 2 },
                { subject: "Practical Statistics", date: "2024-05-20", time: "10:30", room: "Lab 2", daysLeft: 7 },
            ];
            
            const attendanceData = isAr ? [
                { name: 'ÿ®ÿ±ŸÖÿ¨ÿ© ŸÖÿ™ŸÇÿØŸÖÿ©', absencePct: 0, excused: false },      
                { name: 'ÿ™ÿ≠ŸÑŸäŸÑ ŸÉŸäŸÖŸäÿßÿ¶Ÿä', absencePct: 12, excused: false },    
                { name: 'ÿ•ÿ≠ÿµÿßÿ° ŸáŸÜÿØÿ≥Ÿä', absencePct: 20, excused: true },       
                { name: 'ŸÅŸäÿ≤Ÿäÿßÿ° ÿπÿßŸÖÿ©', absencePct: 16, excused: false },      
            ] : [
                { name: 'Advanced Programming', absencePct: 0, excused: false },      
                { name: 'Chemical Analysis', absencePct: 12, excused: false },    
                { name: 'Engineering Statistics', absencePct: 20, excused: true },       
                { name: 'General Physics', absencePct: 16, excused: false },      
            ];

            return (
                <div className="space-y-8 animate-fade-in">
                    {/* Persistent Notification Banner */}
                    <div className="bg-amber-50 dark:bg-amber-900/20 border-l-4 border-amber-500 p-4 rounded-r-xl shadow-sm flex items-start gap-4">
                        <div className="p-2.5 bg-amber-100 dark:bg-amber-800 rounded-full text-amber-600 dark:text-amber-200 shrink-0">
                            <Bell size={24} className="animate-pulse"/>
                        </div>
                        <div className="flex-1">
                            <h4 className="font-bold text-amber-800 dark:text-amber-100 text-sm md:text-base">{t.notificationTitle}</h4>
                            <p className="text-xs md:text-sm text-amber-700 dark:text-amber-200 mt-1 leading-relaxed font-medium">
                                {t.notificationBody}
                            </p>
                        </div>
                    </div>

                    <div>
                        <h3 className="text-sm font-bold text-gray-400 uppercase mb-4 tracking-wider flex items-center gap-2"><div className="w-1 h-4 bg-primary rounded-full"></div> {t.quickActions}</h3>
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <ActionCard icon={<Calendar size={24}/>} title={t.schedule} onClick={() => openService('schedule')} />
                            <ActionCard icon={<FileText size={24}/>} title={t.results} onClick={() => openService('results')} color="gold" />
                            <ActionCard icon={<RefreshCw size={24}/>} title={t.addDrop} onClick={() => openService('addDrop')} color="blue" />
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 bg-primary rounded-2xl p-8 text-white shadow-xl relative overflow-hidden group flex flex-col justify-between">
                            <div className="absolute top-0 right-0 w-full h-full opacity-[0.07] bg-[url('https://www.transparenttextures.com/patterns/arabesque.png')]"></div>
                            <div className="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-8">
                                <div>
                                    <div className="inline-flex items-center gap-2 bg-black/20 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-medium text-teal-100 mb-4 border border-white/10"><TrendingUp size={14} className="text-gold" /> <span>{t.statusRegular}</span></div>
                                    <h2 className="text-6xl font-bold text-white mb-2 tracking-tighter">{studentData.gpa}</h2> 
                                    <p className="text-teal-100 text-lg opacity-90">{t.gpa}</p>
                                </div>
                                <div className="bg-white/10 backdrop-blur-md p-4 rounded-xl border border-white/10 text-center min-w-[100px]"><span className="block text-3xl font-bold text-gold">{total}</span><span className="text-xs text-teal-100">{t['total-hours-label']}</span></div>
                            </div>
                            <div className="relative z-10 w-full">
                                <div className="flex justify-between text-xs text-teal-100 mb-2 font-medium"><span>{t.progress}</span><span>{Math.round(((completed + current)/total)*100)}%</span></div>
                                <div className="w-full h-4 bg-black/20 rounded-full overflow-hidden flex"><div className="h-full bg-white shadow-[0_0_10px_rgba(255,255,255,0.5)]" style={{ width: `${completedPct}%` }} title={`${t.hoursCompleted}: ${completed}`}></div><div className="h-full bg-gold shadow-[0_0_10px_rgba(177,142,81,0.5)]" style={{ width: `${currentPct}%` }} title={`${t.hoursCurrent}: ${current}`}></div></div>
                                <div className="grid grid-cols-3 gap-2 mt-4">
                                    <div className="bg-white/10 rounded-lg p-2 text-center border border-white/5"><div className="flex items-center justify-center gap-1.5 mb-1"><div className="w-2 h-2 rounded-full bg-white"></div><span className="text-[10px] text-teal-100">{t.hoursCompleted}</span></div><span className="text-lg font-bold text-white block leading-none">{completed}</span></div>
                                    <div className="bg-gold/20 rounded-lg p-2 text-center border border-gold/20"><div className="flex items-center justify-center gap-1.5 mb-1"><div className="w-2 h-2 rounded-full bg-gold"></div><span className="text-[10px] text-gold">{t.hoursCurrent}</span></div><span className="text-lg font-bold text-gold block leading-none">{current}</span></div>
                                    <div className="bg-black/20 rounded-lg p-2 text-center border border-white/5"><div className="flex items-center justify-center gap-1.5 mb-1"><div className="w-2 h-2 rounded-full bg-gray-400"></div><span className="text-[10px] text-gray-300">{t.hoursRemaining}</span></div><span className="text-lg font-bold text-gray-200 block leading-none">{remaining}</span></div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white dark:bg-dark-card rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col h-full min-h-[250px]">
                            <div className="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50"><h3 className="font-bold text-primary flex items-center gap-2 text-sm"><Clock size={16}/> {t.todaysLectures}</h3><span className="text-xs bg-primary/10 text-primary px-2 py-1 rounded font-bold">3</span></div>
                            <div className="p-4 space-y-4 flex-1 overflow-y-auto">
                                <div className="flex gap-4 opacity-50"><div className="flex flex-col items-center"><div className="w-3 h-3 rounded-full bg-gray-300"></div><div className="w-0.5 h-full bg-gray-200 my-1"></div></div><div><h4 className="font-bold text-gray-500 text-sm line-through">{isAr ? "ÿ•ÿ≠ÿµÿßÿ° ŸáŸÜÿØÿ≥Ÿä" : "Engineering Statistics"}</h4><p className="text-xs text-gray-400">08:00 - 09:50</p></div></div>
                                <div className="flex gap-4"><div className="flex flex-col items-center"><div className="w-3 h-3 rounded-full bg-primary ring-4 ring-teal-100 animate-pulse"></div><div className="w-0.5 h-full bg-gray-200 my-1"></div></div><div className="bg-teal-50 p-3 rounded-lg border border-teal-100 w-full"><h4 className="font-bold text-primary text-sm">{isAr ? "ÿ™ÿ≠ŸÑŸäŸÑ ŸÉŸäŸÖŸäÿßÿ¶Ÿä" : "Chemical Analysis"}</h4><p className="text-xs text-gray-600 mt-1">{isAr ? "ŸÖÿπŸÖŸÑ 3" : "Lab 3"} ‚Ä¢ {t.now}</p></div></div>
                                <div className="flex gap-4"><div className="flex flex-col items-center"><div className="w-3 h-3 rounded-full bg-gray-300 dark:bg-gray-600 border-2 border-white dark:border-dark-card"></div></div><div><h4 className="font-bold text-gray-700 dark:text-gray-300 text-sm">{isAr ? "ÿ™ŸÅÿßÿπŸÑ ÿßŸÑÿ•ŸÜÿ≥ÿßŸÜ ŸàÿßŸÑÿ≠ÿßÿ≥ÿ®" : "HCI"}</h4><p className="text-xs text-gray-500">01:00 - 02:50 ‚Ä¢ {isAr ? "ŸÇÿßÿπÿ© 12" : "Hall 12"}</p><span className="text-[10px] text-teal-600 font-bold bg-teal-50 px-1.5 rounded mt-1 inline-block">{t['upcoming-label']}</span></div></div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="bg-white dark:bg-dark-card p-5 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700">
                            <div className="flex justify-between items-center mb-4"><h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2"><span className="w-1 h-5 bg-primary rounded-full"></span>{t.upcomingExams}</h3><button className="text-xs text-primary font-bold hover:bg-primary/5 px-2 py-1 rounded">{t['view-all']}</button></div>
                            <div className="space-y-3">
                                {upcomingExams.map((exam, i) => (
                                    <div key={i} className="flex gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700 relative overflow-hidden">
                                        {exam.daysLeft <= 3 && <div className="absolute top-0 right-0 w-1 h-full bg-red-500"></div>}
                                        <div className="flex flex-col items-center justify-center bg-white dark:bg-gray-700 rounded shadow-sm w-12 h-12 border border-gray-100 dark:border-gray-600"><span className="text-[10px] text-gray-500 dark:text-gray-400 font-bold">{t['month-may']}</span><span className="text-base font-bold text-primary dark:text-teal-400 font-mono">{new Date(exam.date).getDate()}</span></div>
                                        <div className="flex-1 py-0.5"><h4 className="font-bold text-gray-800 dark:text-gray-200 text-sm">{exam.subject}</h4><div className="flex items-center gap-3 mt-1 text-xs text-gray-500 dark:text-gray-400"><span className="flex items-center gap-1"><Clock size={12}/> {exam.time}</span><span className="flex items-center gap-1"><MapPin size={12}/> {exam.room}</span></div></div>
                                        <span className={`self-start text-[10px] px-2 py-0.5 rounded-full font-bold ${exam.daysLeft <= 3 ? 'bg-red-100 text-red-600' : 'bg-blue-50 text-blue-600'}`}>{t.hoursRemaining} {exam.daysLeft} {t['days-label']}</span>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="bg-white dark:bg-dark-card p-5 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700">
                            <h3 className="font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2"><span className="w-1 h-5 bg-primary rounded-full"></span>{t.attendance}</h3>
                             <div className="space-y-6">
                                {attendanceData.map((item, idx) => {
                                    const progressPercent = Math.min((item.absencePct / 25) * 100, 100);
                                    let statusColor = "bg-green-500";
                                    let statusText = ""; 
                                    if (item.absencePct === 0) { 
                                        statusColor = "bg-emerald-500"; 
                                        statusText = t['status-perfect']; 
                                    } 
                                    else if (item.absencePct < 10) { 
                                        statusColor = "bg-green-500"; 
                                        statusText = t['status-safe']; 
                                    } 
                                    else if (item.absencePct >= 10 && item.absencePct < 15) { 
                                        statusColor = "bg-yellow-500"; 
                                        statusText = t['status-warning']; 
                                    } 
                                    else if (item.absencePct >= 15) { 
                                        if (item.excused) { 
                                            statusColor = "bg-orange-400"; 
                                            statusText = t['status-high-excused']; 
                                        } else { 
                                            statusColor = "bg-red-600"; 
                                            statusText = t['status-denial']; 
                                        } 
                                    }

                                    return (
                                        <div key={idx} className="mb-2">
                                            <div className="flex justify-between items-center mb-1"><span className="font-bold text-gray-700 dark:text-gray-300 text-sm">{item.name}</span><div className="flex items-center gap-2">{statusText && (<span className={`text-[10px] px-2 py-0.5 rounded font-bold text-white shadow-sm ${statusColor}`}>{statusText}</span>)}<span className={`text-[10px] font-bold ${item.absencePct >= 15 && !item.excused ? 'text-red-500' : 'text-gray-500'}`}>{item.absencePct}%</span></div></div>
                                            <div className="relative w-full h-10"><div className="absolute top-3 w-full h-2.5 bg-gray-100 dark:bg-gray-700 rounded-full overflow-visible"><div className="absolute inset-0 rounded-full overflow-hidden"><div className={`h-full transition-all duration-1000 ${statusColor}`} style={{ width: `${progressPercent}%` }}></div></div><div className="absolute -top-1 bottom-0 w-0.5 bg-gray-300 dark:bg-gray-600 z-10" style={{ right: '60%' }}></div><div className="absolute top-4 text-[9px] font-bold text-gray-400 translate-x-1/2" style={{ right: '60%' }}>15%</div><div className="absolute -top-1 bottom-0 w-0.5 bg-red-300 dark:bg-red-800 z-10" style={{ right: '99%' }}></div><div className="absolute top-4 text-[9px] font-bold text-red-400 translate-x-full" style={{ right: '99%' }}>25%</div><div className="absolute top-4 text-[9px] text-gray-400" style={{ right: '0%' }}>0%</div></div></div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('home');
            const [activeCategory, setActiveCategory] = useState(null);
            const [darkMode, setDarkMode] = useState(false);
            const [lang, setLang] = useState('ar');
            const [menuOpen, setMenuOpen] = useState(false);

            useEffect(() => { document.documentElement.classList.toggle('dark', darkMode); }, [darkMode]);
            // IMPORTANT: Ensure correct directory switching
            useEffect(() => { document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr'; }, [lang]);

            const t = translations[lang];
            const isAr = lang === 'ar';

            const goHome = () => setView('home');

            // --- Menu Structure Updated ---
            const menuItems = [
                // Analytics item removed from here to be placed as a main link
                {
                    id: 'academic', icon: <GraduationCap size={20}/>,
                    subItems: [
                        { id: 'schedule' },
                        { id: 'academic-events' }, // Added here
                        { id: 'exams' }, 
                        { id: 'plan' },
                        { id: 'results' },
                        { id: 'absences' }, 
                        { id: 'record' }
                    ]
                },
                {
                    id: 'registration', icon: <CheckCircle2 size={20}/>,
                    subItems: [
                        { id: 'offered-courses' },
                        { id: 'addDrop' },
                        { id: 'dept-add' },
                        { id: 'dept-change' },
                        { id: 'dept-drop' },
                        { id: 'reg-requests' },
                        { id: 'withdraw' }
                    ]
                },
                {
                    id: 'requests', icon: <FileText size={20}/>,
                    subItems: [
                        { id: 'academic-action-new' },
                        { id: 'academic-action-view' },
                        { id: 'major-change-new' },
                        { id: 'major-change-view' }
                    ]
                },
                {
                    id: 'personal', icon: <User size={20}/>,
                    subItems: [
                        { id: 'penalties' }, 
                        { id: 'rewards' }, 
                        { id: 'finance' },
                        { id: 'docs' },
                        { id: 'allowances' }, 
                        { id: 'id-photo' } 
                    ]
                }
            ];

            const toggleCategory = (id) => {
                setActiveCategory(activeCategory === id ? null : id);
            };

            // Shared handler for notifications
            const openNotifications = () => setView('notifications');

            const renderContent = () => {
                switch(view) {
                    case 'student-dashboard': return <StudentDashboardPage onBack={goHome} lang={lang} />; 
                    case 'notifications': return <NotificationsPage onBack={goHome} lang={lang} />; // Added Route
                    case 'academic-events': return <AcademicEventsPage onBack={goHome} lang={lang} />;
                    case 'schedule': return <SchedulePage onBack={goHome} t={t} lang={lang} />;
                    case 'plan': return <PlanPage onBack={goHome} t={t} lang={lang} />;
                    case 'results': return <ResultsPage onBack={goHome} t={t} lang={lang} onOpenNotifications={openNotifications} />;
                    case 'addDrop': return <AddDropPage onBack={goHome} t={t} lang={lang} />;
                    
                    // Registration Views
                    case 'offered-courses': return <OfferedCoursesPage onBack={goHome} lang={lang} />;
                    case 'dept-add': return <DepartmentRequestPage onBack={goHome} type="add" lang={lang} />;
                    case 'dept-change': return <DepartmentRequestPage onBack={goHome} type="change" lang={lang} />;
                    case 'dept-drop': return <DepartmentRequestPage onBack={goHome} type="drop" lang={lang} />;
                    case 'reg-requests': return <RegistrationRequestsPage onBack={goHome} lang={lang} />;
                    case 'withdraw': return <WithdrawPage onBack={goHome} lang={lang} />;

                    // Academic Views
                    case 'exams': return <ExamsPage onBack={goHome} lang={lang} />;
                    case 'e-reg': return <RegistrationPage onBack={goHome} lang={lang} />;
                    case 'absences': return <AbsencesPage onBack={goHome} lang={lang} />;
                    case 'record': return <AcademicRecordPage onBack={goHome} lang={lang} t={t} onOpenNotifications={openNotifications} />; 
                    
                    // Requests Views
                    case 'academic-action-new': return <NewAcademicActionPage onBack={goHome} lang={lang} />;
                    case 'academic-action-view': return <ViewAcademicActionsPage onBack={goHome} lang={lang} />;
                    case 'major-change-new': return <MajorChangeRequestPage onBack={goHome} lang={lang} />;
                    case 'major-change-view': return <ViewMajorChangeRequestsPage onBack={goHome} lang={lang} />;

                    // Personal Views
                    case 'id-photo': return <PersonalPage onBack={goHome} activeView="id-photo" lang={lang} />;
                    case 'finance': return <PersonalPage onBack={goHome} activeView="finance" lang={lang} />;
                    case 'rewards': return <PersonalPage onBack={goHome} activeView="rewards" lang={lang} />;
                    case 'penalties': return <PersonalPage onBack={goHome} activeView="penalties" lang={lang} />;
                    case 'allowances': return <PersonalPage onBack={goHome} activeView="allowances" lang={lang} />;
                    case 'docs': return <PersonalPage onBack={goHome} activeView="docs" lang={lang} />;
                    case 'profile': return <PersonalPage onBack={goHome} activeView="id-photo" lang={lang} />; // Fallback
                    
                    // NEW: User Account View
                    case 'user-account': return <UserAccountPage onBack={goHome} lang={lang} />;
                    
                    default: return <HomeView t={t} openService={setView} lang={lang} />;
                }
            };

            return (
                <div className="min-h-screen relative flex">
                    {/* Sidebar */}
                    <aside className={`md:flex flex-col w-72 bg-white dark:bg-dark-card border-l dark:border-l-0 dark:border-r border-gray-200 dark:border-gray-800 fixed top-0 bottom-0 z-40 shadow-sm transition-all duration-300 ${isAr ? 'right-0 border-l' : 'left-0 border-r'} ${menuOpen ? 'translate-x-0' : (isAr ? 'translate-x-full' : '-translate-x-full')} md:translate-x-0`}>
                        <div className="p-8 flex items-center gap-3 mb-2">
                            <div className="w-12 h-12 bg-primary rounded-xl flex items-center justify-center text-white shadow-lg"><GraduationCap size={28}/></div>
                            <div><h1 className="font-bold text-xl tracking-tight text-primary dark:text-teal-400">{t.appTitle}</h1><p className="text-[10px] text-gray-400">{t.uniName}</p></div>
                        </div>
                        
                        <div className="px-4 mb-4 space-y-2">
                             <button onClick={() => setView('home')} className={`w-full flex items-center gap-4 px-4 py-3 rounded-lg text-sm font-bold transition-all ${view === 'home' ? 'bg-primary text-white shadow-md' : 'text-gray-600 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-800'}`}>
                                <LayoutDashboard size={20}/> {t.dashboard}
                            </button>
                             <button onClick={() => setView('student-dashboard')} className={`w-full flex items-center gap-4 px-4 py-3 rounded-lg text-sm font-bold transition-all ${view === 'student-dashboard' ? 'bg-primary text-white shadow-md' : 'text-gray-600 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-800'}`}>
                                <PieChart size={20}/> {t['student-dashboard']}
                            </button>
                        </div>

                        <nav className="flex-1 px-4 space-y-1 overflow-y-auto pb-4 custom-scrollbar">
                            {/* Menu Items Rendering */}
                            {menuItems.map(cat => (
                                <div key={cat.id} className="rounded-lg overflow-hidden">
                                    <button 
                                        onClick={() => toggleCategory(cat.id)}
                                        className={`w-full flex items-center justify-between px-4 py-3 text-sm font-bold transition-all ${activeCategory === cat.id ? 'bg-gray-50 dark:bg-gray-800/50 text-primary' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800'}`}
                                    >
                                        {/* Use translation key for category title */}
                                        <div className="flex items-center gap-3">{cat.icon} {t[cat.id]}</div>
                                        <ChevronDown size={16} className={`transition-transform duration-300 ${activeCategory === cat.id ? 'rotate-180' : ''}`}/>
                                    </button>
                                    
                                    <div className={`overflow-hidden transition-all duration-300 ease-in-out ${activeCategory === cat.id ? 'max-h-96 opacity-100' : 'max-h-0 opacity-0'}`}>
                                        <div className="bg-gray-50 dark:bg-gray-800/30 py-2 pr-11 pl-4 space-y-1">
                                            {cat.subItems.map(item => (
                                                <button 
                                                    key={item.id}
                                                    onClick={() => { setView(item.id); if(window.innerWidth < 768) setMenuOpen(false); }}
                                                    className={`w-full text-right text-xs font-bold py-2 px-2 rounded-lg transition-colors flex items-center gap-2 ${view === item.id ? 'text-primary bg-primary/5' : 'text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white'}`}
                                                >
                                                    <div className={`w-1.5 h-1.5 rounded-full ${view === item.id ? 'bg-primary' : 'bg-gray-300'}`}></div>
                                                    {/* Use translation key for sub-item label */}
                                                    {t[item.id]}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </nav>

                        {/* User Profile Mini Footer with onClick */}
                        <div className="p-4 border-t border-gray-100 dark:border-gray-800">
                             <button 
                                onClick={() => { setView('user-account'); if(window.innerWidth < 768) setMenuOpen(false); }}
                                className="w-full flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition text-right"
                             >
                                <div className="w-10 h-10 rounded-full bg-gray-200 overflow-hidden border border-gray-300">
                                     <div className="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400"><User size={20}/></div>
                                </div>
                                <div className="overflow-hidden">
                                    <h4 className="font-bold text-xs truncate text-gray-800 dark:text-gray-200">{isAr ? studentData.name : "Faisal Abdullah Al-Khalid"}</h4>
                                    <p className="text-[10px] text-gray-400 truncate">{studentData.id}</p>
                                </div>
                             </button>
                        </div>
                    </aside>
                    
                    {/* Mobile Overlay */}
                    {menuOpen && <div className="fixed inset-0 bg-black/50 z-30 md:hidden" onClick={() => setMenuOpen(false)}></div>}

                    <main className={`flex-1 w-full pb-20 md:pb-10 transition-all duration-300 ${isAr ? 'md:mr-72' : 'md:ml-72'}`}>
                        <header className="bg-white/80 dark:bg-dark-card/80 backdrop-blur-md sticky top-0 z-30 border-b border-gray-200 dark:border-gray-800 px-6 py-4 flex justify-between items-center shadow-sm">
                            <button onClick={() => setMenuOpen(!menuOpen)} className="md:hidden p-2 hover:bg-gray-100 rounded-lg"><Menu size={24} className="text-gray-600"/></button>
                            <h2 className="text-xl font-bold text-gray-800 dark:text-white">{t[view] || t.dashboard}</h2>
                            <div className="flex gap-3">
                                <NotificationBell onClick={openNotifications} /> {/* Updated Main Header Bell */}
                                <button 
                                    onClick={() => setLang(lang === 'ar'?'en':'ar')} 
                                    className="p-2 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white rounded-full text-xs font-bold w-10 h-10 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors shadow-sm"
                                >
                                    EN/ÿπ
                                </button>
                                <button 
                                    onClick={() => setDarkMode(!darkMode)} 
                                    className="p-2 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-yellow-400 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors shadow-sm"
                                >
                                    {darkMode ? <Sun size={20}/> : <Moon size={20}/>}
                                </button>
                            </div>
                        </header>
                        <div className="p-6 max-w-7xl mx-auto">{renderContent()}</div>
                        {/* Chatbot integrated globally */}
                        <Chatbot t={t} />
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>