
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوابتي - نسخة الساعة الذكية</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#006771', dark: '#004d55', light: '#008c99' },
                        gold: { DEFAULT: '#B18E51' },
                        dark: { bg: '#0f172a', card: '#1e293b', text: '#f1f5f9' },
                        watch: { black: '#000000', bezel: '#262626', strap: '#004d55' }
                    },
                    fontFamily: { sans: ['IBM Plex Sans Arabic', 'sans-serif'] },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.2s ease-out forwards',
                    }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'IBM Plex Sans Arabic', sans-serif; background-color: #f0f2f5; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        /* Hide Scrollbar for Watch Feel */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Watch Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        /* Glass Effect */
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>

    <!-- Import Map -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-200 selection:bg-primary selection:text-white">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Bell, Clock, Calendar, CheckCircle2, AlertTriangle, 
            X, ChevronRight, MapPin, BookOpen, GraduationCap, 
            Activity, Battery, Wifi, ChevronUp, Plus, Trash2, Power, RotateCcw, Pencil, AlertCircle
        } from 'lucide-react';

        // --- Initial Mock Data ---
        const initialNotifications = [
            { id: 1, type: 'lecture', title: 'تحليل كيميائي', time: 'بعد 10 دقائق', loc: 'معمل 3', urgent: true, attended: false },
            { id: 2, type: 'exam', title: 'اختبار أمن سيبراني', time: 'غداً 09:00', loc: 'قاعة أ', urgent: false, attended: false },
            { id: 3, type: 'admin', title: 'إنذار غياب', time: 'منذ ساعة', loc: 'إحصاء هندسي', urgent: true, attended: false },
        ];

        // --- Components ---

        // 1. Watch Status Bar
        const StatusBar = () => {
            const [time, setTime] = useState(new Date());
            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 60000);
                return () => clearInterval(timer);
            }, []);
            
            return (
                <div className="flex justify-between items-center px-4 py-1 text-[10px] text-gray-400 font-medium z-20 relative select-none">
                    <span className="font-mono">{time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false })}</span>
                    <div className="flex gap-1.5">
                        <Wifi size={10} />
                        <Battery size={10} className="text-green-500"/>
                    </div>
                </div>
            );
        };

        // 2. Watch Face (Home Screen)
        const WatchFace = ({ onOpenNotifications, nextEvent }) => {
            const [time, setTime] = useState(new Date());
            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            return (
                <div className="h-full flex flex-col items-center justify-between py-6 relative overflow-hidden animate-fade-in bg-gradient-to-b from-gray-900 to-black select-none">
                    <div className="absolute top-0 w-full h-1/2 bg-primary/10 blur-3xl rounded-full"></div>

                    <div className="text-center z-10 mt-4 cursor-default">
                        <div className="text-gold text-[10px] font-bold tracking-widest uppercase mb-1">
                             {new Intl.DateTimeFormat('ar-EG', { weekday: 'long', day: 'numeric' }).format(time)}
                        </div>
                        <div className="text-7xl font-bold text-white font-mono leading-none tracking-tighter">
                            {time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false })}
                        </div>
                        <div className="text-primary text-xs font-medium mt-1">بوابتي</div>
                    </div>

                    <div className="w-full px-4 z-10">
                        {nextEvent ? (
                            <div className="glass rounded-2xl p-3 relative overflow-hidden group cursor-pointer active:scale-95 transition-transform" onClick={onOpenNotifications}>
                                <div className="absolute left-0 top-0 bottom-0 w-1 bg-primary"></div>
                                <div className="flex justify-between items-start">
                                    <div>
                                        <div className="flex items-center gap-1 text-[10px] text-primary font-bold mb-0.5">
                                            <Clock size={10} />
                                            <span>الحدث القادم</span>
                                        </div>
                                        <h3 className="text-white font-bold text-sm truncate w-32">{nextEvent.title}</h3>
                                        <p className="text-gray-400 text-[10px] mt-0.5">{nextEvent.time} • {nextEvent.loc}</p>
                                    </div>
                                    <div className="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center text-primary animate-pulse-slow">
                                        <Bell size={14} />
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="glass rounded-2xl p-3 text-center cursor-pointer active:scale-95" onClick={onOpenNotifications}>
                                <p className="text-gray-400 text-xs">لا توجد أحداث قادمة</p>
                            </div>
                        )}
                    </div>

                    <button onClick={onOpenNotifications} className="flex flex-col items-center gap-1 text-gray-500 animate-bounce active:text-white transition-colors">
                        <ChevronUp size={16} />
                        <span className="text-[9px]">الإشعارات</span>
                    </button>
                </div>
            );
        };

        // 3. Notification List with Delete/Add/Edit
        const NotificationList = ({ notifications, onSelect, onBack, onAdd, onDelete, onEdit }) => {
            return (
                <div className="h-full bg-black flex flex-col animate-fade-in">
                    <div className="px-4 py-3 flex items-center justify-between border-b border-gray-800 bg-gray-900/50 backdrop-blur-md sticky top-0 z-10">
                        <h2 className="text-white font-bold text-sm flex items-center gap-2">
                            <span className="w-1.5 h-1.5 rounded-full bg-primary"></span>
                            التنبيهات
                        </h2>
                        <button onClick={onAdd} className="w-6 h-6 rounded-full bg-gray-800 flex items-center justify-center text-primary hover:bg-gray-700 active:bg-primary active:text-white transition-colors">
                            <Plus size={14} />
                        </button>
                    </div>

                    <div className="flex-1 overflow-y-auto p-3 space-y-2 hide-scrollbar pb-10">
                        {notifications.length === 0 ? (
                            <div className="h-full flex flex-col items-center justify-center text-gray-500 gap-2">
                                <Bell size={24} className="opacity-20"/>
                                <p className="text-xs">فارغة تماماً</p>
                            </div>
                        ) : (
                            notifications.map(notif => (
                                <div 
                                    key={notif.id} 
                                    onClick={() => onSelect(notif)}
                                    className={`p-3 rounded-2xl border transition-all active:scale-[0.98] cursor-pointer flex justify-between items-stretch gap-3 ${notif.attended ? 'opacity-60 grayscale bg-gray-900 border-gray-800' : notif.urgent ? 'bg-red-900/10 border-red-900/30' : 'bg-gray-800/40 border-gray-700/30'}`}
                                >
                                    <div className="flex-1 flex flex-col justify-between">
                                        <div className="flex justify-between items-start mb-1">
                                            <div className={`p-1.5 rounded-lg ${notif.urgent ? 'bg-red-500' : (notif.attended ? 'bg-gray-600' : 'bg-primary')} text-white`}>
                                                {notif.attended ? <CheckCircle2 size={12}/> : (notif.type === 'lecture' ? <BookOpen size={12}/> : notif.type === 'exam' ? <Activity size={12}/> : <AlertTriangle size={12}/>)}
                                            </div>
                                            <span className="text-[10px] text-gray-400 font-mono">{notif.time}</span>
                                        </div>
                                        <div>
                                            <h4 className={`text-gray-100 font-bold text-sm leading-tight ${notif.attended ? 'line-through decoration-white/50' : ''}`}>{notif.title}</h4>
                                            <div className="flex items-center gap-1 text-[10px] text-gray-500 mt-1 truncate">
                                                <MapPin size={10}/> {notif.loc}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* Action Buttons Container */}
                                    <div className="flex flex-col justify-center gap-2 border-r border-gray-700 pr-2 mr-[-4px]">
                                        <button 
                                            onClick={(e) => { e.stopPropagation(); onEdit(notif); }}
                                            className="w-7 h-7 flex items-center justify-center bg-blue-500/10 text-blue-400 rounded-full hover:bg-blue-500 hover:text-white transition-colors"
                                            title="تعديل"
                                        >
                                            <Pencil size={12}/>
                                        </button>
                                        <button 
                                            onClick={(e) => { e.stopPropagation(); onDelete(notif.id); }}
                                            className="w-7 h-7 flex items-center justify-center bg-red-500/10 text-red-400 rounded-full hover:bg-red-500 hover:text-white transition-colors"
                                            title="حذف"
                                        >
                                            <Trash2 size={12}/>
                                        </button>
                                    </div>
                                </div>
                            ))
                        )}
                        <div className="h-4"></div>
                    </div>
                </div>
            );
        };

        // 4. Add/Edit Reminder Screen
        const AddEditReminder = ({ onSave, onCancel, initialData }) => {
            const [text, setText] = useState(initialData ? initialData.title : '');
            const presets = ['تسليم واجب', 'مذاكرة جماعية', 'مقابلة مرشد', 'شراء قهوة'];
            const isEdit = !!initialData;

            return (
                <div className="h-full bg-black flex flex-col p-4 animate-fade-in">
                    <h3 className="text-white font-bold text-sm mb-3 text-center">
                        {isEdit ? 'تعديل التذكير' : 'إضافة تذكير'}
                    </h3>
                    <input 
                        type="text" 
                        value={text}
                        onChange={(e) => setText(e.target.value)}
                        placeholder="عنوان التذكير..."
                        className="w-full bg-gray-800 border border-gray-700 rounded-xl px-3 py-3 text-white text-sm mb-3 focus:border-primary outline-none placeholder-gray-600 text-right"
                        autoFocus
                    />
                    <div className="flex flex-wrap gap-2 mb-4">
                        {presets.map(p => (
                            <button key={p} onClick={() => setText(p)} className="bg-gray-800 text-gray-300 text-[10px] px-2 py-1 rounded-full border border-gray-700 hover:bg-gray-700 active:bg-primary active:text-white active:border-primary transition-colors">
                                {p}
                            </button>
                        ))}
                    </div>
                    <div className="mt-auto space-y-2">
                        <button 
                            onClick={() => onSave(text, initialData?.id)} 
                            disabled={!text.trim()}
                            className="w-full py-2.5 bg-primary disabled:opacity-50 disabled:cursor-not-allowed rounded-full text-white text-xs font-bold active:scale-95 transition"
                        >
                            حفظ
                        </button>
                        <button onClick={onCancel} className="w-full py-2.5 bg-gray-800 rounded-full text-gray-300 text-xs font-bold active:scale-95 transition">
                            إلغاء
                        </button>
                    </div>
                </div>
            );
        };

        // 5. Notification Detail with Action
        const NotificationDetail = ({ notif, onBack, onToggleAttend, onEdit }) => {
            return (
                <div className="h-full bg-black flex flex-col relative animate-fade-in">
                    <div className={`h-1/3 relative flex items-center justify-center ${notif.attended ? 'bg-gray-800' : 'bg-primary/20'}`}>
                        <div className="absolute inset-0 bg-gradient-to-b from-transparent to-black"></div>
                        <div className={`w-16 h-16 rounded-full flex items-center justify-center shadow-2xl z-10 transition-colors ${notif.attended ? 'bg-gray-600 text-gray-300' : (notif.urgent ? 'bg-red-500 text-white' : 'bg-primary text-white')}`}>
                            {notif.attended ? <CheckCircle2 size={32}/> : (notif.type === 'lecture' ? <BookOpen size={32}/> : <AlertTriangle size={32}/>)}
                        </div>
                    </div>
                    
                    <div className="flex-1 px-4 pt-2 text-center">
                        <div className="inline-block px-2 py-0.5 rounded-full border border-gray-700 text-[10px] text-gold mb-2 font-bold bg-gold/10">
                            {notif.attended ? 'مكتمل' : (notif.type === 'lecture' ? 'محاضرة أكاديمية' : 'تنبيه')}
                        </div>
                        <h2 className={`text-xl font-bold text-white mb-1 leading-tight ${notif.attended ? 'line-through opacity-60' : ''}`}>{notif.title}</h2>
                        <p className="text-gray-400 text-xs mb-4">{notif.time} • {notif.loc}</p>
                        
                        <div className="space-y-2">
                            <button 
                                onClick={() => onToggleAttend(notif.id)}
                                className={`w-full py-2.5 rounded-full text-white text-xs font-bold active:scale-95 transition shadow-lg ${notif.attended ? 'bg-gray-700 shadow-none' : 'bg-primary shadow-primary/20 hover:bg-primary/90'}`}
                            >
                                {notif.attended ? 'إلغاء الاكتمال' : 'تسجيل الحضور / إنجاز'}
                            </button>
                            <button onClick={() => onEdit(notif)} className="w-full py-2.5 bg-gray-800 rounded-full text-gray-300 text-xs font-bold hover:bg-gray-700 active:scale-95 transition">
                                تعديل
                            </button>
                             <button onClick={onBack} className="w-full py-2.5 bg-gray-900 rounded-full text-gray-500 text-xs font-bold hover:bg-gray-800 active:scale-95 transition">
                                عودة للقائمة
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 6. Confirmation Overlay (New Component)
        const ConfirmationOverlay = ({ message, onConfirm, onCancel }) => (
            <div className="absolute inset-0 bg-black/90 z-50 flex flex-col items-center justify-center p-6 text-center animate-fade-in backdrop-blur-sm">
                <div className="w-12 h-12 rounded-full bg-red-900/30 flex items-center justify-center mb-3">
                    <Trash2 size={24} className="text-red-500" />
                </div>
                <p className="text-white text-sm font-bold mb-6">{message}</p>
                <div className="flex gap-3 w-full">
                    <button onClick={onConfirm} className="flex-1 bg-red-600 text-white py-2.5 rounded-full text-xs font-bold hover:bg-red-700 transition">نعم، حذف</button>
                    <button onClick={onCancel} className="flex-1 bg-gray-700 text-gray-300 py-2.5 rounded-full text-xs font-bold hover:bg-gray-600 transition">إلغاء</button>
                </div>
            </div>
        );

        // --- Main App ---
        const SmartWatchApp = () => {
            // State
            const [screen, setScreen] = useState('face'); // face, list, detail, add_edit
            const [notifications, setNotifications] = useState(() => {
                const saved = localStorage.getItem('watch_notifications');
                return saved ? JSON.parse(saved) : initialNotifications;
            });
            const [selectedNotif, setSelectedNotif] = useState(null);
            const [editingNotif, setEditingNotif] = useState(null); // Data for editing
            const [isScreenOn, setIsScreenOn] = useState(true);
            const [confirmModal, setConfirmModal] = useState(null); // { message, onConfirm }

            // Persistence
            useEffect(() => {
                localStorage.setItem('watch_notifications', JSON.stringify(notifications));
            }, [notifications]);

            // Handlers
            const handleSaveNotification = (text, id) => {
                if (!text.trim()) return;
                
                if (id) {
                    // Edit existing
                    setNotifications(prev => prev.map(n => 
                        n.id === id ? { ...n, title: text } : n
                    ));
                    // If we were editing from detail view, update selection
                    if (selectedNotif?.id === id) {
                        setSelectedNotif(prev => ({ ...prev, title: text }));
                    }
                } else {
                    // Create new
                    const newNotif = {
                        id: Date.now(),
                        type: 'admin',
                        title: text,
                        time: 'الآن',
                        loc: 'شخصي',
                        urgent: false,
                        attended: false
                    };
                    setNotifications(prev => [newNotif, ...prev]);
                }
                setScreen('list');
                setEditingNotif(null);
            };

            const requestDelete = (id) => {
                setConfirmModal({
                    message: 'هل أنت متأكد من حذف هذا التنبيه نهائياً؟',
                    onConfirm: () => {
                        setNotifications(prev => prev.filter(n => n.id !== id));
                        if (selectedNotif?.id === id) {
                            setScreen('list');
                            setSelectedNotif(null);
                        }
                        setConfirmModal(null);
                    }
                });
            };

            const handleToggleAttend = (id) => {
                setNotifications(notifications.map(n => 
                    n.id === id ? { ...n, attended: !n.attended } : n
                ));
                // Update selected notif to reflect change in detail view
                if (selectedNotif?.id === id) {
                    setSelectedNotif(prev => ({ ...prev, attended: !prev.attended }));
                }
            };

            const openEditScreen = (notif) => {
                setEditingNotif(notif);
                setScreen('add_edit');
            };
            
            const openAddScreen = () => {
                setEditingNotif(null);
                setScreen('add_edit');
            };

            const handleCrownClick = () => {
                if (!isScreenOn) {
                    setIsScreenOn(true);
                    return;
                }
                if (screen === 'face') return; 
                setScreen('face');
                setSelectedNotif(null);
            };

            const handleSideButtonClick = () => {
                setIsScreenOn(!isScreenOn);
            };

            const resetData = () => {
                setConfirmModal({
                    message: 'سيتم حذف جميع البيانات والعودة للوضع الافتراضي. هل أنت متأكد؟',
                    onConfirm: () => {
                        localStorage.removeItem('watch_notifications');
                        setNotifications(initialNotifications);
                        setScreen('face');
                        setConfirmModal(null);
                    }
                });
            };

            // Get next active event for face
            const nextEvent = notifications.find(n => !n.attended) || notifications[0];

            return (
                <div className="flex flex-col items-center gap-8 select-none">
                    {/* Watch Case */}
                    <div className="relative group">
                        
                        {/* Straps */}
                        <div className="absolute -top-16 left-1/2 -translate-x-1/2 w-48 h-24 bg-primary/80 rounded-t-[3rem] -z-10 shadow-inner">
                            <div className="w-full h-full opacity-20 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
                        </div>
                        <div className="absolute -bottom-16 left-1/2 -translate-x-1/2 w-48 h-24 bg-primary/80 rounded-b-[3rem] -z-10 shadow-inner">
                            <div className="w-full h-full opacity-20 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
                        </div>

                        {/* Watch Body */}
                        <div className="w-[320px] h-[390px] bg-[#1a1a1a] rounded-[3.5rem] p-1.5 shadow-[0_20px_50px_-12px_rgba(0,0,0,0.5)] border-4 border-[#333] ring-1 ring-gray-700 relative">
                            
                            {/* Side Button (Interactable) */}
                            <button 
                                onClick={handleSideButtonClick}
                                className="absolute right-[-10px] top-24 w-2 h-14 bg-[#333] rounded-r-lg border-l border-black cursor-pointer active:scale-95 active:bg-[#444] transition-transform"
                                title="تشغيل/إيقاف الشاشة"
                            ></button> 

                            {/* Crown (Interactable) */}
                            <button 
                                onClick={handleCrownClick}
                                className="absolute right-[-14px] top-10 w-3.5 h-8 bg-gold rounded-r-md border-l border-black shadow-sm flex items-center justify-center overflow-hidden cursor-pointer active:scale-95 hover:bg-yellow-600 transition-all z-40 group/crown" 
                                title="الرئيسية"
                            >
                                <div className="w-full h-[1px] bg-black/30 mb-[1px]"></div>
                                <div className="w-full h-[1px] bg-black/30 mb-[1px]"></div>
                                <div className="w-full h-[1px] bg-black/30"></div>
                            </button>

                            {/* Screen Bezel */}
                            <div className="w-full h-full bg-black rounded-[3rem] overflow-hidden border-[6px] border-black relative">
                                
                                {/* Black Screen Overlay (Sleep Mode) */}
                                <div className={`absolute inset-0 bg-black z-50 pointer-events-none transition-opacity duration-300 ${isScreenOn ? 'opacity-0' : 'opacity-100'}`}></div>

                                {/* The Display */}
                                <div className="w-full h-full text-white font-sans flex flex-col relative">
                                    <StatusBar />
                                    
                                    <div className="flex-1 relative overflow-hidden">
                                        {screen === 'face' && (
                                            <WatchFace 
                                                onOpenNotifications={() => setScreen('list')} 
                                                nextEvent={nextEvent} 
                                            />
                                        )}
                                        {screen === 'list' && (
                                            <NotificationList 
                                                notifications={notifications} 
                                                onSelect={(n) => { setSelectedNotif(n); setScreen('detail'); }} 
                                                onBack={() => setScreen('face')} 
                                                onAdd={openAddScreen}
                                                onDelete={requestDelete}
                                                onEdit={openEditScreen}
                                            />
                                        )}
                                        {screen === 'add_edit' && (
                                            <AddEditReminder 
                                                onSave={handleSaveNotification}
                                                onCancel={() => setScreen('list')}
                                                initialData={editingNotif}
                                            />
                                        )}
                                        {screen === 'detail' && selectedNotif && (
                                            <NotificationDetail 
                                                notif={selectedNotif} 
                                                onBack={() => setScreen('list')} 
                                                onToggleAttend={handleToggleAttend}
                                                onEdit={openEditScreen}
                                            />
                                        )}
                                    </div>

                                    {/* Confirmation Overlay (Global) */}
                                    {confirmModal && (
                                        <ConfirmationOverlay 
                                            message={confirmModal.message}
                                            onConfirm={confirmModal.onConfirm}
                                            onCancel={() => setConfirmModal(null)}
                                        />
                                    )}

                                    {/* Home Indicator */}
                                    {screen !== 'face' && (
                                        <div className="absolute bottom-1 left-1/2 -translate-x-1/2 w-16 h-1 bg-white/20 rounded-full cursor-pointer z-30 hover:bg-white active:scale-95 transition-all" onClick={() => setScreen('face')}></div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="text-center text-gray-500 text-sm max-w-xs space-y-2">
                        <div className="flex justify-center gap-4 text-[10px] text-gray-400">
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-gold rounded-sm"></div> التاج: الرئيسية</div>
                            <div className="flex items-center gap-1"><div className="w-2 h-4 bg-[#333] rounded-sm"></div> الجانبي: إغلاق الشاشة</div>
                        </div>
                        <button onClick={resetData} className="px-3 py-1.5 bg-gray-300 text-gray-700 rounded-lg text-xs font-bold hover:bg-white transition flex items-center gap-1 mx-auto">
                            <RotateCcw size={12}/> إعادة ضبط البيانات
                        </button>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<SmartWatchApp />);
    </script>
</body>
</html